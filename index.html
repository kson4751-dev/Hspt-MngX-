<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RxFlow - Hospital Management System</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Hide everything until authenticated */
        body {
            display: none !important;
        }
        body.authenticated {
            display: block !important;
        }
    </style>
    
    <!-- Immediate Authentication Guard -->
    <script>
        // Synchronous check before anything renders
        (function() {
            const userId = localStorage.getItem('userId') || sessionStorage.getItem('userId');
            if (!userId) {
                window.location.replace('login.html');
            } else {
                document.documentElement.classList.add('authenticated');
            }
        })();
    </script>
</head>
<body class="authenticated">
    <!-- Top Bar -->
    <header class="top-bar">
        <div class="top-bar-left">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
            </div>
            <div class="logo-title">RxFlow</div>
        </div>
        
        <div class="top-bar-right">
            <!-- Emergency Alert Indicator -->
            <div class="emergency-indicator-menu" id="emergencyIndicatorMenu" style="display: none;">
                <button class="icon-button emergency-indicator-btn" onclick="navigateToModule('emergency')" title="Active Emergencies">
                    <i class="fas fa-ambulance"></i>
                    <span class="emergency-indicator-badge" id="emergencyIndicatorBadge">0</span>
                </button>
            </div>
            
            <button class="theme-toggle" id="themeToggle">
                <svg class="theme-icon sun-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="10" cy="10" r="3.5" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M10 1.5V3.5M10 16.5V18.5M18.5 10H16.5M3.5 10H1.5M15.5 4.5L14.2 5.8M5.8 14.2L4.5 15.5M15.5 15.5L14.2 14.2M5.8 5.8L4.5 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <svg class="theme-icon moon-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.5 11.18C17.3178 12.2054 16.8808 13.1683 16.2293 13.9812C15.5778 14.7941 14.7326 15.4313 13.7718 15.8373C12.811 16.2432 11.7655 16.4053 10.7254 16.3095C9.68531 16.2137 8.68494 15.8628 7.81471 15.2884C6.94447 14.714 6.22975 13.9336 5.73385 13.0158C5.23795 12.098 4.97633 11.0714 4.97215 10.0275C4.96797 8.98366 5.22134 7.9552 5.70883 7.03329C6.19632 6.11137 6.90423 5.32524 7.76999 4.74366C6.95427 4.92731 6.19063 5.29244 5.53566 5.81349C4.88068 6.33453 4.35059 7.00003 3.98667 7.75959C3.62276 8.51915 3.43456 9.35276 3.43657 10.1968C3.43858 11.0408 3.63078 11.8735 3.9988 12.6313C4.36682 13.3891 4.90064 14.0523 5.55875 14.5702C6.21685 15.0881 6.98272 15.4493 7.79996 15.6285C8.61721 15.8078 9.46538 15.8007 10.2794 15.6078C11.0933 15.4149 11.8534 15.0408 12.5032 14.5124C13.1531 13.9839 13.6767 13.3139 14.0365 12.5533" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="notification-menu">
                <button class="icon-button notification-icon-btn" id="notificationsBtn">
                    <svg class="notification-bell" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 6.66667C15 5.34058 14.4732 4.06881 13.5355 3.13113C12.5979 2.19345 11.3261 1.66667 10 1.66667C8.67392 1.66667 7.40215 2.19345 6.46447 3.13113C5.52678 4.06881 5 5.34058 5 6.66667C5 12.5 2.5 14.1667 2.5 14.1667H17.5C17.5 14.1667 15 12.5 15 6.66667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M11.4417 17.5C11.2952 17.7526 11.0849 17.9622 10.8319 18.1079C10.5789 18.2537 10.292 18.3304 10 18.3304C9.70802 18.3304 9.42115 18.2537 9.16814 18.1079C8.91513 17.9622 8.70484 17.7526 8.55835 17.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="notification-badge" id="notificationBadge"></span>
                </button>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header">
                        <h4>Notifications</h4>
                        <button class="mark-all-read" id="markAllReadBtn">Mark all as read</button>
                    </div>
                    <div class="notification-list" id="notificationList">
                        <!-- Notifications will be dynamically loaded here -->
                    </div>
                    <div class="notification-footer">
                        <a href="#" id="viewAllNotifications">View all notifications</a>
                    </div>
                </div>
            </div>
            <div class="messages-menu">
                <button class="icon-button messages-icon-btn" id="messagesBtn">
                    <svg class="messages-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.5 9.58333C17.5029 10.6832 17.2459 11.7683 16.75 12.75C16.162 13.9264 15.2581 14.916 14.1395 15.6077C13.021 16.2995 11.7319 16.6662 10.4167 16.6667C9.31678 16.6695 8.23176 16.4126 7.25 15.9167L2.5 17.5L4.08333 12.75C3.58744 11.7683 3.33047 10.6832 3.33333 9.58333C3.33384 8.26812 3.70051 6.97904 4.39227 5.86045C5.08402 4.74187 6.07355 3.838 7.25 3.25C8.23176 2.75411 9.31678 2.49713 10.4167 2.5H10.8333C12.5703 2.59582 14.2109 3.32896 15.4409 4.55907C16.671 5.78917 17.4042 7.42971 17.5 9.16667V9.58333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="messages-badge" id="messagesBadge"></span>
                </button>
                <div class="messages-dropdown" id="messagesDropdown">
                    <div class="messages-header">
                        <h4>Messages</h4>
                        <div class="messages-actions">
                            <button class="clear-messages-btn" id="clearMessagesBtn" title="Clear All Messages">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="compose-btn" id="composeMessageBtn" title="Compose Message">
                                <i class="fas fa-pen"></i> Compose
                            </button>
                        </div>
                    </div>
                    <div class="messages-list" id="messagesList">
                        <!-- Messages will be dynamically loaded here -->
                    </div>
                    <div class="messages-footer">
                        <a href="#" id="viewAllMessages">View all messages</a>
                    </div>
                </div>
            </div>
            <div class="profile-menu">
                <button class="profile-button" id="profileBtn">
                    <img src="https://via.placeholder.com/40" alt="Profile" class="profile-img">
                    <span class="profile-name" id="profileName">Loading...</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="profile-dropdown" id="profileDropdown">
                    <a href="#settings" onclick="navigateToModule('settings'); return false;"><i class="fas fa-user"></i> My Profile</a>
                    <a href="#settings" onclick="navigateToModule('settings'); return false;"><i class="fas fa-cog"></i> Settings</a>
                    <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-module="dashboard">
                <i class="fas fa-th-large"></i>
                <span class="nav-text">Dashboard</span>
            </a>
            <div class="nav-item-group">
                <a href="#reception" class="nav-item" data-module="reception">
                    <i class="fas fa-clipboard-list"></i>
                    <span class="nav-text">Reception</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="nav-dropdown">
                    <a href="#new-patient" class="nav-dropdown-item" data-module="reception" data-submodule="new-patient">
                        <i class="fas fa-user-plus"></i>
                        <span class="nav-text">New Patient</span>
                    </a>
                    <a href="#all-patients" class="nav-dropdown-item" data-module="reception" data-submodule="all-patients">
                        <i class="fas fa-users"></i>
                        <span class="nav-text">All Patients</span>
                    </a>
                </div>
            </div>
            <a href="#triage" class="nav-item" data-module="triage">
                <i class="fas fa-stethoscope"></i>
                <span class="nav-text">Triage</span>
            </a>
            <a href="#doctor" class="nav-item" data-module="doctor">
                <i class="fas fa-user-md"></i>
                <span class="nav-text">Doctor</span>
            </a>
            <a href="#ward-nursing" class="nav-item" data-module="ward-nursing">
                <i class="fas fa-bed"></i>
                <span class="nav-text">Ward & Nursing</span>
            </a>
            <a href="#laboratory" class="nav-item" data-module="laboratory">
                <i class="fas fa-flask"></i>
                <span class="nav-text">Laboratory</span>
            </a>
            <div class="nav-item-group">
                <a href="#pharmacy" class="nav-item" data-module="pharmacy">
                    <i class="fas fa-pills"></i>
                    <span class="nav-text">Pharmacy</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="nav-dropdown">
                    <a href="#pharmacy-inventory" class="nav-dropdown-item" data-module="pharmacy" data-submodule="pharmacy-inventory">
                        <i class="fas fa-boxes"></i>
                        <span class="nav-text">Inventory</span>
                    </a>
                    <a href="#pharmacy-pos" class="nav-dropdown-item" data-module="pharmacy" data-submodule="pharmacy-pos">
                        <i class="fas fa-cash-register"></i>
                        <span class="nav-text">POS</span>
                    </a>
                    <a href="#pharmacy-sales" class="nav-dropdown-item" data-module="pharmacy" data-submodule="pharmacy-sales">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">All Sales</span>
                    </a>
                </div>
            </div>
            <div class="nav-item-group">
                <a href="#billing" class="nav-item" data-module="billing">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span class="nav-text">Billing</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="nav-dropdown">
                    <a href="#create-bill" class="nav-dropdown-item" data-module="billing" data-submodule="billing">
                        <i class="fas fa-plus-circle"></i>
                        <span class="nav-text">Create Bill</span>
                    </a>
                    <a href="#view-bills" class="nav-dropdown-item" data-module="billing" data-submodule="billing-view">
                        <i class="fas fa-eye"></i>
                        <span class="nav-text">View Bills</span>
                    </a>
                </div>
            </div>
            <div class="nav-item-group">
                <a href="#inventory" class="nav-item" data-module="inventory">
                    <i class="fas fa-boxes"></i>
                    <span class="nav-text">Inventory</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="nav-dropdown">
                    <a href="#add-item" class="nav-dropdown-item" data-module="inventory" data-submodule="add-item">
                        <i class="fas fa-plus-circle"></i>
                        <span class="nav-text">Add Item</span>
                    </a>
                    <a href="#view-inventory" class="nav-dropdown-item" data-module="inventory" data-submodule="view-inventory">
                        <i class="fas fa-eye"></i>
                        <span class="nav-text">View Inventory</span>
                    </a>
                </div>
            </div>
            <div class="nav-item-group">
                <a href="#expenses" class="nav-item" data-module="expenses">
                    <i class="fas fa-wallet"></i>
                    <span class="nav-text">Expenses</span>
                    <i class="fas fa-chevron-down dropdown-icon"></i>
                </a>
                <div class="nav-dropdown">
                    <a href="#add-expense" class="nav-dropdown-item" data-module="expenses" data-submodule="add-expense">
                        <i class="fas fa-plus-circle"></i>
                        <span class="nav-text">Add Expense</span>
                    </a>
                    <a href="#all-expenses" class="nav-dropdown-item" data-module="expenses" data-submodule="all-expenses">
                        <i class="fas fa-list"></i>
                        <span class="nav-text">All Expenses</span>
                    </a>
                </div>
            </div>
            <a href="#reports" class="nav-item" data-module="reports">
                <i class="fas fa-chart-bar"></i>
                <span class="nav-text">Reports</span>
            </a>
            <a href="#admin" class="nav-item" data-module="admin">
                <i class="fas fa-user-shield"></i>
                <span class="nav-text">Admin Panel</span>
            </a>
            <a href="#emergency" class="nav-item emergency" data-module="emergency">
                <i class="fas fa-ambulance"></i>
                <span class="nav-text">Emergency</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Dashboard Module -->
        <div class="module active" id="dashboard-module">
            <div class="module-header">
                <div style="flex: 1;">
                    <h1 class="module-title">Dashboard</h1>
                    <p class="module-description">Real-time overview of hospital operations and key metrics</p>
                </div>
                <div class="dashboard-actions">
                    <div class="dashboard-search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="dashboardSearchInput" placeholder="Search patients, activities, modules..." class="dashboard-search-input">
                    </div>
                    <button class="btn btn-primary" onclick="refreshDashboard()" id="dashboardRefreshBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            
            <div class="dashboard-content">
                <!-- Main Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Total Patients</span>
                            <span class="stat-value" id="dashTotalPatients">0</span>
                            <span class="stat-change positive"><i class="fas fa-arrow-up"></i> <span id="dashPatientsChange">0</span> today</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Today's Patients</span>
                            <span class="stat-value" id="dashTodayPatients">0</span>
                            <span class="stat-change neutral"><i class="fas fa-clock"></i> In last 24 hours</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Queue</span>
                            <span class="stat-value" id="dashQueuePatients">0</span>
                            <span class="stat-change warning"><i class="fas fa-hourglass-half"></i> Waiting</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Active Consultations</span>
                            <span class="stat-value" id="dashActiveConsultations">0</span>
                            <span class="stat-change positive"><i class="fas fa-stethoscope"></i> In progress</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Lab Tests</span>
                            <span class="stat-value" id="dashLabTests">0</span>
                            <span class="stat-change neutral"><i class="fas fa-vial"></i> Pending</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Pharmacy Orders</span>
                            <span class="stat-value" id="dashPharmacyOrders">0</span>
                            <span class="stat-change positive"><i class="fas fa-prescription"></i> Active</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);">
                            <i class="fas fa-heartbeat"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Total Triaged</span>
                            <span class="stat-value" id="dashTriageCases">0</span>
                            <span class="stat-change positive"><i class="fas fa-user-check"></i> All Time</span>
                        </div>
                    </div>
                    
                    <div class="stat-card emergency-stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <i class="fas fa-ambulance"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Emergencies</span>
                            <span class="stat-value emergency-count" id="dashEmergencies">0</span>
                            <span class="stat-change negative"><i class="fas fa-exclamation-triangle"></i> Critical</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions Section -->
                <div class="quick-actions-section">
                    <h2 class="section-title">
                        <i class="fas fa-bolt"></i>
                        Quick Actions
                    </h2>
                    <div class="quick-actions-grid">
                        <button class="quick-action-btn" onclick="navigateToModule('reception', 'new-patient')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <span class="quick-action-label">Register Patient</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('reception', 'all-patients')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="fas fa-users"></i>
                            </div>
                            <span class="quick-action-label">View Patients</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('doctor')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="fas fa-stethoscope"></i>
                            </div>
                            <span class="quick-action-label">Consultations</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('laboratory')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <i class="fas fa-flask"></i>
                            </div>
                            <span class="quick-action-label">Lab Tests</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('pharmacy')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                <i class="fas fa-pills"></i>
                            </div>
                            <span class="quick-action-label">Pharmacy</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('inventory')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <span class="quick-action-label">Inventory</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('triage')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                                <i class="fas fa-heartbeat"></i>
                            </div>
                            <span class="quick-action-label">Triage</span>
                        </button>
                        
                        <button class="quick-action-btn" onclick="navigateToModule('emergency')">
                            <div class="quick-action-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <i class="fas fa-ambulance"></i>
                            </div>
                            <span class="quick-action-label">Emergency</span>
                        </button>
                    </div>
                </div>
                
                <!-- Recent Activities Section -->
                <div class="recent-activities-section">
                    <div class="section-header-row">
                        <h2 class="section-title">
                            <i class="fas fa-history"></i>
                            Recent Activities
                        </h2>
                        <button class="btn btn-sm btn-secondary" onclick="viewAllActivities()">
                            <i class="fas fa-list"></i>
                            View All
                        </button>
                    </div>
                    
                    <div class="activities-table-container">
                        <table class="activities-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Activity</th>
                                    <th>Patient</th>
                                    <th>Module</th>
                                    <th>User</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentActivitiesBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                        <i class="fas fa-clock" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                                        <p>No recent activities</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- All Activities Module -->
        <div class="module" id="all-activities-module">
            <div class="module-header">
                <div style="flex: 1;">
                    <h1 class="module-title">All Activities</h1>
                    <p class="module-description">Complete activity log across all hospital modules</p>
                </div>
                <div class="dashboard-actions">
                    <button class="btn btn-secondary" onclick="navigateToModule('dashboard')">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </button>
                    <button class="btn btn-primary" onclick="refreshAllActivities()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            
            <div class="dashboard-content">
                <!-- Filter Options -->
                <div class="filters-row" style="margin-bottom: 24px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="activityModuleFilter">Filter by Module</label>
                        <select id="activityModuleFilter" class="form-input">
                            <option value="">All Modules</option>
                            <option value="Reception">Reception</option>
                            <option value="Triage">Triage</option>
                            <option value="Doctor">Doctor</option>
                            <option value="Ward & Nursing">Ward & Nursing</option>
                            <option value="Laboratory">Laboratory</option>
                            <option value="Pharmacy">Pharmacy</option>
                            <option value="Billing">Billing</option>
                            <option value="Inventory">Inventory</option>
                            <option value="Expenses">Expenses</option>
                            <option value="Emergency">Emergency</option>
                            <option value="Admin">Admin</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="activityStatusFilter">Filter by Status</label>
                        <select id="activityStatusFilter" class="form-input">
                            <option value="">All Status</option>
                            <option value="success">Completed</option>
                            <option value="info">In Progress</option>
                            <option value="warning">Pending</option>
                            <option value="negative">Critical</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="activitySearchInput">Search Activities</label>
                        <input type="text" id="activitySearchInput" class="form-input" placeholder="Search patient, action, user...">
                    </div>
                </div>

                <!-- Activities Table -->
                <div class="activities-table-container">
                    <table class="activities-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Activity</th>
                                <th>Patient</th>
                                <th>Module</th>
                                <th>User</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="allActivitiesTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    <i class="fas fa-clock" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                                    <p>Loading activities...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Search Results Modal -->
        <div class="modal" id="dashboardSearchModal" style="display: none;">
            <div class="modal-overlay" onclick="closeDashboardSearchModal()"></div>
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-search"></i>
                        Search Results
                    </h2>
                    <button class="modal-close" onclick="closeDashboardSearchModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="dashboardSearchResults">
                        <!-- Search results will be populated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeDashboardSearchModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Reception Module -->
        <div class="module" id="reception-module">
            <div class="module-header">
                <h1 class="module-title">Reception</h1>
                <p class="module-description">Manage patient registration, check-ins, and appointments</p>
            </div>
        </div>

        <!-- New Patient Sub-module -->
        <div class="module" id="new-patient-module">
            <div class="module-header">
                <h1 class="module-title">New Patient</h1>
                <p class="module-description">Register new patients and capture their information</p>
            </div>
            
            <div class="form-container">
                <!-- Patient Category Selection (Always Visible) -->
                <div class="category-selection-box">
                    <div class="form-group">
                        <label for="patientCategory">Patient Category <span style="color: red;">*</span></label>
                        <select id="patientCategory" class="form-input" required>
                            <option value="" disabled selected>-- Select Patient Category --</option>
                            <option value="new">New Patient - First-time registration</option>
                            <option value="existing">Existing Patient - Search existing records</option>
                            <option value="referral">Referral - Patient from another facility</option>
                        </select>
                    </div>
                </div>

                <!-- Existing Patient Search Section -->
                <div class="category-content" id="existingPatientSection">
                    <div class="search-box-container">
                        <div class="search-box">
                            <input type="text" id="patientSearchInput" placeholder="Search by name, phone, or ID number...">
                            <button class="search-btn" id="searchPatientBtn">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                        <div class="search-results" id="searchResults">
                            <!-- Search results will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Referral Patient Section -->
                <div class="category-content" id="referralPatientSection">
                    <form id="referralPatientForm" class="patient-form">
                        <!-- Referral Information -->
                        <div class="form-section">
                            <h3 class="section-title">Referral Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="referralFrom">Referred From <span class="required">*</span></label>
                                    <input type="text" id="referralFrom" name="referralFrom" placeholder="Hospital/Clinic Name" required>
                                </div>
                                <div class="form-group">
                                    <label for="referralDoctor">Referring Doctor <span class="required">*</span></label>
                                    <input type="text" id="referralDoctor" name="referralDoctor" placeholder="Doctor's Name" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="referralDate">Referral Date <span class="required">*</span></label>
                                    <input type="date" id="referralDate" name="referralDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="referralSpecialty">Specialty Required</label>
                                    <select id="referralSpecialty" name="referralSpecialty">
                                        <option value="">Select Specialty</option>
                                        <option value="cardiology">Cardiology</option>
                                        <option value="neurology">Neurology</option>
                                        <option value="orthopedics">Orthopedics</option>
                                        <option value="pediatrics">Pediatrics</option>
                                        <option value="surgery">Surgery</option>
                                        <option value="oncology">Oncology</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="referralReason">Reason for Referral <span class="required">*</span></label>
                                    <textarea id="referralReason" name="referralReason" rows="3" placeholder="Detailed reason for referral" required></textarea>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="referralNotes">Additional Notes/Medical History</label>
                                    <textarea id="referralNotes" name="referralNotes" rows="3" placeholder="Any relevant medical information"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Personal Information -->
                        <div class="form-section">
                            <h3 class="section-title">Personal Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refFirstName">First Name <span class="required">*</span></label>
                                    <input type="text" id="refFirstName" name="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="refLastName">Last Name <span class="required">*</span></label>
                                    <input type="text" id="refLastName" name="lastName" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refDateOfBirth">Date of Birth <span class="required">*</span></label>
                                    <input type="date" id="refDateOfBirth" name="dateOfBirth" required>
                                </div>
                                <div class="form-group">
                                    <label for="refGender">Gender <span class="required">*</span></label>
                                    <select id="refGender" name="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refIdNumber">ID/Passport Number</label>
                                    <input type="text" id="refIdNumber" name="idNumber">
                                </div>
                                <div class="form-group">
                                    <label for="refBloodGroup">Blood Group</label>
                                    <select id="refBloodGroup" name="bloodGroup">
                                        <option value="">Select Blood Group</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="form-section">
                            <h3 class="section-title">Contact Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refPhone">Phone Number <span class="required">*</span></label>
                                    <input type="tel" id="refPhone" name="phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="refEmail">Email Address</label>
                                    <input type="email" id="refEmail" name="email">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refCountry">Country <span class="required">*</span></label>
                                    <select id="refCountry" name="country" required>
                                        <option value="">-- Select Country --</option>
                                        <option value="kenya" selected>Kenya</option>
                                        <option value="uganda">Uganda</option>
                                        <option value="tanzania">Tanzania</option>
                                        <option value="rwanda">Rwanda</option>
                                        <option value="burundi">Burundi</option>
                                        <option value="ethiopia">Ethiopia</option>
                                        <option value="somalia">Somalia</option>
                                        <option value="south-sudan">South Sudan</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="refCountyTown">County/Town <span class="required">*</span></label>
                                    <input type="text" id="refCountyTown" name="countyTown" placeholder="Enter county or town" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="refAddress">Physical Address <span class="required">*</span></label>
                                    <textarea id="refAddress" name="address" rows="3" required></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact -->
                        <div class="form-section">
                            <h3 class="section-title">Emergency Contact</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refEmergencyName">Contact Name <span class="required">*</span></label>
                                    <input type="text" id="refEmergencyName" name="emergencyName" required>
                                </div>
                                <div class="form-group">
                                    <label for="refEmergencyRelation">Relationship <span class="required">*</span></label>
                                    <input type="text" id="refEmergencyRelation" name="emergencyRelation" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refEmergencyPhone">Phone Number <span class="required">*</span></label>
                                    <input type="tel" id="refEmergencyPhone" name="emergencyPhone" required>
                                </div>
                                <div class="form-group">
                                    <label for="refEmergencyEmail">Email Address</label>
                                    <input type="email" id="refEmergencyEmail" name="emergencyEmail">
                                </div>
                            </div>
                        </div>

                        <!-- Insurance Information -->
                        <div class="form-section">
                            <h3 class="section-title">Insurance Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refInsuranceProvider">Insurance Provider</label>
                                    <select id="refInsuranceProvider" name="insuranceProvider">
                                        <option value="">-- Select Insurance --</option>
                                        <option value="shif">SHIF (Social Health Insurance Fund)</option>
                                        <option value="sha">SHA (Social Health Authority)</option>
                                        <option value="nhif">NHIF (National Hospital Insurance Fund)</option>
                                        <option value="aak">AAK Insurance</option>
                                        <option value="britam">Britam Insurance</option>
                                        <option value="cia">CIC Insurance</option>
                                        <option value="jubilee">Jubilee Insurance</option>
                                        <option value="madison">Madison Insurance</option>
                                        <option value="resolution">Resolution Health</option>
                                        <option value="uap">UAP Insurance</option>
                                        <option value="self-pay">Self Pay (No Insurance)</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="refInsuranceNumber">Insurance Number</label>
                                    <input type="text" id="refInsuranceNumber" name="insuranceNumber" placeholder="Enter insurance/member number">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refPolicyHolder">Policy Holder Name</label>
                                    <input type="text" id="refPolicyHolder" name="policyHolder" placeholder="If different from patient">
                                </div>
                                <div class="form-group">
                                    <label for="refPolicyExpiryDate">Policy Expiry Date</label>
                                    <input type="date" id="refPolicyExpiryDate" name="policyExpiryDate">
                                </div>
                            </div>
                        </div>

                        <!-- Consent Section -->
                        <div class="form-section">
                            <h3 class="section-title">Patient Consent</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="refPatientConsent">Do you consent to treatment and data processing?</label>
                                    <select id="refPatientConsent" name="patientConsent" class="form-input">
                                        <option value="">-- Select Option --</option>
                                        <option value="agree">I Agree</option>
                                        <option value="disagree">I Do Not Agree</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- OTP Verification Section (Hidden by default) -->
                            <div id="refOtpSection" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="refOtpPhone">Phone Number for OTP Verification</label>
                                        <input type="tel" id="refOtpPhone" name="otpPhone" placeholder="Enter phone number for verification">
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" id="refSendOtpBtn" style="margin-top: 28px;">
                                            <i class="fas fa-paper-plane"></i> Send OTP
                                        </button>
                                    </div>
                                </div>
                                <div class="form-row" id="refOtpInputSection" style="display: none;">
                                    <div class="form-group">
                                        <label for="refOtpCode">Enter OTP Code</label>
                                        <input type="text" id="refOtpCode" name="otpCode" placeholder="Enter 6-digit code" maxlength="6">
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-success" id="refVerifyOtpBtn" style="margin-top: 28px;">
                                            <i class="fas fa-check"></i> Verify OTP
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="reset" class="btn btn-secondary">
                                <i class="fas fa-redo"></i> Reset Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Register Referral Patient
                            </button>
                        </div>
                    </form>
                </div>

                <!-- New Patient Registration Form -->
                <div class="category-content active" id="newPatientSection">
                    <form id="newPatientForm" class="patient-form">
                        <!-- Personal Information -->
                        <div class="form-section">
                            <h3 class="section-title">Personal Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">First Name <span class="required">*</span></label>
                                    <input type="text" id="firstName" name="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">Last Name <span class="required">*</span></label>
                                    <input type="text" id="lastName" name="lastName" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
                                    <input type="date" id="dateOfBirth" name="dateOfBirth" required>
                                </div>
                                <div class="form-group">
                                    <label for="gender">Gender <span class="required">*</span></label>
                                    <select id="gender" name="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="idNumber">ID/Passport Number</label>
                                    <input type="text" id="idNumber" name="idNumber">
                                </div>
                                <div class="form-group">
                                    <label for="bloodGroup">Blood Group</label>
                                    <select id="bloodGroup" name="bloodGroup">
                                        <option value="">Select Blood Group</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="form-section">
                            <h3 class="section-title">Contact Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="phone">Phone Number <span class="required">*</span></label>
                                    <input type="tel" id="phone" name="phone" required>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" name="email">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="country">Country <span class="required">*</span></label>
                                    <select id="country" name="country" required>
                                        <option value="">-- Select Country --</option>
                                        <option value="kenya" selected>Kenya</option>
                                        <option value="uganda">Uganda</option>
                                        <option value="tanzania">Tanzania</option>
                                        <option value="rwanda">Rwanda</option>
                                        <option value="burundi">Burundi</option>
                                        <option value="ethiopia">Ethiopia</option>
                                        <option value="somalia">Somalia</option>
                                        <option value="south-sudan">South Sudan</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="countyTown">County/Town <span class="required">*</span></label>
                                    <input type="text" id="countyTown" name="countyTown" placeholder="Enter county or town" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="address">Physical Address <span class="required">*</span></label>
                                    <textarea id="address" name="address" rows="3" required></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact -->
                        <div class="form-section">
                            <h3 class="section-title">Emergency Contact</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="emergencyName">Contact Name <span class="required">*</span></label>
                                    <input type="text" id="emergencyName" name="emergencyName" required>
                                </div>
                                <div class="form-group">
                                    <label for="emergencyRelation">Relationship <span class="required">*</span></label>
                                    <input type="text" id="emergencyRelation" name="emergencyRelation" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="emergencyPhone">Phone Number <span class="required">*</span></label>
                                    <input type="tel" id="emergencyPhone" name="emergencyPhone" required>
                                </div>
                                <div class="form-group">
                                    <label for="emergencyEmail">Email Address</label>
                                    <input type="email" id="emergencyEmail" name="emergencyEmail">
                                </div>
                            </div>
                        </div>

                        <!-- Additional Information -->
                        <div class="form-section">
                            <h3 class="section-title">Additional Information</h3>
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="allergies">Known Allergies</label>
                                    <textarea id="allergies" name="allergies" rows="2" placeholder="List any known allergies"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="medicalHistory">Medical History</label>
                                    <textarea id="medicalHistory" name="medicalHistory" rows="3" placeholder="Brief medical history"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Insurance Information -->
                        <div class="form-section">
                            <h3 class="section-title">Insurance Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="insuranceProvider">Insurance Provider</label>
                                    <select id="insuranceProvider" name="insuranceProvider">
                                        <option value="">-- Select Insurance --</option>
                                        <option value="shif">SHIF (Social Health Insurance Fund)</option>
                                        <option value="sha">SHA (Social Health Authority)</option>
                                        <option value="nhif">NHIF (National Hospital Insurance Fund)</option>
                                        <option value="aak">AAK Insurance</option>
                                        <option value="britam">Britam Insurance</option>
                                        <option value="cia">CIC Insurance</option>
                                        <option value="jubilee">Jubilee Insurance</option>
                                        <option value="madison">Madison Insurance</option>
                                        <option value="resolution">Resolution Health</option>
                                        <option value="uap">UAP Insurance</option>
                                        <option value="self-pay">Self Pay (No Insurance)</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="insuranceNumber">Insurance Number</label>
                                    <input type="text" id="insuranceNumber" name="insuranceNumber" placeholder="Enter insurance/member number">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="policyHolder">Policy Holder Name</label>
                                    <input type="text" id="policyHolder" name="policyHolder" placeholder="If different from patient">
                                </div>
                                <div class="form-group">
                                    <label for="policyExpiryDate">Policy Expiry Date</label>
                                    <input type="date" id="policyExpiryDate" name="policyExpiryDate">
                                </div>
                            </div>
                        </div>

                        <!-- Consultation Fee Section -->
                        <div class="form-section">
                            <h3 class="section-title">Consultation Fee</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="chargeConsultationFee" name="chargeConsultationFee">
                                        <span class="toggle-text">Charge Consultation Fee</span>
                                    </label>
                                </div>
                            </div>

                            <div id="consultationFeeDetails" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="consultationFeeType">Fee Type</label>
                                        <select id="consultationFeeType" name="consultationFeeType">
                                            <option value="standard">Standard Consultation - KSh 500</option>
                                            <option value="custom">Custom Amount</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="consultationFeeAmount">Amount (KSh) <span class="required">*</span></label>
                                        <input type="number" id="consultationFeeAmount" name="consultationFeeAmount" value="500" min="0" step="50" placeholder="Enter amount">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group full-width">
                                        <label for="consultationFeeNotes">Notes (Optional)</label>
                                        <textarea id="consultationFeeNotes" name="consultationFeeNotes" rows="2" placeholder="Add any notes about the consultation fee"></textarea>
                                    </div>
                                </div>

                                <div class="fee-info-box">
                                    <i class="fas fa-info-circle"></i>
                                    <p>This fee will be sent to the billing module for processing. The patient must pay before consultation begins.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Consent Section -->
                        <div class="form-section">
                            <h3 class="section-title">Patient Consent</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="patientConsent">Do you consent to treatment and data processing?</label>
                                    <select id="patientConsent" name="patientConsent" class="form-input">
                                        <option value="">-- Select Option --</option>
                                        <option value="agree">I Agree</option>
                                        <option value="disagree">I Do Not Agree</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- OTP Verification Section (Hidden by default) -->
                            <div id="otpSection" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="otpPhone">Phone Number for OTP Verification</label>
                                        <input type="tel" id="otpPhone" name="otpPhone" placeholder="Enter phone number for verification">
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-primary" id="sendOtpBtn" style="margin-top: 28px;">
                                            <i class="fas fa-paper-plane"></i> Send OTP
                                        </button>
                                    </div>
                                </div>
                                <div class="form-row" id="otpInputSection" style="display: none;">
                                    <div class="form-group">
                                        <label for="otpCode">Enter OTP Code</label>
                                        <input type="text" id="otpCode" name="otpCode" placeholder="Enter 6-digit code" maxlength="6">
                                    </div>
                                    <div class="form-group">
                                        <button type="button" class="btn btn-success" id="verifyOtpBtn" style="margin-top: 28px;">
                                            <i class="fas fa-check"></i> Verify OTP
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="reset" class="btn btn-secondary">
                                <i class="fas fa-redo"></i> Reset Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Register Patient
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- All Patients Sub-module -->
        <div class="module" id="all-patients-module">
            <div class="module-header">
                <h1 class="module-title">All Patients</h1>
                <p class="module-description">View and manage all registered patients</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(37, 99, 235, 0.1);">
                        <i class="fas fa-users" style="color: #2563eb;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="totalPatientsCount">0</h3>
                        <p class="stat-label">Total Patients</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(16, 185, 129, 0.1);">
                        <i class="fas fa-user-clock" style="color: #10b981;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="todayPatientsCount">0</h3>
                        <p class="stat-label">Today's Patients</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-list-ol" style="color: #f59e0b;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="queuePatientsCount">0</h3>
                        <p class="stat-label">Patients in Queue</p>
                    </div>
                </div>
            </div>

            <!-- Search and Filters Bar -->
            <div class="patients-toolbar">
                <div class="toolbar-section">
                    <div class="search-box-inline">
                        <i class="fas fa-search"></i>
                        <input type="text" id="patientSearchField" placeholder="Search by name, ID, phone, or email..." class="search-input-inline">
                    </div>
                </div>
                <div class="toolbar-section">
                    <select id="filterStatus" class="filter-select">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="in-queue">In Queue</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="filterInsurance" class="filter-select">
                        <option value="">All Insurance</option>
                        <option value="shif">SHIF</option>
                        <option value="sha">SHA</option>
                        <option value="nhif">NHIF</option>
                        <option value="aak">AAK Insurance</option>
                        <option value="britam">Britam</option>
                        <option value="jubilee">Jubilee</option>
                        <option value="self-pay">Self Pay</option>
                        <option value="other">Other</option>
                    </select>
                    <select id="filterDate" class="filter-select">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                    <button class="btn btn-secondary" id="exportPatientsBtn">
                        <i class="fas fa-file-export"></i> Export
                    </button>
                    <button class="btn btn-primary" id="addNewPatientBtn">
                        <i class="fas fa-user-plus"></i> New Patient
                    </button>
                </div>
            </div>

            <!-- Patients Table -->
            <div class="table-container">
                <div class="table-wrapper">
                    <table class="patients-table" id="patientsTable">
                        <thead>
                            <tr>
                                <th>Patient ID</th>
                                <th>Full Name</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Insurance</th>
                                <th>County/Town</th>
                                <th>Registration Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="patientsTableBody">
                            <tr>
                                <td colspan="11" class="loading-row">
                                    <i class="fas fa-spinner fa-spin"></i> Loading patients...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info">
                    Showing <span id="showingStart">0</span> to <span id="showingEnd">0</span> of <span id="totalRecords">0</span> patients
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="firstPageBtn" disabled>
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="pagination-btn" id="prevPageBtn" disabled>
                        <i class="fas fa-angle-left"></i>
                    </button>
                    <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
                    <button class="pagination-btn" id="nextPageBtn" disabled>
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="pagination-btn" id="lastPageBtn" disabled>
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                </div>
                <div class="rows-per-page">
                    <label for="rowsPerPage">Rows per page:</label>
                    <select id="rowsPerPage">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Patient View/Edit Modal -->
        <div class="modal" id="patientModal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title" id="modalTitle">Patient Details</h2>
                    <button class="modal-close" id="modalCloseBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Content will be dynamically loaded here -->
                </div>
                <div class="modal-footer" id="modalFooter">
                    <button class="btn btn-secondary" id="modalCancelBtn">Close</button>
                </div>
            </div>
        </div>

        <!-- Triage Module -->
        <div class="module" id="triage-module">
            <div class="module-header">
                <h1 class="module-title">Triage</h1>
                <p class="module-description">Patient assessment, vital signs monitoring, and priority classification</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-users" style="color: #f59e0b;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="triageQueueCount">0</h3>
                        <p class="stat-label">Queue in Reception</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(16, 185, 129, 0.1);">
                        <i class="fas fa-user-check" style="color: #10b981;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="totalTriagedCount">0</h3>
                        <p class="stat-label">Total Triaged</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(14, 165, 233, 0.1);">
                        <i class="fas fa-calendar-day" style="color: #0ea5e9;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="todayTriageCount">0</h3>
                        <p class="stat-label">Triaged Today</p>
                    </div>
                </div>
            </div>

            <!-- Triage Reception Section -->
            <div class="triage-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-inbox"></i> Triage Reception Queue
                        <span class="section-subtitle">Maximum 5 patients at a time</span>
                    </h2>
                </div>

                <div class="triage-reception-container">
                    <div class="triage-queue-grid" id="triageQueueGrid">
                        <!-- Queue cards will be displayed here -->
                        <div class="empty-queue-message">
                            <i class="fas fa-inbox"></i>
                            <p>No patients in queue</p>
                            <small>Patients sent to triage will appear here</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Triage Records Table -->
            <div class="triage-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-list"></i> Triage Records
                    </h2>
                    <div class="section-actions">
                        <div class="search-box-inline" style="max-width: 300px;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="triageSearchField" placeholder="Search patient..." class="search-input-inline">
                        </div>
                        <button class="btn btn-secondary" id="exportTriageBtn">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Triage Table -->
                <div class="table-container">
                    <table class="triage-records-table" id="triageTable">
                        <thead>
                            <tr>
                                <th>Patient ID</th>
                                <th>Name</th>
                                <th>Age/Gender</th>
                                <th>BP</th>
                                <th>Temp</th>
                                <th>Pulse</th>
                                <th>Weight</th>
                                <th>BMI</th>
                                <th>Priority</th>
                                <th>Chief Complaint</th>
                                <th>Triaged Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="triageTableBody">
                            <tr>
                                <td colspan="12" class="loading-row">
                                    <i class="fas fa-spinner fa-spin"></i> Loading triage records...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        Showing <span id="triageShowingStart">0</span> to <span id="triageShowingEnd">0</span> of <span id="triageTotalRecords">0</span> records
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="triageFirstPageBtn" disabled>
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button class="pagination-btn" id="triagePrevPageBtn" disabled>
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <span class="page-info">Page <span id="triageCurrentPage">1</span> of <span id="triageTotalPages">1</span></span>
                        <button class="pagination-btn" id="triageNextPageBtn" disabled>
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button class="pagination-btn" id="triageLastPageBtn" disabled>
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                    <div class="rows-per-page">
                        <label for="triageRowsPerPage">Rows per page:</label>
                        <select id="triageRowsPerPage">
                            <option value="10">10</option>
                            <option value="25" selected>25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Triage Details Modal -->
        <div class="modal" id="triageModal">
            <div class="modal-overlay" id="triageModalOverlay"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title">Add Triage Details</h2>
                    <button class="modal-close" id="triageModalCloseBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="triageDetailsForm">
                        <input type="hidden" id="triagePatientId" name="patientId">
                        
                        <div class="form-section">
                            <h3 class="section-title">Patient Information</h3>
                            <div class="modal-info-grid">
                                <div class="modal-info-item">
                                    <span class="modal-info-label">Patient ID</span>
                                    <span class="modal-info-value" id="triageDisplayPatientId">-</span>
                                </div>
                                <div class="modal-info-item">
                                    <span class="modal-info-label">Name</span>
                                    <span class="modal-info-value" id="triageDisplayName">-</span>
                                </div>
                                <div class="modal-info-item">
                                    <span class="modal-info-label">Age</span>
                                    <span class="modal-info-value" id="triageDisplayAge">-</span>
                                </div>
                                <div class="modal-info-item">
                                    <span class="modal-info-label">Gender</span>
                                    <span class="modal-info-value" id="triageDisplayGender">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Vital Signs</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bloodPressure">Blood Pressure (mmHg) <span class="required">*</span></label>
                                    <input type="text" id="bloodPressure" name="bloodPressure" placeholder="120/80" required>
                                </div>
                                <div class="form-group">
                                    <label for="temperature">Temperature (C) <span class="required">*</span></label>
                                    <input type="number" id="temperature" name="temperature" step="0.1" placeholder="36.5" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pulseRate">Pulse Rate (bpm) <span class="required">*</span></label>
                                    <input type="number" id="pulseRate" name="pulseRate" placeholder="72" required>
                                </div>
                                <div class="form-group">
                                    <label for="respiratoryRate">Respiratory Rate (breaths/min) <span class="required">*</span></label>
                                    <input type="number" id="respiratoryRate" name="respiratoryRate" placeholder="16" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="oxygenSaturation">Oxygen Saturation (%) <span class="required">*</span></label>
                                    <input type="number" id="oxygenSaturation" name="oxygenSaturation" min="0" max="100" placeholder="98" required>
                                </div>
                                <div class="form-group">
                                    <label for="bloodSugar">Blood Sugar (mg/dL)</label>
                                    <input type="number" id="bloodSugar" name="bloodSugar" step="0.1" placeholder="90">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Physical Measurements</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="weight">Weight (kg) <span class="required">*</span></label>
                                    <input type="number" id="weight" name="weight" step="0.1" placeholder="70" required>
                                </div>
                                <div class="form-group">
                                    <label for="height">Height (cm) <span class="required">*</span></label>
                                    <input type="number" id="height" name="height" step="0.1" placeholder="170" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bmi">BMI (Auto-calculated)</label>
                                    <input type="text" id="bmi" name="bmi" readonly placeholder="Will be calculated">
                                </div>
                                <div class="form-group">
                                    <label for="headCircumference">Head Circumference (cm)</label>
                                    <input type="number" id="headCircumference" name="headCircumference" step="0.1" placeholder="Optional">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="chestCircumference">Chest Circumference (cm)</label>
                                    <input type="number" id="chestCircumference" name="chestCircumference" step="0.1" placeholder="Optional">
                                </div>
                                <div class="form-group">
                                    <label for="abdominalCircumference">Abdominal Circumference (cm)</label>
                                    <input type="number" id="abdominalCircumference" name="abdominalCircumference" step="0.1" placeholder="Optional">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Assessment</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="priority">Priority Level <span class="required">*</span></label>
                                    <select id="priority" name="priority" required>
                                        <option value="">Select Priority</option>
                                        <option value="critical">Critical (Red) - Immediate</option>
                                        <option value="urgent">Urgent (Orange) - 10-30 min</option>
                                        <option value="semi-urgent">Semi-Urgent (Yellow) - 30-60 min</option>
                                        <option value="standard">Standard (Green) - 1-2 hours</option>
                                        <option value="non-urgent">Non-Urgent (Blue) - 2-4 hours</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="chiefComplaint">Chief Complaint <span class="required">*</span></label>
                                    <input type="text" id="chiefComplaint" name="chiefComplaint" placeholder="Main reason for visit" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="triageNotes">Triage Notes</label>
                                    <textarea id="triageNotes" name="triageNotes" rows="3" placeholder="Additional observations or notes"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="triageModalCancelBtn">Cancel</button>
                    <button class="btn btn-primary" id="saveTriageBtn">
                        <i class="fas fa-save"></i> Save & Send to Triage Table
                    </button>
                </div>
            </div>
        </div>

        <!-- View Triage Record Modal -->
        <div class="modal" id="viewTriageModal">
            <div class="modal-overlay" id="viewTriageModalOverlay"></div>
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h2 class="modal-title">Triage Record Details</h2>
                    <button class="modal-close" id="viewTriageModalCloseBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="viewTriageModalBody">
                    <!-- Content will be populated dynamically -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="printTriageRecord(currentViewingTriageId)">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button class="btn btn-primary" onclick="exportTriageToPDF(currentViewingTriageId)">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
            </div>
        </div>

        <!-- Doctor Module -->
        <div class="module" id="doctor-module">
            <div class="module-header">
                <h1 class="module-title">Doctor</h1>
                <p class="module-description">Medical consultations, diagnosis, treatment plans, and patient records</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(37, 99, 235, 0.1); color: #2563eb;">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="doctorQueueCount">0</div>
                        <div class="stat-label">In Queue</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(16, 185, 129, 0.1); color: #10b981;">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="doctorPatientsToday">0</div>
                        <div class="stat-label">Patients Today</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(139, 92, 246, 0.1); color: #8b5cf6;">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="doctorTotalPatients">0</div>
                        <div class="stat-label">Total Patients</div>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="doctor-content-grid">
                <!-- Patient Queue Section -->
                <div class="doctor-queue-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-list"></i>
                            Patient Queue
                        </h2>
                        <button class="btn btn-sm btn-primary" id="refreshQueueBtn">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>

                    <div class="queue-list" id="doctorQueueList">
                        <!-- Queue items will be dynamically added here -->
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No patients in queue</p>
                        </div>
                    </div>
                </div>

                <!-- Patient Records Section -->
                <div class="doctor-records-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-file-medical"></i>
                            Today's Consultations
                        </h2>
                        <div class="section-actions">
                            <input type="search" class="search-input" placeholder="Search patients..." id="doctorSearchInput">
                            <button class="btn btn-sm btn-secondary" id="filterRecordsBtn">
                                <i class="fas fa-filter"></i>
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="openLabReportsModule()" style="position: relative;">
                                <i class="fas fa-flask"></i>
                                Lab Reports
                                <span class="badge" id="labReportsBadge" style="display: none;">0</span>
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="openAllConsultationsModule()">
                                <i class="fas fa-history"></i>
                                All Consultations
                            </button>
                        </div>
                    </div>

                    <div class="records-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Patient ID</th>
                                    <th>Patient Name</th>
                                    <th>Age</th>
                                    <th>Complaint</th>
                                    <th>Diagnosis</th>
                                    <th>History</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="doctorRecordsBody">
                                <!-- Records will be dynamically added here -->
                                <tr class="empty-row">
                                    <td colspan="8">
                                        <div class="empty-state">
                                            <i class="fas fa-clipboard-list"></i>
                                            <p>No consultations today</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lab Reports Module -->
        <div class="module" id="lab-reports-module">
            <div class="module-header">
                <div class="module-header-content">
                    <div>
                        <h1 class="module-title">Lab Reports</h1>
                        <p class="module-description">View and manage laboratory test results and reports</p>
                    </div>
                    <button class="btn btn-secondary" onclick="closeLabReportsModule()" id="labReportsBackBtn">
                        <i class="fas fa-arrow-left"></i>
                        <span id="labReportsBackText">Back</span>
                    </button>
                </div>
            </div>

            <div class="module-content">
                <!-- Stats Grid -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-vials"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">New Reports</span>
                            <span class="stat-value" id="labReportsNewCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Today</span>
                            <span class="stat-value" id="labReportsTodayCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">This Week</span>
                            <span class="stat-value" id="labReportsWeekCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Reviewed</span>
                            <span class="stat-value" id="labReportsReviewedCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- New Reports Alert Section -->
                <div id="newLabReportsAlert" style="display: none; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-bell" style="font-size: 24px;"></i>
                            <div style="flex: 1;">
                                <h3 style="margin: 0 0 5px 0; font-size: 16px;">New Lab Reports Available</h3>
                                <p style="margin: 0; opacity: 0.9; font-size: 14px;">You have <strong id="newReportsCount">0</strong> new lab reports ready for review</p>
                            </div>
                            <button class="btn btn-light" onclick="filterNewReports()" style="background: white; color: #667eea;">
                                <i class="fas fa-eye"></i>
                                View New
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Lab Reports Table Section -->
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-flask"></i>
                        Laboratory Reports
                    </h2>
                    <div class="section-actions lab-reports-actions">
                        <input type="search" class="search-input" placeholder="Search patient..." id="labReportsSearchInput" oninput="filterLabReports()">
                        <select class="form-control filter-select" id="labReportsTimeFilter" onchange="filterLabReports()">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                        <select class="form-control filter-select" id="labReportsStatusFilter" onchange="filterLabReports()">
                            <option value="">All Reports</option>
                            <option value="new">New</option>
                            <option value="reviewed">Reviewed</option>
                        </select>
                        <button class="btn btn-sm btn-primary" onclick="refreshLabReports()">
                            <i class="fas fa-sync-alt"></i>
                            <span class="btn-text">Refresh</span>
                        </button>
                    </div>
                </div>

                <div class="records-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Report ID</th>
                                <th>Date Completed</th>
                                <th>Patient ID</th>
                                <th>Patient Name</th>
                                <th>Age/Gender</th>
                                <th>Tests Performed</th>
                                <th>Performed By</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="labReportsBody">
                            <tr class="empty-row">
                                <td colspan="9">
                                    <div class="empty-state">
                                        <i class="fas fa-flask"></i>
                                        <p>No lab reports available</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- All Consultations Module -->
        <div class="module" id="all-consultations-module" style="display: none;">
            <div class="module-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 class="module-title">All Consultations</h1>
                        <p class="module-description">Complete consultation history and patient records</p>
                    </div>
                    <button class="btn btn-secondary" onclick="closeAllConsultationsModule()">
                        <i class="fas fa-arrow-left"></i>
                        Back to Doctor Module
                    </button>
                </div>
            </div>

            <div class="module-content">
                <!-- Stats Row -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Today</span>
                            <span class="stat-value" id="allConsultationsToday">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-calendar-week"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">This Week</span>
                            <span class="stat-value" id="allConsultationsWeek">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">This Month</span>
                            <span class="stat-value" id="allConsultationsMonth">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Total</span>
                            <span class="stat-value" id="allConsultationsTotal">0</span>
                        </div>
                    </div>
                </div>

                <!-- Filters Section -->
                <div class="section-header" style="margin-bottom: 20px;">
                    <h2 class="section-title">
                        <i class="fas fa-list"></i>
                        Consultation Records
                    </h2>
                    <div class="section-actions">
                        <input type="date" class="form-control" id="allConsultationsFromDate" style="width: 150px;">
                        <span style="margin: 0 10px;">to</span>
                        <input type="date" class="form-control" id="allConsultationsToDate" style="width: 150px;">
                        <input type="search" class="search-input" placeholder="Search by name, ID..." id="allConsultationsSearch" style="margin-left: 15px;">
                        <button class="btn btn-sm btn-primary" onclick="filterAllConsultations()">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="resetAllConsultationsFilters()">
                            <i class="fas fa-redo"></i>
                            Reset
                        </button>
                    </div>
                </div>

                <!-- Consultations Table -->
                <div class="records-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Patient ID</th>
                                <th>Patient Name</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Complaint</th>
                                <th>Diagnosis</th>
                                <th>History</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allConsultationsBody">
                            <tr>
                                <td colspan="10" class="text-center">Loading consultations...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Ward & Nursing Module -->
        <div class="module" id="ward-nursing-module">
            <div class="module-header">
                <h1 class="module-title">Ward & Nursing</h1>
                <p class="module-description">Inpatient management, bed allocation, patient care, and monitoring</p>
            </div>

            <!-- Stats Grid -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(139, 92, 246, 0.1);">
                        <i class="fas fa-users" style="color: #8b5cf6;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="wardQueueCount">0</h3>
                        <p class="stat-label">Queue from Doctors</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(16, 185, 129, 0.1);">
                        <i class="fas fa-bed" style="color: #10b981;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="wardTotalPatients">0</h3>
                        <p class="stat-label">Total Admitted</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-hospital-user" style="color: #f59e0b;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="wardAdmittedToday">0</h3>
                        <p class="stat-label">Admitted Today</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background-color: rgba(14, 165, 233, 0.1);">
                        <i class="fas fa-door-open" style="color: #0ea5e9;"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value" id="wardOccupiedBeds">0</h3>
                        <p class="stat-label">Occupied Beds</p>
                    </div>
                </div>
            </div>

            <!-- Nursing Station Queue -->
            <div class="section-container">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-user-nurse"></i> Nursing Station Queue
                        <span class="badge" id="queueBadge">0</span>
                    </h2>
                    <button class="btn btn-secondary" onclick="refreshWardQueue()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
                
                <div class="queue-container" id="wardQueueContainer">
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading queue...</p>
                    </div>
                </div>
            </div>

            <!-- Ward Patients Table -->
            <div class="table-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-bed"></i> Ward Patients
                    </h2>
                    <div class="section-actions">
                        <div class="search-box-inline">
                            <i class="fas fa-search"></i>
                            <input type="text" id="wardSearchInput" placeholder="Search patients..." class="search-input-inline">
                        </div>
                        <select id="wardStatusFilter" class="filter-select">
                            <option value="">All Status</option>
                            <option value="admitted">Admitted</option>
                            <option value="stable">Stable</option>
                            <option value="critical">Critical</option>
                            <option value="discharged">Discharged</option>
                        </select>
                        <button class="btn btn-secondary" onclick="refreshWardPatients()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-wrapper">
                        <table class="patients-table">
                            <thead>
                                <tr>
                                    <th>Patient ID</th>
                                    <th>Patient Name</th>
                                    <th>Age</th>
                                    <th>Gender</th>
                                    <th>Bed No.</th>
                                    <th>Admission Date</th>
                                    <th>Diagnosis</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="wardPatientsTableBody">
                                <tr>
                                    <td colspan="9" class="loading-row">
                                        <i class="fas fa-spinner fa-spin"></i> Loading patients...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Ward Patient Modal -->
        <div class="modal" id="viewWardPatientModal">
            <div class="modal-overlay" onclick="closeViewWardPatientModal()"></div>
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-user-injured"></i>
                        Ward Patient Details
                    </h2>
                    <button class="modal-close" onclick="closeViewWardPatientModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Patient Information -->
                    <div class="info-section">
                        <h3 class="info-section-title">
                            <i class="fas fa-id-card"></i>
                            Patient Information
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Patient ID:</span>
                                <span class="info-value" id="viewWardPatientId">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Patient Name:</span>
                                <span class="info-value" id="viewWardPatientName">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Age:</span>
                                <span class="info-value" id="viewWardPatientAge">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Gender:</span>
                                <span class="info-value" id="viewWardPatientGender">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Admission Details -->
                    <div class="info-section">
                        <h3 class="info-section-title">
                            <i class="fas fa-hospital"></i>
                            Admission Details
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Bed Number:</span>
                                <span class="info-value" id="viewWardBedNumber">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Admission Date:</span>
                                <span class="info-value" id="viewWardAdmissionDate">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Referring Doctor:</span>
                                <span class="info-value" id="viewWardReferringDoctor">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Status:</span>
                                <span class="info-value" id="viewWardStatus">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Clinical Information -->
                    <div class="info-section">
                        <h3 class="info-section-title">
                            <i class="fas fa-stethoscope"></i>
                            Clinical Information
                        </h3>
                        <div class="info-item" style="display: block;">
                            <span class="info-label">Diagnosis:</span>
                            <p class="info-value" id="viewWardDiagnosis" style="margin-top: 8px; line-height: 1.6;">-</p>
                        </div>
                        <div class="info-item" style="display: block; margin-top: 15px;">
                            <span class="info-label">Treatment Plan:</span>
                            <p class="info-value" id="viewWardTreatmentPlan" style="margin-top: 8px; line-height: 1.6;">-</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeViewWardPatientModal()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                    <button class="btn btn-primary" onclick="printWardPatientFromModal()">
                        <i class="fas fa-print"></i>
                        Print
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Ward Patient Modal -->
        <div class="modal" id="editWardPatientModal">
            <div class="modal-overlay" onclick="closeEditWardPatientModal()"></div>
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-edit"></i>
                        Edit Ward Patient
                    </h2>
                    <button class="modal-close" onclick="closeEditWardPatientModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Hidden field for patient ID -->
                    <input type="hidden" id="editWardPatientDocId">

                    <!-- Patient Information (Read-only) -->
                    <div class="info-section">
                        <h3 class="info-section-title">
                            <i class="fas fa-user"></i>
                            Patient Information
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Patient ID:</span>
                                <span class="info-value" id="editWardPatientIdDisplay">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Patient Name:</span>
                                <span class="info-value" id="editWardPatientNameDisplay">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Editable Fields -->
                    <div class="form-section">
                        <h3 class="info-section-title">
                            <i class="fas fa-hospital-user"></i>
                            Ward Details
                        </h3>
                        
                        <div class="form-group">
                            <label for="editWardBedNumber">Bed Number</label>
                            <input type="text" class="form-control" id="editWardBedNumber" placeholder="e.g., B-12, Ward A-5">
                        </div>

                        <div class="form-group">
                            <label for="editWardStatus">Status</label>
                            <select class="form-control" id="editWardStatus">
                                <option value="admitted">Admitted</option>
                                <option value="stable">Stable</option>
                                <option value="critical">Critical</option>
                                <option value="discharged">Discharged</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="editWardDiagnosis">Diagnosis</label>
                            <textarea class="form-control" id="editWardDiagnosis" rows="3" placeholder="Enter diagnosis"></textarea>
                        </div>

                        <div class="form-group">
                            <label for="editWardTreatmentPlan">Treatment Plan</label>
                            <textarea class="form-control" id="editWardTreatmentPlan" rows="3" placeholder="Enter treatment plan"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeEditWardPatientModal()">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <button class="btn btn-success" onclick="saveWardPatientChanges()">
                        <i class="fas fa-save"></i>
                        Save Changes
                    </button>
                </div>
            </div>
        </div>

        <!-- Patient Management Modal (Full Management Interface) -->
        <div class="modal" id="managePatientModal">
            <div class="modal-overlay" onclick="closeManagePatientModal()"></div>
            <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-user-md"></i>
                        Patient Management
                    </h2>
                    <button class="modal-close" onclick="closeManagePatientModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Hidden field for patient ID -->
                    <input type="hidden" id="managePatientDocId">

                    <!-- Patient Header Section -->
                    <div class="patient-header-section" style="background: #2563eb; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0 0 5px 0; font-size: 24px;" id="managePatientName">-</h3>
                                <p style="margin: 0; opacity: 0.9;">
                                    <span id="managePatientId">-</span> | 
                                    <span id="managePatientAge">-</span> | 
                                    <span id="managePatientGender">-</span>
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 5px; margin-bottom: 8px;">
                                    <strong>Bed:</strong> <span id="managePatientBed">-</span>
                                </div>
                                <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 5px;">
                                    <strong>Status:</strong> <span id="managePatientStatus">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Navigation -->
                    <div class="manage-tabs" style="display: flex; gap: 10px; border-bottom: 2px solid #e5e7eb; margin-bottom: 20px;">
                        <button class="manage-tab active" onclick="switchManageTab('vitals')" data-tab="vitals">
                            <i class="fas fa-heartbeat"></i> Vitals
                        </button>
                        <button class="manage-tab" onclick="switchManageTab('notes')" data-tab="notes">
                            <i class="fas fa-notes-medical"></i> Notes
                        </button>
                        <button class="manage-tab" onclick="switchManageTab('treatment')" data-tab="treatment">
                            <i class="fas fa-prescription"></i> Treatment
                        </button>
                        <button class="manage-tab" onclick="switchManageTab('discharge')" data-tab="discharge">
                            <i class="fas fa-file-medical"></i> Discharge Summary
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div class="manage-tab-content">
                        <!-- Vitals Tab -->
                        <div class="tab-pane active" id="vitalsTab">
                            <h3 style="margin-bottom: 15px;">
                                <i class="fas fa-heartbeat"></i> Patient Vitals
                            </h3>
                            
                            <!-- Vitals Form -->
                            <div class="vitals-form" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                <div class="form-group">
                                    <label for="vitalBloodPressure">Blood Pressure (mmHg)</label>
                                    <input type="text" class="form-control" id="vitalBloodPressure" placeholder="120/80">
                                </div>
                                <div class="form-group">
                                    <label for="vitalHeartRate">Heart Rate (bpm)</label>
                                    <input type="number" class="form-control" id="vitalHeartRate" placeholder="72">
                                </div>
                                <div class="form-group">
                                    <label for="vitalTemperature">Temperature (C)</label>
                                    <input type="number" step="0.1" class="form-control" id="vitalTemperature" placeholder="36.5">
                                </div>
                                <div class="form-group">
                                    <label for="vitalRespiratoryRate">Respiratory Rate (breaths/min)</label>
                                    <input type="number" class="form-control" id="vitalRespiratoryRate" placeholder="16">
                                </div>
                                <div class="form-group">
                                    <label for="vitalOxygenSaturation">Oxygen Saturation (%)</label>
                                    <input type="number" class="form-control" id="vitalOxygenSaturation" placeholder="98">
                                </div>
                                <div class="form-group">
                                    <label for="vitalWeight">Weight (kg)</label>
                                    <input type="number" step="0.1" class="form-control" id="vitalWeight" placeholder="70.0">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="saveVitals()">
                                <i class="fas fa-save"></i> Save Vitals
                            </button>

                            <!-- Vitals History -->
                            <div class="vitals-history" style="margin-top: 30px;">
                                <h4>Vitals History</h4>
                                <div id="vitalsHistoryList" style="max-height: 300px; overflow-y: auto;">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Notes Tab -->
                        <div class="tab-pane" id="notesTab" style="display: none;">
                            <h3 style="margin-bottom: 15px;">
                                <i class="fas fa-notes-medical"></i> Clinical Notes
                            </h3>
                            
                            <!-- Add Note Form -->
                            <div class="add-note-form" style="margin-bottom: 20px;">
                                <div class="form-group">
                                    <label for="noteType">Note Type</label>
                                    <select class="form-control" id="noteType">
                                        <option value="nursing">Nursing Note</option>
                                        <option value="doctor">Doctor's Note</option>
                                        <option value="observation">Observation</option>
                                        <option value="incident">Incident Report</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="noteContent">Note Content</label>
                                    <textarea class="form-control" id="noteContent" rows="4" placeholder="Enter clinical note..."></textarea>
                                </div>
                                <button class="btn btn-primary" onclick="addClinicalNote()">
                                    <i class="fas fa-plus"></i> Add Note
                                </button>
                            </div>

                            <!-- Notes History -->
                            <div class="notes-history">
                                <h4>Notes History</h4>
                                <div id="notesHistoryList" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Treatment Tab -->
                        <div class="tab-pane" id="treatmentTab" style="display: none;">
                            <h3 style="margin-bottom: 15px;">
                                <i class="fas fa-prescription"></i> Treatment & Medications
                            </h3>
                            
                            <!-- Current Diagnosis -->
                            <div class="form-group">
                                <label for="currentDiagnosis">Current Diagnosis</label>
                                <textarea class="form-control" id="currentDiagnosis" rows="2" placeholder="Enter diagnosis..."></textarea>
                            </div>

                            <!-- Treatment Plan -->
                            <div class="form-group">
                                <label for="currentTreatmentPlan">Treatment Plan</label>
                                <textarea class="form-control" id="currentTreatmentPlan" rows="3" placeholder="Enter treatment plan..."></textarea>
                            </div>

                            <!-- Add Medication -->
                            <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin: 20px 0;">
                                <h4 style="margin-bottom: 15px;">Add Medication</h4>
                                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                                    <input type="text" class="form-control" id="medicationName" placeholder="Medication name">
                                    <input type="text" class="form-control" id="medicationDosage" placeholder="Dosage">
                                    <input type="text" class="form-control" id="medicationFrequency" placeholder="Frequency">
                                    <button class="btn btn-primary" onclick="addMedication()">
                                        <i class="fas fa-plus"></i> Add
                                    </button>
                                </div>
                            </div>

                            <!-- Current Medications -->
                            <div class="medications-list">
                                <h4>Current Medications</h4>
                                <div id="medicationsList" style="max-height: 300px; overflow-y: auto;">
                                    <!-- Will be populated dynamically -->
                                </div>
                            </div>

                            <button class="btn btn-success" onclick="saveTreatmentPlan()" style="margin-top: 20px;">
                                <i class="fas fa-save"></i> Save Treatment Plan
                            </button>
                        </div>

                        <!-- Discharge Summary Tab -->
                        <div class="tab-pane" id="dischargeTab" style="display: none;">
                            <h3 style="margin-bottom: 15px;">
                                <i class="fas fa-file-medical"></i> Discharge Summary
                            </h3>
                            
                            <div class="form-group">
                                <label for="dischargeDate">Discharge Date</label>
                                <input type="datetime-local" class="form-control" id="dischargeDate">
                            </div>

                            <div class="form-group">
                                <label for="admissionReason">Reason for Admission</label>
                                <textarea class="form-control" id="admissionReason" rows="2" placeholder="Reason for admission..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="hospitalCourse">Hospital Course</label>
                                <textarea class="form-control" id="hospitalCourse" rows="4" placeholder="Brief summary of patient's hospital course..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="dischargeDiagnosis">Discharge Diagnosis</label>
                                <textarea class="form-control" id="dischargeDiagnosis" rows="2" placeholder="Final diagnosis..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="dischargeMedications">Discharge Medications</label>
                                <textarea class="form-control" id="dischargeMedications" rows="3" placeholder="Medications to continue at home..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="followUpInstructions">Follow-up Instructions</label>
                                <textarea class="form-control" id="followUpInstructions" rows="3" placeholder="Follow-up appointments, wound care, activity restrictions..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="dischargeCondition">Discharge Condition</label>
                                <select class="form-control" id="dischargeCondition">
                                    <option value="">Select condition</option>
                                    <option value="improved">Improved</option>
                                    <option value="stable">Stable</option>
                                    <option value="unchanged">Unchanged</option>
                                    <option value="worsened">Worsened</option>
                                </select>
                            </div>

                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="btn btn-success" onclick="saveDischargeSummary()">
                                    <i class="fas fa-save"></i> Save Summary
                                </button>
                                <button class="btn btn-primary" onclick="printDischargeSummary()">
                                    <i class="fas fa-print"></i> Print Discharge Summary
                                </button>
                                <button class="btn btn-danger" onclick="dischargePatient()">
                                    <i class="fas fa-sign-out-alt"></i> Discharge Patient
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeManagePatientModal()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Laboratory Module -->
        <div class="module" id="laboratory-module">
            <div class="module-header">
                <h1 class="module-title">Laboratory</h1>
                <p class="module-description">Test orders, sample tracking, results management, and reporting</p>
            </div>

            <div class="module-content">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-vials"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Pending Requests</span>
                            <span class="stat-value" id="labPendingCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-spinner"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">In Progress</span>
                            <span class="stat-value" id="labInProgressCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Today's Requests</span>
                            <span class="stat-value" id="labTodayCount">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Completed Today</span>
                            <span class="stat-value" id="labCompletedCount">0</span>
                        </div>
                    </div>
                </div>

                <!-- Queue Section -->
                <div class="lab-queue-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-clipboard-list"></i>
                            Requests from Doctors
                        </h2>
                        <button class="btn btn-sm btn-primary" onclick="refreshLabQueue()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                    
                    <div class="lab-queue-horizontal">
                        <div class="lab-queue-scroll" id="labReportsQueue">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>No pending requests from doctors</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lab Requests Table -->
                <div class="lab-requests-section">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-flask"></i>
                            Laboratory Requests
                        </h2>
                        <div class="section-actions">
                            <input type="search" class="search-input" placeholder="Search by patient ID or name..." id="labSearchInput">
                            <select class="form-control" id="labStatusFilter" style="width: 150px;">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="sent">Sent to Doctor</option>
                            </select>
                            <button class="btn btn-sm btn-primary" onclick="openLabReportsModuleFromLab()">
                                <i class="fas fa-file-medical"></i>
                                All Lab Reports
                            </button>
                        </div>
                    </div>

                    <div class="records-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Request ID</th>
                                    <th>Date/Time</th>
                                    <th>Patient ID</th>
                                    <th>Patient Name</th>
                                    <th>Age/Gender</th>
                                    <th>Tests Requested</th>
                                    <th>Requested By</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="labRequestsBody">
                                <tr class="empty-row">
                                    <td colspan="9">
                                        <div class="empty-state">
                                            <i class="fas fa-flask"></i>
                                            <p>No lab requests</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pharmacy Module -->
        <div class="module" id="pharmacy-module">
            <div class="module-header">
                <h1 class="module-title">Pharmacy</h1>
                <p class="module-description">Medication dispensing, prescription management, and drug inventory</p>
            </div>
        </div>

        <!-- Pharmacy Inventory Sub-module -->
        <div class="module" id="pharmacy-inventory-module">
            <div class="module-header">
                <div>
                    <h1 class="module-title">Pharmacy Inventory</h1>
                    <p class="module-description">Manage medication stock levels, expiry dates, and reorder alerts</p>
                </div>
                <button class="btn btn-primary" id="addNewDrugBtn">
                    <i class="fas fa-plus"></i> Add Product
                </button>
            </div>

            <!-- Pharmacy Statistics Cards -->
            <div class="expense-stats-grid">
                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(37, 99, 235, 0.1);">
                        <i class="fas fa-pills" style="color: #2563eb;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="totalDrugsCount">0</h3>
                        <p class="stat-label">Total Products</p>
                    </div>
                </div>

                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(16, 185, 129, 0.1);">
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="inStockCount">0</h3>
                        <p class="stat-label">In Stock</p>
                    </div>
                </div>

                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="lowStockCount">0</h3>
                        <p class="stat-label">Low Stock</p>
                    </div>
                </div>

                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(239, 68, 68, 0.1);">
                        <i class="fas fa-calendar-times" style="color: #ef4444;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="expiringSoonCount">0</h3>
                        <p class="stat-label">Expiring Soon</p>
                    </div>
                </div>
            </div>

            <!-- Filters and Actions -->
            <div class="expense-controls">
                <div class="expense-filters">
                    <div class="filter-group">
                        <label for="filterDrugCategory">Category</label>
                        <select id="filterDrugCategory" class="filter-select">
                            <option value="">All Categories</option>
                            <option value="analgesics">Analgesics</option>
                            <option value="antibiotics">Antibiotics</option>
                            <option value="antivirals">Antivirals</option>
                            <option value="antifungals">Antifungals</option>
                            <option value="antihistamines">Antihistamines</option>
                            <option value="cardiovascular">Cardiovascular</option>
                            <option value="diabetes">Diabetes</option>
                            <option value="gastrointestinal">Gastrointestinal</option>
                            <option value="respiratory">Respiratory</option>
                            <option value="dermatological">Dermatological</option>
                            <option value="psychiatric">Psychiatric</option>
                            <option value="vitamins">Vitamins & Supplements</option>
                            <option value="injections">Injections</option>
                            <option value="iv-fluids">IV Fluids</option>
                            <option value="surgical">Surgical Supplies</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filterDrugType">Type</label>
                        <select id="filterDrugType" class="filter-select">
                            <option value="">All Types</option>
                            <option value="tablet">Tablet</option>
                            <option value="capsule">Capsule</option>
                            <option value="syrup">Syrup</option>
                            <option value="injection">Injection</option>
                            <option value="cream">Cream/Ointment</option>
                            <option value="drops">Drops</option>
                            <option value="inhaler">Inhaler</option>
                            <option value="suppository">Suppository</option>
                            <option value="powder">Powder</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filterStockStatus">Stock Status</label>
                        <select id="filterStockStatus" class="filter-select">
                            <option value="">All Status</option>
                            <option value="in-stock">In Stock</option>
                            <option value="low-stock">Low Stock</option>
                            <option value="out-of-stock">Out of Stock</option>
                            <option value="expiring-soon">Expiring Soon</option>
                            <option value="expired">Expired</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filterPrescriptionType">Prescription</label>
                        <select id="filterPrescriptionType" class="filter-select">
                            <option value="">All</option>
                            <option value="prescription">Prescription Only</option>
                            <option value="otc">Over the Counter</option>
                        </select>
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" id="applyDrugFiltersBtn">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>
                        <button class="btn btn-outline" id="clearDrugFiltersBtn">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>

                <div class="expense-actions">
                    <button class="btn btn-primary" id="newPrescriptionBtn" style="background: #8b5cf6;">
                        <i class="fas fa-prescription"></i> New Prescription
                    </button>
                    <button class="btn btn-success" id="exportDrugsBtn">
                        <i class="fas fa-file-export"></i> Export CSV
                    </button>
                    <button class="btn btn-warning" id="generateReportBtn">
                        <i class="fas fa-chart-bar"></i> Generate Report
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="drugSearchInput" placeholder="Search by drug name, generic name, manufacturer, or batch number..." class="search-input">
                </div>
            </div>

            <!-- Drugs Table -->
            <div class="table-container">
                <div class="table-wrapper">
                    <table class="expenses-table" id="drugsTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllDrugs">
                                </th>
                                <th>Drug Code</th>
                                <th>Drug Name</th>
                                <th>Generic Name</th>
                                <th>Category</th>
                                <th>Type</th>
                                <th>Stock Qty</th>
                                <th>Unit Price</th>
                                <th>Expiry Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="drugsTableBody">
                            <tr>
                                <td colspan="11" class="empty-state">
                                    <div class="empty-state-content">
                                        <i class="fas fa-pills"></i>
                                        <h3>No Drugs Found</h3>
                                        <p>Start by adding your first medication to the pharmacy inventory</p>
                                        <button class="btn btn-primary" id="addFirstDrugBtn">
                                            <i class="fas fa-plus"></i> Add Product
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-container" id="drugPaginationContainer" style="display: none;">
                <div class="pagination-info">
                    Showing <span id="drugShowingStart">0</span> to <span id="drugShowingEnd">0</span> of <span id="drugTotalRecords">0</span> products
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="drugFirstPageBtn" disabled>
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="pagination-btn" id="drugPrevPageBtn" disabled>
                        <i class="fas fa-angle-left"></i>
                    </button>
                    <span class="page-info">Page <span id="drugCurrentPage">1</span> of <span id="drugTotalPages">1</span></span>
                    <button class="pagination-btn" id="drugNextPageBtn" disabled>
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="pagination-btn" id="drugLastPageBtn" disabled>
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                </div>
                <div class="pagination-size">
                    <label>Show:</label>
                    <select id="drugPageSize" class="page-size-select">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Add Drug Modal -->
        <div class="modal" id="addDrugModal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title">Add New Product</h2>
                    <button class="close-modal" id="closeAddDrugModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addDrugForm" class="inventory-form">
                        <!-- Basic Information -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="drugName">Drug Name <span class="required">*</span></label>
                                <input type="text" id="drugName" name="drugName" class="form-input" placeholder="e.g., Paracetamol" required>
                            </div>
                            <div class="form-group">
                                <label for="genericName">Generic Name</label>
                                <input type="text" id="genericName" name="genericName" class="form-input" placeholder="e.g., Acetaminophen">
                            </div>
                        </div>

                        <div class="form-row three-cols">
                            <div class="form-group">
                                <label for="drugCategory">Category <span class="required">*</span></label>
                                <select id="drugCategory" name="drugCategory" class="form-input" required>
                                    <option value="" disabled selected>-- Select Category --</option>
                                    <option value="analgesics">Analgesics</option>
                                    <option value="antibiotics">Antibiotics</option>
                                    <option value="antivirals">Antivirals</option>
                                    <option value="antifungals">Antifungals</option>
                                    <option value="antihistamines">Antihistamines</option>
                                    <option value="cardiovascular">Cardiovascular</option>
                                    <option value="diabetes">Diabetes</option>
                                    <option value="gastrointestinal">Gastrointestinal</option>
                                    <option value="respiratory">Respiratory</option>
                                    <option value="dermatological">Dermatological</option>
                                    <option value="psychiatric">Psychiatric</option>
                                    <option value="vitamins">Vitamins & Supplements</option>
                                    <option value="injections">Injections</option>
                                    <option value="iv-fluids">IV Fluids</option>
                                    <option value="surgical">Surgical Supplies</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="drugType">Type <span class="required">*</span></label>
                                <select id="drugType" name="drugType" class="form-input" required>
                                    <option value="" disabled selected>-- Select Type --</option>
                                    <option value="tablet">Tablet</option>
                                    <option value="capsule">Capsule</option>
                                    <option value="syrup">Syrup</option>
                                    <option value="injection">Injection</option>
                                    <option value="cream">Cream/Ointment</option>
                                    <option value="drops">Drops</option>
                                    <option value="inhaler">Inhaler</option>
                                    <option value="suppository">Suppository</option>
                                    <option value="powder">Powder</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="strength">Strength/Dosage</label>
                                <input type="text" id="strength" name="strength" class="form-input" placeholder="e.g., 500mg, 10ml">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="manufacturer">Manufacturer</label>
                                <input type="text" id="manufacturer" name="manufacturer" class="form-input" placeholder="Manufacturer name">
                            </div>
                            <div class="form-group">
                                <label for="supplierName">Supplier Name</label>
                                <input type="text" id="supplierName" name="supplierName" class="form-input" placeholder="Supplier name">
                            </div>
                        </div>

                        <!-- Stock & Batch Information -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="batchNumber">Batch Number <span class="required">*</span></label>
                                <input type="text" id="batchNumber" name="batchNumber" class="form-input" placeholder="e.g., BATCH12345" required>
                            </div>
                            <div class="form-group">
                                <label for="expiryDate">Expiry Date <span class="required">*</span></label>
                                <input type="date" id="expiryDate" name="expiryDate" class="form-input" required>
                            </div>
                        </div>

                        <div class="form-row three-cols">
                            <div class="form-group">
                                <label for="stockQuantity">Stock Quantity <span class="required">*</span></label>
                                <input type="number" id="stockQuantity" name="stockQuantity" class="form-input" placeholder="0" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="reorderLevel">Reorder Level <span class="required">*</span></label>
                                <input type="number" id="reorderLevel" name="reorderLevel" class="form-input" placeholder="Min stock level" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="unitOfMeasure">Unit</label>
                                <select id="unitOfMeasure" name="unitOfMeasure" class="form-input">
                                    <option value="tablets">Tablets</option>
                                    <option value="capsules">Capsules</option>
                                    <option value="bottles">Bottles</option>
                                    <option value="vials">Vials</option>
                                    <option value="boxes">Boxes</option>
                                    <option value="packs">Packs</option>
                                    <option value="strips">Strips</option>
                                    <option value="tubes">Tubes</option>
                                </select>
                            </div>
                        </div>

                        <!-- Pricing Information -->
                        <div class="form-row three-cols">
                            <div class="form-group">
                                <label for="costPrice">Cost Price (KSh) <span class="required">*</span></label>
                                <input type="number" id="costPrice" name="costPrice" class="form-input" placeholder="0.00" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="sellingPrice">Selling Price (KSh) <span class="required">*</span></label>
                                <input type="number" id="sellingPrice" name="sellingPrice" class="form-input" placeholder="0.00" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="totalValue">Total Value (KSh)</label>
                                <input type="text" id="totalValue" name="totalValue" class="form-input" placeholder="0.00" readonly>
                                <small class="helper-text">Auto-calculated</small>
                            </div>
                        </div>

                        <!-- Additional Details -->
                        <div class="form-row">
                            <div class="form-group">
                                <label for="prescriptionType">Prescription Type <span class="required">*</span></label>
                                <select id="prescriptionType" name="prescriptionType" class="form-input" required>
                                    <option value="" disabled selected>-- Select Type --</option>
                                    <option value="prescription">Prescription Only</option>
                                    <option value="otc">Over the Counter (OTC)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="storageCondition">Storage Condition</label>
                                <select id="storageCondition" name="storageCondition" class="form-input">
                                    <option value="room-temperature">Room Temperature</option>
                                    <option value="refrigerated">Refrigerated (2-8C)</option>
                                    <option value="frozen">Frozen</option>
                                    <option value="cool-dry">Cool & Dry Place</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="description">Description/Notes</label>
                                <textarea id="description" name="description" class="form-input" rows="3" placeholder="Additional information about the drug..."></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelDrugBtn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-check"></i> Add to Inventory
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- View Drug Details Modal -->
        <div class="modal" id="viewDrugModal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title">Drug Details</h2>
                    <button class="close-modal" id="closeViewDrugModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="viewDrugModalBody">
                    <!-- Drug details will be populated here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" id="closeViewDrugModalFooter">Close</button>
                    <button class="btn btn-primary" id="printDrugBtn">
                        <i class="fas fa-print"></i> Print Label
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Drug Modal -->
        <div class="modal" id="editDrugModal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Product</h2>
                    <button class="close-modal" id="closeEditDrugModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="editDrugModalBody">
                    <!-- Edit form will be populated here -->
                </div>
            </div>
        </div>

        <!-- New Prescription Modal -->
        <div class="modal" id="newPrescriptionModal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title">New Prescription</h2>
                    <button class="close-modal" id="closePrescriptionModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="newPrescriptionForm" class="inventory-form">
                        <!-- Patient Information Section -->
                        <div class="section-container">
                            <div class="section-header">
                                <i class="fas fa-user-injured"></i>
                                <h4>Patient Information</h4>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prescPatientId">Patient ID <span class="required">*</span></label>
                                    <input type="text" id="prescPatientId" class="form-input" placeholder="Enter patient ID" required>
                                </div>
                                <div class="form-group">
                                    <label for="prescPatientName">Patient Name <span class="required">*</span></label>
                                    <input type="text" id="prescPatientName" class="form-input" placeholder="Patient full name" required>
                                </div>
                            </div>

                            <div class="form-row three-cols">
                                <div class="form-group">
                                    <label for="prescPatientAge">Age</label>
                                    <input type="number" id="prescPatientAge" class="form-input" placeholder="Age" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="prescPatientGender">Gender</label>
                                    <select id="prescPatientGender" class="form-input">
                                        <option value="">Select Gender</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prescPatientContact">Contact</label>
                                    <input type="tel" id="prescPatientContact" class="form-input" placeholder="Phone number">
                                </div>
                            </div>
                        </div>

                        <!-- Doctor Information Section -->
                        <div class="section-container">
                            <div class="section-header">
                                <i class="fas fa-user-md"></i>
                                <h4>Doctor Information</h4>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="prescDoctorName">Doctor Name <span class="required">*</span></label>
                                    <input type="text" id="prescDoctorName" class="form-input" placeholder="Prescribing doctor" required>
                                </div>
                                <div class="form-group">
                                    <label for="prescDate">Prescription Date <span class="required">*</span></label>
                                    <input type="date" id="prescDate" class="form-input" required>
                                </div>
                            </div>
                        </div>

                        <!-- Medications Section -->
                        <div class="section-container">
                            <div class="section-header">
                                <i class="fas fa-pills"></i>
                                <h4>Medications</h4>
                            </div>
                            
                            <div id="medicationsList" class="medications-wrapper">
                            <div class="medication-item" data-index="0">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Drug Name <span class="required">*</span></label>
                                        <select class="form-input medication-select" required>
                                            <option value="">-- Select Drug --</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Dosage <span class="required">*</span></label>
                                        <input type="text" class="form-input medication-dosage" placeholder="e.g., 2 tablets" required>
                                    </div>
                                </div>

                                <div class="form-row three-cols">
                                    <div class="form-group">
                                        <label>Frequency <span class="required">*</span></label>
                                        <select class="form-input medication-frequency" required>
                                            <option value="">Select</option>
                                            <option value="once-daily">Once Daily</option>
                                            <option value="twice-daily">Twice Daily</option>
                                            <option value="three-times">Three Times Daily</option>
                                            <option value="four-times">Four Times Daily</option>
                                            <option value="every-6-hours">Every 6 Hours</option>
                                            <option value="every-8-hours">Every 8 Hours</option>
                                            <option value="as-needed">As Needed (PRN)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Duration <span class="required">*</span></label>
                                        <input type="text" class="form-input medication-duration" placeholder="e.g., 7 days" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Quantity <span class="required">*</span></label>
                                        <input type="number" class="form-input medication-quantity" placeholder="Total quantity" min="1" required>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group full-width">
                                        <label>Instructions</label>
                                        <input type="text" class="form-input medication-instructions" placeholder="Special instructions (e.g., Take with food)">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                            <button type="button" class="btn btn-outline" id="addMedicationBtn">
                                <i class="fas fa-plus"></i> Add Another Medication
                            </button>
                        </div>

                        <!-- Additional Notes Section -->
                        <div class="section-container">
                            <div class="section-header">
                                <i class="fas fa-clipboard"></i>
                                <h4>Additional Information</h4>
                            </div>
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label for="prescNotes">Diagnosis & Notes</label>
                                    <textarea id="prescNotes" class="form-input" rows="3" placeholder="Diagnosis, warnings, or additional notes..."></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelPrescriptionBtn">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save & Print Prescription
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Pharmacy POS Sub-module -->
        <div class="module" id="pharmacy-pos-module">
            <div class="module-header">
                <h1 class="module-title">Pharmacy POS</h1>
                <p class="module-description">Point of sale system for medication dispensing and transactions</p>
            </div>

            <div class="module-content">
                <div class="pos-container">
                    <!-- Left Panel: Search & Prescription -->
                    <div class="pos-left-panel">
                        <!-- Drug Search Section -->
                        <div class="pos-section">
                            <div class="section-header">
                                <i class="fas fa-search"></i>
                                <h4>Search Drugs</h4>
                            </div>
                            <div class="search-box-container">
                                <input type="text" id="posSearchInput" class="form-input" placeholder="Search by drug name, code, or category...">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <div id="posSearchResults" class="pos-search-results"></div>
                            <div style="margin-top: 8px; font-size: 11px; color: var(--text-muted);">
                                <i class="fas fa-info-circle"></i> Type at least 2 characters to search
                            </div>
                        </div>

                        <!-- Prescription Lookup Section -->
                        <div class="pos-section prescription-lookup-section">
                            <div class="section-header">
                                <i class="fas fa-file-prescription"></i>
                                <h4>Load Prescription</h4>
                            </div>
                            <div class="prescription-lookup">
                                <div class="form-row">
                                    <div class="form-group">
                                        <div class="prescription-input-wrapper">
                                            <i class="fas fa-prescription"></i>
                                            <input type="text" id="prescriptionNumber" class="form-input prescription-input" placeholder="Enter prescription number (e.g., RX250123-A1B2)">
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary prescription-load-btn" id="loadPrescriptionBtn">
                                        <i class="fas fa-download"></i>
                                        <span>Load</span>
                                    </button>
                                </div>
                            </div>
                            <div class="prescription-lookup-hint">
                                <i class="fas fa-lightbulb"></i>
                                <span>Enter the prescription number to automatically load all prescribed medications</span>
                            </div>
                        </div>

                        <!-- Prescription Queue Section -->
                        <div class="pos-section prescription-queue-section">
                            <div class="section-header">
                                <i class="fas fa-clipboard-list"></i>
                                <h4>Prescription Queue</h4>
                                <span id="queueCount" class="queue-counter">0</span>
                            </div>
                            <div id="prescriptionQueue" class="prescription-queue-container">
                                <div class="empty-queue">
                                    <i class="fas fa-inbox"></i>
                                    <p>No Pending Prescriptions</p>
                                    <span>Prescriptions will appear here when patients check in</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Cart & Checkout -->
                    <div class="pos-right-panel">
                        <!-- Cart Section -->
                        <div class="pos-section cart-section">
                            <div class="section-header">
                                <i class="fas fa-shopping-cart"></i>
                                <h4>Cart <span id="cartItemCount" class="badge">0</span></h4>
                            </div>

                            <div class="cart-container">
                                <div id="cartItems" class="cart-items">
                                    <div class="empty-cart">
                                        <i class="fas fa-shopping-basket"></i>
                                        <p>Cart is empty</p>
                                        <span>Search and add drugs to cart</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Cart Summary -->
                            <div class="cart-summary">
                                <div class="summary-row">
                                    <span>Subtotal:</span>
                                    <span id="cartSubtotal">KSh 0.00</span>
                                </div>
                                <div class="summary-row editable-row">
                                    <label for="taxRate">Tax (%):</label>
                                    <div class="editable-input-group">
                                        <input type="number" id="taxRate" class="editable-input" value="0" min="0" max="100" step="0.1">
                                        <span id="cartTax">KSh 0.00</span>
                                    </div>
                                </div>
                                <div class="summary-row editable-row">
                                    <label for="discountAmount">Discount (KSh):</label>
                                    <div class="editable-input-group">
                                        <input type="number" id="discountAmount" class="editable-input" value="0" min="0" step="0.01">
                                        <span id="cartDiscount">KSh 0.00</span>
                                    </div>
                                </div>
                                <div class="summary-row total-row">
                                    <span>Total:</span>
                                    <span id="cartTotal">KSh 0.00</span>
                                </div>
                            </div>

                            <!-- Checkout Section -->
                            <div class="checkout-section">
                                <div class="form-group">
                                    <label for="customerName">Customer Name <span class="required">*</span></label>
                                    <input type="text" id="customerName" class="form-input" placeholder="Enter customer name">
                                </div>
                                <div class="form-group">
                                    <label for="customerContact">Contact (Optional)</label>
                                    <input type="tel" id="customerContact" class="form-input" placeholder="Phone number">
                                </div>
                                <div class="form-group">
                                    <label for="paymentMethod">Payment Method <span class="required">*</span></label>
                                    <select id="paymentMethod" class="form-input">
                                        <option value="">Select payment method</option>
                                        <option value="cash">Cash</option>
                                        <option value="card">Credit/Debit Card</option>
                                        <option value="mobile-money">Mobile Money</option>
                                        <option value="insurance">Insurance</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="prescriptionRef">Prescription # (Optional)</label>
                                    <input type="text" id="prescriptionRef" class="form-input" placeholder="Link to prescription" readonly>
                                </div>

                                <div class="checkout-actions">
                                    <button type="button" class="btn btn-secondary" id="clearCartBtn">
                                        <i class="fas fa-trash"></i> Clear Cart
                                    </button>
                                    <button type="button" class="btn btn-success" id="checkoutBtn">
                                        <i class="fas fa-cash-register"></i> Complete Sale
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pharmacy Sales Sub-module -->
        <div class="module" id="pharmacy-sales-module">
            <div class="module-header">
                <h1 class="module-title">All Sales</h1>
                <p class="module-description">View all pharmacy sales transactions, reports, and analytics</p>
            </div>

            <div class="module-content">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="totalRevenue">KSh 0.00</h3>
                            <p>Total Revenue</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="todaySales">KSh 0.00</h3>
                            <p>Today's Sales</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="totalTransactions">0</h3>
                            <p>Total Transactions</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-pills"></i>
                        </div>
                        <div class="stat-details">
                            <h3 id="itemsSold">0</h3>
                            <p>Items Sold</p>
                        </div>
                    </div>
                </div>

                <!-- Filters & Search -->
                <div class="sales-controls">
                    <div class="controls-left">
                        <!-- Search Bar -->
                        <div class="search-box-container">
                            <input type="text" id="salesSearchInput" class="form-input" placeholder="Search by sale #, customer name, or payment method...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                    
                    <div class="controls-right">
                        <!-- Date Filters -->
                        <select id="dateFilter" class="form-input filter-select">
                            <option value="all">All Time</option>
                            <option value="today" selected>Today</option>
                            <option value="yesterday">Yesterday</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="custom">Custom Range</option>
                        </select>
                        
                        <!-- Payment Method Filter -->
                        <select id="paymentFilter" class="form-input filter-select">
                            <option value="all">All Payments</option>
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="mobile-money">Mobile Money</option>
                            <option value="insurance">Insurance</option>
                        </select>
                        
                        <!-- Export Button -->
                        <button class="btn btn-primary" id="exportSalesBtn">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>

                <!-- Custom Date Range (Hidden by default) -->
                <div id="customDateRange" class="custom-date-range" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate">Start Date</label>
                            <input type="date" id="startDate" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="endDate">End Date</label>
                            <input type="date" id="endDate" class="form-input">
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn btn-primary" id="applyDateRange">
                                <i class="fas fa-check"></i> Apply
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sales Table -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Sale #</th>
                                <th>Date & Time</th>
                                <th>Customer</th>
                                <th>Items</th>
                                <th>Payment Method</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
                                    <p style="margin: 0;">Loading sales data...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination-container">
                    <div class="pagination-info">
                        Showing <span id="salesShowingStart">0</span> to <span id="salesShowingEnd">0</span> of <span id="salesTotalCount">0</span> sales
                    </div>
                    <div class="pagination-controls">
                        <button class="btn btn-sm" id="salesPrevPage" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span class="pagination-current">Page <span id="salesCurrentPage">1</span></span>
                        <button class="btn btn-sm" id="salesNextPage" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sale Details Modal -->
        <div class="modal" id="saleDetailsModal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-receipt"></i>
                        Sale Details
                    </h2>
                    <button class="modal-close" onclick="closeSaleDetailsModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Sale Info Banner -->
                    <div style="background: #2563eb; padding: 20px; border-radius: 8px; margin-bottom: 24px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <h3 style="margin: 0 0 8px 0; font-size: 18px;">
                                    <i class="fas fa-hashtag"></i> <span id="modalSaleNumber">-</span>
                                </h3>
                                <p style="margin: 0; opacity: 0.9;">
                                    <i class="fas fa-calendar"></i> <span id="modalSaleDate">-</span>
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <h2 style="margin: 0; font-size: 28px; font-weight: 700;">
                                    KSh <span id="modalSaleTotal">0.00</span>
                                </h2>
                                <p style="margin: 4px 0 0 0; opacity: 0.9;">
                                    <span id="modalSaleStatus" class="badge" style="background: rgba(255, 255, 255, 0.2); padding: 4px 12px; border-radius: 12px; font-size: 13px;">Completed</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Info -->
                    <div style="background: var(--sidebar-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--border-color);">
                        <h4 style="margin: 0 0 16px 0; color: var(--text-primary); font-size: 15px;">
                            <i class="fas fa-user"></i> Customer Information
                        </h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                            <div>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">Name</p>
                                <p style="margin: 4px 0 0 0; color: var(--text-primary); font-weight: 600;" id="modalCustomerName">-</p>
                            </div>
                            <div>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">Contact</p>
                                <p style="margin: 4px 0 0 0; color: var(--text-primary); font-weight: 600;" id="modalCustomerContact">-</p>
                            </div>
                            <div>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">Payment Method</p>
                                <p style="margin: 4px 0 0 0; color: var(--text-primary); font-weight: 600;" id="modalPaymentMethod">-</p>
                            </div>
                            <div>
                                <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">Served By</p>
                                <p style="margin: 4px 0 0 0; color: var(--text-primary); font-weight: 600;" id="modalServedBy">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Items Sold -->
                    <div style="background: var(--sidebar-bg); padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--border-color);">
                        <h4 style="margin: 0 0 16px 0; color: var(--text-primary); font-size: 15px;">
                            <i class="fas fa-pills"></i> Items Sold
                        </h4>
                        <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                            <table class="data-table" style="margin: 0;">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Item</th>
                                        <th style="text-align: center;">Quantity</th>
                                        <th style="text-align: right;">Unit Price</th>
                                        <th style="text-align: right;">Total</th>
                                    </tr>
                                </thead>
                                <tbody id="modalSaleItems">
                                    <tr>
                                        <td colspan="4" style="text-align: center; padding: 20px; color: var(--text-secondary);">No items</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Sale Summary -->
                    <div style="background: var(--bg-color); padding: 20px; border-radius: 8px; border: 2px solid var(--border-color);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--text-secondary);">Subtotal:</span>
                            <span style="color: var(--text-primary); font-weight: 600;">KSh <span id="modalSubtotal">0.00</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--text-secondary);">Tax:</span>
                            <span style="color: var(--text-primary); font-weight: 600;">KSh <span id="modalTax">0.00</span></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                            <span style="color: var(--text-secondary);">Discount:</span>
                            <span style="color: var(--text-primary); font-weight: 600;">KSh <span id="modalDiscount">0.00</span></span>
                        </div>
                        <div style="border-top: 2px solid var(--border-color); margin: 16px 0; padding-top: 16px; display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary); font-size: 18px; font-weight: 700;">Total:</span>
                            <span style="color: var(--primary-color); font-size: 24px; font-weight: 700;">KSh <span id="modalTotalAmount">0.00</span></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeSaleDetailsModal()">Close</button>
                    <button class="btn btn-primary" onclick="printSaleFromModal()">
                        <i class="fas fa-print"></i> Print Receipt
                    </button>
                </div>
            </div>
        </div>

        <!-- Billing Module -->
        <div class="module" id="billing-module">
            <div class="module-header">
                <div>
                    <h1 class="module-title">Billing & Payments</h1>
                    <p class="module-description">Patient invoicing, payment processing, and receipt generation</p>
                </div>
                <button class="btn btn-primary" onclick="showModule('billing-view')">
                    <i class="fas fa-file-invoice-dollar"></i> View All Bills
                </button>
            </div>

            <!-- Billing Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(52, 152, 219, 0.1);">
                        <i class="fas fa-money-bill-wave" style="color: #3498db;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="todayRevenue">KSh 0.00</h3>
                        <p>Today's Revenue</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(46, 204, 113, 0.1);">
                        <i class="fas fa-check-circle" style="color: #2ecc71;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="todayPayments">0</h3>
                        <p>Payments Today</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(241, 196, 15, 0.1);">
                        <i class="fas fa-hourglass-half" style="color: #f1c40f;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="pendingBills">0</h3>
                        <p>Pending Bills</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: rgba(155, 89, 182, 0.1);">
                        <i class="fas fa-calendar-check" style="color: #9b59b6;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 id="monthRevenue">KSh 0.00</h3>
                        <p>This Month</p>
                    </div>
                </div>
            </div>

            <!-- Patient Selection Section -->
            <div class="billing-section">
                <div class="section-header">
                    <i class="fas fa-user-search"></i>
                    <h4>Patient Selection</h4>
                </div>
                
                <!-- Selection Method Toggle -->
                <div style="display: flex; gap: 12px; margin-bottom: 20px;">
                    <button class="btn btn-primary" id="searchPatientBtn" onclick="toggleBillingMode('search')" style="flex: 1;">
                        <i class="fas fa-search"></i> Search Existing Patient
                    </button>
                    <button class="btn btn-secondary" id="manualBillBtn" onclick="toggleBillingMode('manual')" style="flex: 1;">
                        <i class="fas fa-edit"></i> Manual Entry
                    </button>
                </div>
                
                <!-- Patient Search -->
                <div id="patientSearchMode" class="patient-search-container">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search"></i>
                        <input type="text" id="billingPatientSearchInput" class="form-input" placeholder="Search by Patient Number, Name, or Phone...">
                    </div>
                    <div id="billingPatientSearchResults" class="patient-search-results"></div>
                </div>
                
                <!-- Manual Patient Entry -->
                <div id="manualPatientMode" class="manual-patient-entry" style="display: none;">
                    <p style="margin: 0 0 16px 0; padding: 12px; background: rgba(52, 152, 219, 0.1); border-radius: 8px; font-size: 13px; color: var(--text-primary); border-left: 4px solid var(--primary-color);">
                        <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                        <strong>Walk-in Patient:</strong> Enter basic patient information for billing. Patient number will be auto-generated if not provided.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">\n                        <div class="form-group">
                            <label>Patient Number</label>
                            <input type="text" id="manualPatientNumber" class="form-input" placeholder="e.g., P001 (auto-generated if empty)">
                        </div>
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="manualPatientName" class="form-input" placeholder="Enter patient name" required>
                        </div>
                        <div class="form-group">
                            <label>Age</label>
                            <input type="number" id="manualPatientAge" class="form-input" placeholder="Age" min="0">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select id="manualPatientGender" class="form-select">
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="useManualPatient()" style="margin-top: 16px;">
                        <i class="fas fa-check"></i> Use This Information
                    </button>
                </div>
            </div>

            <!-- Selected Patient Info -->
            <div id="selectedPatientSection" class="billing-section" style="display: none;">
                <div class="section-header">
                    <i class="fas fa-user-check"></i>
                    <h4>Patient Information</h4>
                </div>
                <div class="patient-info-card">
                    <div class="patient-info-row">
                        <div class="info-item">
                            <label>Patient Number:</label>
                            <span id="displayPatientNumber">-</span>
                        </div>
                        <div class="info-item">
                            <label>Full Name:</label>
                            <span id="displayPatientName">-</span>
                        </div>
                        <div class="info-item">
                            <label>Age:</label>
                            <span id="displayPatientAge">-</span>
                        </div>
                        <div class="info-item">
                            <label>Gender:</label>
                            <span id="displayPatientGender">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Billing Form -->
            <div id="billingFormSection" class="billing-section" style="display: none;">
                <div class="section-header">
                    <i class="fas fa-file-invoice"></i>
                    <h4>Bill Items</h4>
                </div>

                <form id="billingForm">
                    <!-- Consultation Fee -->
                    <div class="bill-item-section">
                        <div class="bill-item-header">
                            <h5><i class="fas fa-stethoscope"></i> Consultation Fee</h5>
                            <label class="toggle-switch">
                                <input type="checkbox" id="consultationFeeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="consultationFeeContent" class="bill-item-content" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Fee Amount (KSh)</label>
                                    <input type="number" id="consultationAmount" class="form-input" value="500" min="0" step="0.01">
                                </div>
                                <div class="form-group">
                                    <label>Payment Status</label>
                                    <select id="consultationStatus" class="form-input">
                                        <option value="paid">Paid</option>
                                        <option value="pending">Pending</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Services -->
                    <div class="bill-item-section">
                        <div class="bill-item-header">
                            <h5><i class="fas fa-plus-circle"></i> Additional Services</h5>
                            <button type="button" class="btn btn-sm btn-primary" id="addServiceBtn">
                                <i class="fas fa-plus"></i> Add Service
                            </button>
                        </div>
                        <div id="additionalServicesContent" class="bill-item-content">
                            <div id="servicesContainer"></div>
                        </div>
                    </div>

                    <!-- Pharmacy Payment -->
                    <div class="bill-item-section">
                        <div class="bill-item-header">
                            <h5><i class="fas fa-pills"></i> Pharmacy Payment</h5>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pharmacyPaymentToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div id="pharmacyPaymentContent" class="bill-item-content" style="display: none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Prescription Number</label>
                                    <input type="text" id="pharmacyPrescriptionNumber" class="form-input" placeholder="Enter prescription number">
                                </div>
                                <div class="form-group">
                                    <label>Amount (KSh)</label>
                                    <input type="number" id="pharmacyAmount" class="form-input" value="0" min="0" step="0.01">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bill Summary -->
                    <div class="bill-summary-section">
                        <h5><i class="fas fa-calculator"></i> Bill Summary</h5>
                        <div class="bill-summary-content">
                            <div class="summary-row">
                                <span>Consultation Fee:</span>
                                <span id="summaryConsultation">KSh 0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Additional Services:</span>
                                <span id="summaryServices">KSh 0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Pharmacy Payment:</span>
                                <span id="summaryPharmacy">KSh 0.00</span>
                            </div>
                            <div class="summary-row summary-total">
                                <span>Total Amount:</span>
                                <span id="summaryTotal">KSh 0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="billingPaymentMethod">Payment Method <span class="required">*</span></label>
                            <select id="billingPaymentMethod" class="form-input" required>
                                <option value="">-- Select Payment Method --</option>
                                <option value="cash">Cash</option>
                                <option value="mpesa">M-Pesa</option>
                                <option value="card">Card</option>
                                <option value="bank-transfer">Bank Transfer</option>
                                <option value="insurance">Insurance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="paymentReference">Reference Number</label>
                            <input type="text" id="paymentReference" class="form-input" placeholder="Transaction reference (optional)">
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="form-group">
                        <label for="billingNotes">Notes (Optional)</label>
                        <textarea id="billingNotes" class="form-input" rows="3" placeholder="Additional notes or comments..."></textarea>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="clearBillingBtn">
                            <i class="fas fa-times"></i> Clear
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-receipt"></i> Generate Receipt & Save
                        </button>
                    </div>
                </form>
            </div>

            <!-- Recent Billings Section -->
            <div class="billing-section">
                <div class="section-header">
                    <i class="fas fa-history"></i>
                    <h4>Recent Transactions</h4>
                    <button class="btn btn-secondary btn-sm" onclick="showModule('billing-view')" style="margin-left: auto;">
                        <i class="fas fa-list"></i> View All
                    </button>
                </div>
                <div class="recent-billings-container">
                    <div class="table-responsive">
                        <table class="recent-billings-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Receipt #</th>
                                    <th>Patient</th>
                                    <th>Amount</th>
                                    <th>Method</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="recentBillingsTableBody">
                                <tr class="empty-state">
                                    <td colspan="7">
                                        <div class="empty-state-content">
                                            <i class="fas fa-file-invoice"></i>
                                            <p>No recent transactions</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- View All Bills Sub-module -->
        <div class="module" id="billing-view-module">
            <div class="module-header">
                <div>
                    <h1 class="module-title">All Bills & Receipts</h1>
                    <p class="module-description">View, search, and manage all billing transactions</p>
                </div>
                <div style="display: flex; gap: 12px;">
                    <div class="dropdown" style="position: relative;">
                        <button class="btn btn-secondary" id="exportDropdownBtn">
                            <i class="fas fa-file-export"></i> Export
                            <i class="fas fa-chevron-down" style="margin-left: 8px; font-size: 10px;"></i>
                        </button>
                        <div class="dropdown-menu" id="exportDropdown" style="display: none;">
                            <button class="dropdown-item" onclick="exportBillsAsPDF()">
                                <i class="fas fa-file-pdf"></i> Export as PDF
                            </button>
                            <button class="dropdown-item" onclick="exportBillsAsExcel()">
                                <i class="fas fa-file-excel"></i> Export as Excel
                            </button>
                            <button class="dropdown-item" onclick="exportBillsAsCSV()">
                                <i class="fas fa-file-csv"></i> Export as CSV
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="showModule('billing')">
                        <i class="fas fa-plus"></i> New Bill
                    </button>
                </div>
            </div>

            <!-- Filters -->
            <div class="billing-controls">
                <div class="billing-search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="billSearchInput" class="form-input" placeholder="Search by patient name, number, or receipt number...">
                </div>
                <div class="billing-filters">
                    <select id="filterPaymentStatus" class="filter-select">
                        <option value="">All Status</option>
                        <option value="paid">Paid</option>
                        <option value="pending">Pending</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="filterPaymentMethod" class="filter-select">
                        <option value="">All Methods</option>
                        <option value="cash">Cash</option>
                        <option value="mpesa">M-Pesa</option>
                        <option value="card">Card</option>
                        <option value="bank-transfer">Bank Transfer</option>
                        <option value="insurance">Insurance</option>
                    </select>
                    <input type="date" id="filterDate" class="filter-select">
                    <button class="btn btn-secondary btn-sm" id="clearBillFiltersBtn">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </div>
            </div>

            <!-- Bills Table -->
            <div class="table-container">
                <table class="billing-table">
                    <thead>
                        <tr>
                            <th>Receipt #</th>
                            <th>Date & Time</th>
                            <th>Patient Number</th>
                            <th>Patient Name</th>
                            <th>Services</th>
                            <th>Total Amount</th>
                            <th>Payment Method</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="billingTableBody">
                        <tr class="empty-state">
                            <td colspan="9">
                                <div class="empty-state-content">
                                    <i class="fas fa-file-invoice"></i>
                                    <p>No billing records found</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info">
                    Showing <span id="billShowingStart">0</span> to <span id="billShowingEnd">0</span> of <span id="billTotalItems">0</span> bills
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-secondary btn-sm" id="billPrevBtn" onclick="billPrevPage()" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span class="pagination-pages" id="billPaginationPages"></span>
                    <button class="btn btn-secondary btn-sm" id="billNextBtn" onclick="billNextPage()" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="pagination-size">
                    <label>Show:</label>
                    <select id="billPageSize" class="page-size-select" onchange="changeBillPageSize(this.value)">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Receipt Modal -->
        <div class="modal" id="receiptModal" style="display: none;">
            <div class="modal-content receipt-modal">
                <div class="modal-header">
                    <h3><i class="fas fa-receipt"></i> Payment Receipt</h3>
                    <button class="modal-close" onclick="closeReceiptModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="receiptContent" class="receipt-content">
                        <!-- Receipt will be generated here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeReceiptModal()">
                        <i class="fas fa-times"></i> Close
                    </button>
                    <button class="btn btn-primary" onclick="printReceipt()">
                        <i class="fas fa-print"></i> Print Receipt
                    </button>
                </div>
            </div>
        </div>

        <!-- Inventory Module -->
        <div class="module" id="inventory-module">
            <div class="module-header">
                <h1 class="module-title">Inventory</h1>
                <p class="module-description">Stock management, supply tracking, and procurement orders</p>
            </div>
        </div>

        <!-- Add Item Sub-module -->
        <div class="module" id="add-item-module">
            <div class="module-header">
                <h1 class="module-title">Add Item</h1>
                <p class="module-description">Add new items to the inventory system with details and specifications</p>
            </div>

            <div class="form-container">
                <form id="addItemForm" class="inventory-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemCategory">Category <span class="required">*</span></label>
                            <select id="itemCategory" name="itemCategory" class="form-input" required>
                                <option value="" disabled selected>-- Select Item Category --</option>
                                <option value="medical-equipment">Medical Equipment</option>
                                <option value="surgical-instruments">Surgical Instruments</option>
                                <option value="pharmaceuticals">Pharmaceuticals</option>
                                <option value="medical-consumables">Medical Consumables</option>
                                <option value="laboratory-supplies">Laboratory Supplies</option>
                                <option value="diagnostic-equipment">Diagnostic Equipment</option>
                                <option value="office-supplies">Office Supplies</option>
                                <option value="cleaning-supplies">Cleaning Supplies</option>
                                <option value="personal-protective">Personal Protective Equipment (PPE)</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="itemSubcategory">Subcategory</label>
                            <input type="text" id="itemSubcategory" name="itemSubcategory" class="form-input" placeholder="e.g., Syringes, Bandages">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemName">Item Name <span class="required">*</span></label>
                            <input type="text" id="itemName" name="itemName" class="form-input" placeholder="Enter item name" required>
                        </div>
                        <div class="form-group">
                            <label for="itemCode">Item Code/SKU</label>
                            <input type="text" id="itemCode" name="itemCode" class="form-input" placeholder="Auto-generated" readonly>
                            <small class="helper-text">Automatically generated on save</small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemBrand">Brand/Manufacturer</label>
                            <input type="text" id="itemBrand" name="itemBrand" class="form-input" placeholder="Brand name">
                        </div>
                        <div class="form-group">
                            <label for="itemDescription">Description</label>
                            <input type="text" id="itemDescription" name="itemDescription" class="form-input" placeholder="Brief description">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemQuantity">Quantity <span class="required">*</span></label>
                            <input type="number" id="itemQuantity" name="itemQuantity" class="form-input" placeholder="0" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="itemUnit">Unit <span class="required">*</span></label>
                            <select id="itemUnit" name="itemUnit" class="form-input" required>
                                <option value="" disabled selected>-- Select Unit --</option>
                                <option value="pieces">Pieces (pcs)</option>
                                <option value="boxes">Boxes</option>
                                <option value="packs">Packs</option>
                                <option value="bottles">Bottles</option>
                                <option value="vials">Vials</option>
                                <option value="tablets">Tablets</option>
                                <option value="capsules">Capsules</option>
                                <option value="liters">Liters (L)</option>
                                <option value="milliliters">Milliliters (mL)</option>
                                <option value="kilograms">Kilograms (kg)</option>
                                <option value="grams">Grams (g)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="itemReorderLevel">Reorder Level <span class="required">*</span></label>
                            <input type="number" id="itemReorderLevel" name="itemReorderLevel" class="form-input" placeholder="Min stock" min="0" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemCostPrice">Cost Price <span class="required">*</span></label>
                            <input type="number" id="itemCostPrice" name="itemCostPrice" class="form-input" placeholder="0.00" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="itemSellingPrice">Selling Price</label>
                            <input type="number" id="itemSellingPrice" name="itemSellingPrice" class="form-input" placeholder="0.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="itemTotalValue">Total Value (KSh)</label>
                            <input type="text" id="itemTotalValue" name="itemTotalValue" class="form-input" placeholder="0.00" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="storageLocation">Storage Location <span class="required">*</span></label>
                            <select id="storageLocation" name="storageLocation" class="form-input" required>
                                <option value="" disabled selected>-- Select Location --</option>
                                <option value="main-pharmacy">Main Pharmacy</option>
                                <option value="emergency-pharmacy">Emergency Pharmacy</option>
                                <option value="main-store">Main Store</option>
                                <option value="laboratory-store">Laboratory Store</option>
                                <option value="surgical-store">Surgical Store</option>
                                <option value="ward-supplies">Ward Supplies</option>
                                <option value="cold-storage">Cold Storage</option>
                                <option value="warehouse">Warehouse</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="supplierName">Supplier Name</label>
                            <input type="text" id="supplierName" name="supplierName" class="form-input" placeholder="Supplier name">
                        </div>
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date</label>
                            <input type="date" id="expiryDate" name="expiryDate" class="form-input">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelItemBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Add to Inventory
                        </button>
                    </div>
                </form>

                <!-- Success Message -->
                <div class="success-message" id="itemSuccessMessage" style="display: none;">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Item Added Successfully!</h3>
                    <p>The item has been added to the inventory system.</p>
                    <div class="item-summary" id="itemSummary"></div>
                    <div class="success-actions">
                        <button class="btn btn-primary" id="addAnotherItemBtn">
                            <i class="fas fa-plus"></i> Add Another Item
                        </button>
                        <button class="btn btn-outline" id="viewInventoryBtn">
                            <i class="fas fa-list"></i> View Inventory
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- View Inventory Sub-module -->
        <div class="module" id="view-inventory-module">
            <div class="module-header">
                <div>
                    <h1 class="module-title">Inventory Management</h1>
                    <p class="module-description">Browse all inventory items, check stock levels, and manage supplies</p>
                </div>
                <button class="btn btn-primary" onclick="showModule('add-item')">
                    <i class="fas fa-plus"></i> Add New Item
                </button>
            </div>

            <!-- Inventory Statistics Cards -->
            <div class="inventory-stats-grid">
                <div class="inventory-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(37, 99, 235, 0.1);">
                        <i class="fas fa-boxes" style="color: #2563eb;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="totalItemsCount">0</h3>
                        <p class="stat-label">Total Items</p>
                    </div>
                </div>

                <div class="inventory-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(16, 185, 129, 0.1);">
                        <i class="fas fa-dollar-sign" style="color: #10b981;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="totalInventoryValue">KSh 0.00</h3>
                        <p class="stat-label">Total Value</p>
                    </div>
                </div>

                <div class="inventory-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-exclamation-triangle" style="color: #f59e0b;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="lowStockCount">0</h3>
                        <p class="stat-label">Low Stock</p>
                    </div>
                </div>

                <div class="inventory-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(239, 68, 68, 0.1);">
                        <i class="fas fa-calendar-times" style="color: #ef4444;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="expiredItemsCount">0</h3>
                        <p class="stat-label">Expired Items</p>
                    </div>
                </div>
            </div>

            <!-- Inventory Controls (Search, Filters, Actions) -->
            <div class="inventory-controls">
                <div class="inventory-search">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="inventorySearchInput" placeholder="Search by item name, code, or brand..." class="search-input">
                </div>

                <div class="inventory-filters">
                    <select id="filterCategory" class="filter-select">
                        <option value="">All Categories</option>
                        <option value="medical-equipment">Medical Equipment</option>
                        <option value="surgical-instruments">Surgical Instruments</option>
                        <option value="pharmaceuticals">Pharmaceuticals</option>
                        <option value="medical-consumables">Medical Consumables</option>
                        <option value="laboratory-supplies">Laboratory Supplies</option>
                        <option value="diagnostic-equipment">Diagnostic Equipment</option>
                        <option value="office-supplies">Office Supplies</option>
                        <option value="cleaning-supplies">Cleaning Supplies</option>
                        <option value="personal-protective">PPE</option>
                        <option value="other">Other</option>
                    </select>

                    <select id="filterStockStatus" class="filter-select">
                        <option value="">All Stock Levels</option>
                        <option value="in-stock">In Stock</option>
                        <option value="low-stock">Low Stock</option>
                        <option value="out-of-stock">Out of Stock</option>
                    </select>

                    <select id="filterLocation" class="filter-select">
                        <option value="">All Locations</option>
                        <option value="main-pharmacy">Main Pharmacy</option>
                        <option value="emergency-pharmacy">Emergency Pharmacy</option>
                        <option value="main-store">Main Store</option>
                        <option value="laboratory-store">Laboratory Store</option>
                        <option value="surgical-store">Surgical Store</option>
                        <option value="ward-supplies">Ward Supplies</option>
                        <option value="cold-storage">Cold Storage</option>
                        <option value="warehouse">Warehouse</option>
                    </select>

                    <div class="filter-actions">
                        <button class="btn btn-secondary btn-sm" id="clearInventoryFiltersBtn">
                            <i class="fas fa-times"></i> Clear
                        </button>
                        <button class="btn btn-primary btn-sm" id="exportInventoryBtn">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                    </div>
                </div>
            </div>

            <!-- Inventory Table -->
            <div class="table-container">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Item Code</th>
                            <th>Item Name</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Unit</th>
                            <th>Stock Status</th>
                            <th>Cost Price</th>
                            <th>Total Value</th>
                            <th>Location</th>
                            <th>Expiry Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <tr class="empty-state">
                            <td colspan="11">
                                <div class="empty-state-content">
                                    <i class="fas fa-box-open"></i>
                                    <p>No inventory items found</p>
                                    <button class="btn btn-primary" onclick="showModule('add-item')">
                                        <i class="fas fa-plus"></i> Add First Item
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info">
                    Showing <span id="inventoryShowingStart">0</span> to <span id="inventoryShowingEnd">0</span> of <span id="inventoryTotalItems">0</span> items
                </div>
                <div class="pagination-controls">
                    <button class="btn btn-secondary btn-sm" id="inventoryPrevBtn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span class="pagination-pages" id="inventoryPaginationPages"></span>
                    <button class="btn btn-secondary btn-sm" id="inventoryNextBtn" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="pagination-size">
                    <label>Show:</label>
                    <select id="inventoryPageSize" class="page-size-select">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- View Item Details Modal -->
        <div class="modal" id="viewItemModal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title">Item Details</h2>
                    <button class="modal-close" onclick="closeModal('viewItemModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="viewItemDetails">
                    <!-- Item details will be populated here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('viewItemModal')">Close</button>
                </div>
            </div>
        </div>

        <!-- Edit Item Modal -->
        <div class="modal" id="editItemModal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Item</h2>
                    <button class="modal-close" onclick="closeModal('editItemModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editItemForm">
                        <input type="hidden" id="editItemId">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editItemName">Item Name <span class="required">*</span></label>
                                <input type="text" id="editItemName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemCategory">Category <span class="required">*</span></label>
                                <select id="editItemCategory" class="form-input" required>
                                    <option value="medical-equipment">Medical Equipment</option>
                                    <option value="surgical-instruments">Surgical Instruments</option>
                                    <option value="pharmaceuticals">Pharmaceuticals</option>
                                    <option value="medical-consumables">Medical Consumables</option>
                                    <option value="laboratory-supplies">Laboratory Supplies</option>
                                    <option value="diagnostic-equipment">Diagnostic Equipment</option>
                                    <option value="office-supplies">Office Supplies</option>
                                    <option value="cleaning-supplies">Cleaning Supplies</option>
                                    <option value="personal-protective">PPE</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editItemQuantity">Quantity <span class="required">*</span></label>
                                <input type="number" id="editItemQuantity" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemUnit">Unit <span class="required">*</span></label>
                                <select id="editItemUnit" class="form-input" required>
                                    <option value="pieces">Pieces (pcs)</option>
                                    <option value="boxes">Boxes</option>
                                    <option value="packs">Packs</option>
                                    <option value="bottles">Bottles</option>
                                    <option value="vials">Vials</option>
                                    <option value="tablets">Tablets</option>
                                    <option value="capsules">Capsules</option>
                                    <option value="liters">Liters (L)</option>
                                    <option value="milliliters">Milliliters (mL)</option>
                                    <option value="kilograms">Kilograms (kg)</option>
                                    <option value="grams">Grams (g)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editItemReorderLevel">Reorder Level <span class="required">*</span></label>
                                <input type="number" id="editItemReorderLevel" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editItemCostPrice">Cost Price <span class="required">*</span></label>
                                <input type="number" id="editItemCostPrice" class="form-input" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="editItemSellingPrice">Selling Price</label>
                                <input type="number" id="editItemSellingPrice" class="form-input" step="0.01">
                            </div>
                            <div class="form-group">
                                <label for="editStorageLocation">Location <span class="required">*</span></label>
                                <select id="editStorageLocation" class="form-input" required>
                                    <option value="main-pharmacy">Main Pharmacy</option>
                                    <option value="emergency-pharmacy">Emergency Pharmacy</option>
                                    <option value="main-store">Main Store</option>
                                    <option value="laboratory-store">Laboratory Store</option>
                                    <option value="surgical-store">Surgical Store</option>
                                    <option value="ward-supplies">Ward Supplies</option>
                                    <option value="cold-storage">Cold Storage</option>
                                    <option value="warehouse">Warehouse</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('editItemModal')">Cancel</button>
                    <button class="btn btn-primary" id="saveEditItemBtn">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Delete Item Confirmation Modal -->
        <div class="modal" id="deleteItemModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Confirm Delete</h2>
                    <button class="modal-close" onclick="closeModal('deleteItemModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this item from the inventory?</p>
                    <div class="delete-item-info" id="deleteItemInfo"></div>
                    <p class="warning-text"><i class="fas fa-exclamation-triangle"></i> This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('deleteItemModal')">Cancel</button>
                    <button class="btn btn-danger" id="confirmDeleteItemBtn">Delete Item</button>
                </div>
            </div>
        </div>

        <!-- View Prescription Details Modal -->
        <div class="modal" id="viewPrescriptionModal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h2 class="modal-title"><i class="fas fa-prescription"></i> Prescription Details</h2>
                    <button class="close-modal" onclick="closeModal('viewPrescriptionModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="viewPrescriptionModalBody">
                    <!-- Prescription details will be populated here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeModal('viewPrescriptionModal')">Close</button>
                    <button class="btn btn-primary" id="addPrescriptionToCartFromModal">
                        <i class="fas fa-cart-plus"></i> Add to Cart
                    </button>
                </div>
            </div>
        </div>

        <!-- Expenses Module -->
        <div class="module" id="expenses-module">
            <div class="module-header">
                <h1 class="module-title">Expenses</h1>
                <p class="module-description">Cost tracking, budget management, and expenditure reporting</p>
            </div>
        </div>

        <!-- Add Expense Sub-module -->
        <div class="module" id="add-expense-module">
            <div class="module-header">
                <h1 class="module-title">Add Expense</h1>
                <p class="module-description">Record new expenses and categorize expenditures</p>
            </div>

            <div class="form-container">
                <form id="addExpenseForm" class="expense-form">
                    <!-- Expense Type Selection -->
                    <div class="form-section">
                        <h3 class="section-title">Expense Type</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expenseCategory">Category <span class="required">*</span></label>
                                <select id="expenseCategory" name="expenseCategory" class="form-input" required>
                                    <option value="" disabled selected>-- Select Expense Category --</option>
                                    <option value="medical-supplies">Medical Supplies & Equipment</option>
                                    <option value="pharmaceuticals">Pharmaceuticals & Medications</option>
                                    <option value="utilities">Utilities (Water, Electricity, Gas)</option>
                                    <option value="salaries">Salaries & Wages</option>
                                    <option value="maintenance">Maintenance & Repairs</option>
                                    <option value="laboratory">Laboratory Supplies</option>
                                    <option value="administrative">Administrative Expenses</option>
                                    <option value="food-catering">Food & Catering Services</option>
                                    <option value="transportation">Transportation & Fuel</option>
                                    <option value="cleaning">Cleaning & Sanitation</option>
                                    <option value="insurance">Insurance</option>
                                    <option value="training">Training & Development</option>
                                    <option value="marketing">Marketing & Advertising</option>
                                    <option value="rent">Rent & Lease</option>
                                    <option value="technology">Technology & IT Services</option>
                                    <option value="other">Other Expenses</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="expenseSubcategory">Subcategory</label>
                                <input type="text" id="expenseSubcategory" name="expenseSubcategory" class="form-input" placeholder="e.g., Surgical Gloves, Office Supplies">
                            </div>
                        </div>
                    </div>

                    <!-- Expense Details -->
                    <div class="form-section">
                        <h3 class="section-title">Expense Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expenseDescription">Description <span class="required">*</span></label>
                                <input type="text" id="expenseDescription" name="expenseDescription" class="form-input" placeholder="Brief description of the expense" required>
                            </div>
                            <div class="form-group">
                                <label for="expenseAmount">Amount (KSh) <span class="required">*</span></label>
                                <input type="number" id="expenseAmount" name="expenseAmount" class="form-input" placeholder="0.00" step="0.01" min="0" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="expenseDate">Expense Date <span class="required">*</span></label>
                                <input type="date" id="expenseDate" name="expenseDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="expensePaymentMethod">Payment Method <span class="required">*</span></label>
                                <select id="expensePaymentMethod" name="expensePaymentMethod" class="form-input" required>
                                    <option value="" disabled selected>-- Select Payment Method --</option>
                                    <option value="cash">Cash</option>
                                    <option value="mpesa">M-Pesa</option>
                                    <option value="bank-transfer">Bank Transfer</option>
                                    <option value="cheque">Cheque</option>
                                    <option value="credit-card">Credit Card</option>
                                    <option value="debit-card">Debit Card</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="expenseNotes">Additional Notes</label>
                                <textarea id="expenseNotes" name="expenseNotes" class="form-input" rows="3" placeholder="Any additional information or comments about this expense"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Vendor/Supplier Information -->
                    <div class="form-section">
                        <h3 class="section-title">Vendor/Supplier Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="vendorName">Vendor/Supplier Name</label>
                                <input type="text" id="vendorName" name="vendorName" class="form-input" placeholder="Company or individual name">
                            </div>
                            <div class="form-group">
                                <label for="vendorContact">Vendor Contact</label>
                                <input type="tel" id="vendorContact" name="vendorContact" class="form-input" placeholder="Phone number or email">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="invoiceNumber">Invoice/Receipt Number</label>
                                <input type="text" id="invoiceNumber" name="invoiceNumber" class="form-input" placeholder="Reference number">
                            </div>
                            <div class="form-group">
                                <label for="purchaseOrderNumber">Purchase Order (PO) Number</label>
                                <input type="text" id="purchaseOrderNumber" name="purchaseOrderNumber" class="form-input" placeholder="PO reference number">
                            </div>
                        </div>
                    </div>

                    <!-- Department & Authorization -->
                    <div class="form-section">
                        <h3 class="section-title">Department & Authorization</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expenseDepartment">Department <span class="required">*</span></label>
                                <select id="expenseDepartment" name="expenseDepartment" class="form-input" required>
                                    <option value="" disabled selected>-- Select Department --</option>
                                    <option value="reception">Reception</option>
                                    <option value="triage">Triage</option>
                                    <option value="doctor">Doctor/Consultation</option>
                                    <option value="nursing">Nursing</option>
                                    <option value="laboratory">Laboratory</option>
                                    <option value="pharmacy">Pharmacy</option>
                                    <option value="radiology">Radiology</option>
                                    <option value="ward">Ward/Inpatient</option>
                                    <option value="icu">ICU</option>
                                    <option value="emergency">Emergency</option>
                                    <option value="administration">Administration</option>
                                    <option value="finance">Finance</option>
                                    <option value="hr">Human Resources</option>
                                    <option value="it">IT Department</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="housekeeping">Housekeeping</option>
                                    <option value="security">Security</option>
                                    <option value="general">General/Facility</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="authorizedBy">Authorized By</label>
                                <input type="text" id="authorizedBy" name="authorizedBy" class="form-input" placeholder="Name of approving authority">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="expenseStatus">Status <span class="required">*</span></label>
                                <select id="expenseStatus" name="expenseStatus" class="form-input" required>
                                    <option value="pending">Pending Approval</option>
                                    <option value="approved" selected>Approved</option>
                                    <option value="paid">Paid</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="expenseRecurring">Recurring Expense</label>
                                <select id="expenseRecurring" name="expenseRecurring" class="form-input">
                                    <option value="no" selected>No - One-time expense</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Document Upload (Optional) -->
                    <div class="form-section">
                        <h3 class="section-title">Document Attachment</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="expenseDocument">Upload Receipt/Invoice</label>
                                <div class="file-upload-wrapper">
                                    <input type="file" id="expenseDocument" name="expenseDocument" class="form-input file-input" accept=".pdf,.jpg,.jpeg,.png" multiple>
                                    <div class="file-upload-info">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Click to upload or drag and drop</p>
                                        <small>PDF, JPG, PNG (Max 5MB per file)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelExpenseBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="button" class="btn btn-outline" id="saveExpenseDraftBtn">
                            <i class="fas fa-save"></i> Save as Draft
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check"></i> Submit Expense
                        </button>
                    </div>
                </form>

                <!-- Success Message -->
                <div class="success-message" id="expenseSuccessMessage" style="display: none;">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Expense Recorded Successfully!</h3>
                    <p>The expense has been added to the system.</p>
                    <div class="success-actions">
                        <button class="btn btn-primary" id="addAnotherExpenseBtn">
                            <i class="fas fa-plus"></i> Add Another Expense
                        </button>
                        <button class="btn btn-outline" id="viewAllExpensesBtn">
                            <i class="fas fa-list"></i> View All Expenses
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- All Expenses Sub-module -->
        <div class="module" id="all-expenses-module">
            <div class="module-header">
                <h1 class="module-title">All Expenses</h1>
                <p class="module-description">View all recorded expenses, filter by category, and generate reports</p>
            </div>

            <!-- Expense Statistics Cards -->
            <div class="expense-stats-grid">
                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(37, 99, 235, 0.1);">
                        <i class="fas fa-receipt" style="color: #2563eb;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="totalExpensesCount">0</h3>
                        <p class="stat-label">Total Expenses</p>
                    </div>
                </div>

                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(239, 68, 68, 0.1);">
                        <i class="fas fa-coins" style="color: #ef4444;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="totalExpensesAmount">KSh 0.00</h3>
                        <p class="stat-label">Total Amount</p>
                    </div>
                </div>

                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(245, 158, 11, 0.1);">
                        <i class="fas fa-calendar-alt" style="color: #f59e0b;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="monthlyExpensesAmount">KSh 0.00</h3>
                        <p class="stat-label">This Month</p>
                    </div>
                </div>

                <div class="expense-stat-card">
                    <div class="stat-icon-wrapper" style="background: rgba(16, 185, 129, 0.1);">
                        <i class="fas fa-check-circle" style="color: #10b981;"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-number" id="approvedExpensesCount">0</h3>
                        <p class="stat-label">Approved</p>
                    </div>
                </div>
            </div>

            <!-- Filters and Actions -->
            <div class="expense-controls">
                <div class="expense-controls-header">
                    <h3 class="controls-title">Filters</h3>
                    <button class="btn-clear-filters" id="clearFiltersBtn" title="Clear all filters">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="expense-filters">
                    <div class="filter-group">
                        <label for="filterCategory">Category</label>
                        <select id="filterCategory" class="filter-select">
                            <option value="">All Categories</option>
                            <option value="medical-supplies">Medical Supplies & Equipment</option>
                            <option value="pharmaceuticals">Pharmaceuticals & Medications</option>
                            <option value="utilities">Utilities</option>
                            <option value="salaries">Salaries & Wages</option>
                            <option value="maintenance">Maintenance & Repairs</option>
                            <option value="laboratory">Laboratory Supplies</option>
                            <option value="administrative">Administrative</option>
                            <option value="food-catering">Food & Catering</option>
                            <option value="transportation">Transportation & Fuel</option>
                            <option value="cleaning">Cleaning & Sanitation</option>
                            <option value="insurance">Insurance</option>
                            <option value="training">Training & Development</option>
                            <option value="marketing">Marketing & Advertising</option>
                            <option value="rent">Rent & Lease</option>
                            <option value="technology">Technology & IT</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filterDepartment">Department</label>
                        <select id="filterDepartment" class="filter-select">
                            <option value="">All Departments</option>
                            <option value="reception">Reception</option>
                            <option value="triage">Triage</option>
                            <option value="doctor">Doctor/Consultation</option>
                            <option value="nursing">Nursing</option>
                            <option value="laboratory">Laboratory</option>
                            <option value="pharmacy">Pharmacy</option>
                            <option value="radiology">Radiology</option>
                            <option value="ward">Ward/Inpatient</option>
                            <option value="emergency">Emergency</option>
                            <option value="administration">Administration</option>
                            <option value="finance">Finance</option>
                            <option value="it">IT Department</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="housekeeping">Housekeeping</option>
                            <option value="general">General</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus" class="filter-select">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="paid">Paid</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="filterStartDate">Start Date</label>
                        <input type="date" id="filterStartDate" class="filter-input">
                    </div>

                    <div class="filter-group">
                        <label for="filterEndDate">End Date</label>
                        <input type="date" id="filterEndDate" class="filter-input">
                    </div>

                    <div class="filter-actions">
                        <button class="btn btn-primary" id="applyFiltersBtn">
                            <i class="fas fa-filter"></i> Apply Filters
                        </button>
                    </div>
                </div>

                <div class="expense-actions">
                    <div class="export-dropdown">
                        <button class="btn btn-success" id="exportExpensesBtn">
                            <i class="fas fa-file-download"></i> Export
                            <i class="fas fa-chevron-down" style="margin-left: 4px; font-size: 10px;"></i>
                        </button>
                        <div class="export-menu" id="exportMenu">
                            <button class="export-option" id="exportCSVBtn">
                                <i class="fas fa-file-csv"></i>
                                Export as CSV
                            </button>
                            <button class="export-option" id="exportPDFBtn">
                                <i class="fas fa-file-pdf"></i>
                                Export as PDF
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="addNewExpenseBtn">
                        <i class="fas fa-plus"></i> Add Expense
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="expenseSearchInput" placeholder="Search by description, vendor, invoice number, or amount..." class="search-input">
                </div>
            </div>

            <!-- Expenses Table -->
            <div class="table-container">
                <div class="table-wrapper">
                    <table class="expenses-table" id="expensesTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllExpenses">
                                </th>
                                <th>Expense ID</th>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Department</th>
                                <th>Vendor</th>
                                <th>Amount</th>
                                <th>Payment</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBody">
                            <tr>
                                <td colspan="11" class="empty-state">
                                    <div class="empty-state-content">
                                        <i class="fas fa-wallet"></i>
                                        <h3>No Expenses Found</h3>
                                        <p>Start by adding your first expense record</p>
                                        <button class="btn btn-primary" id="addFirstExpenseBtn">
                                            <i class="fas fa-plus"></i> Add Expense
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-container" id="expensePaginationContainer" style="display: none;">
                <div class="pagination-info">
                    Showing <span id="expenseShowingStart">0</span> to <span id="expenseShowingEnd">0</span> of <span id="expenseTotalRecords">0</span> expenses
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="expenseFirstPageBtn" disabled>
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="pagination-btn" id="expensePrevPageBtn" disabled>
                        <i class="fas fa-angle-left"></i>
                    </button>
                    <span class="page-info">Page <span id="expenseCurrentPage">1</span> of <span id="expenseTotalPages">1</span></span>
                    <button class="pagination-btn" id="expenseNextPageBtn" disabled>
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="pagination-btn" id="expenseLastPageBtn" disabled>
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                </div>
                <div class="pagination-size">
                    <label>Show:</label>
                    <select id="expensePageSize" class="page-size-select">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- View Expense Details Modal -->
        <div class="modal" id="viewExpenseModal">
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h2 class="modal-title">Expense Details</h2>
                    <button class="close-modal" onclick="closeViewExpenseModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="viewExpenseModalBody">
                    <!-- Expense details will be populated here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeViewExpenseModal()">Close</button>
                </div>
            </div>
        </div>

        <!-- Edit Expense Modal -->
        <div class="modal" id="editExpenseModal">
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Expense</h2>
                    <button class="close-modal" onclick="closeEditExpenseModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="editExpenseModalBody">
                    <!-- Edit form will be populated here -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeEditExpenseModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveExpenseChanges()">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal" id="deleteExpenseModal">
            <div class="modal-content modal-sm">
                <div class="modal-header">
                    <h2 class="modal-title">Delete Expense</h2>
                    <button class="close-modal" onclick="closeDeleteExpenseModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="delete-confirmation">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Are you sure you want to delete this expense? This action cannot be undone.</p>
                        <div class="expense-delete-info" id="expenseDeleteInfo"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-outline" onclick="closeDeleteExpenseModal()">Cancel</button>
                    <button class="btn btn-danger" onclick="confirmDeleteExpense()">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Panel Module -->
        <div class="module" id="admin-module">
            <div class="module-header">
                <h1 class="module-title">Admin Panel</h1>
                <p class="module-description">User management, role assignments, system configuration, and access control</p>
            </div>

            <div class="module-content">
                <!-- Admin Navigation Tabs -->
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="users">
                        <i class="fas fa-users"></i> User Management
                    </button>
                    <button class="admin-tab" data-tab="sessions">
                        <i class="fas fa-user-clock"></i> Active Sessions
                    </button>
                    <button class="admin-tab" data-tab="departments">
                        <i class="fas fa-building"></i> Departments
                    </button>
                    <button class="admin-tab" data-tab="system">
                        <i class="fas fa-cog"></i> System Settings
                    </button>
                    <button class="admin-tab" data-tab="logs">
                        <i class="fas fa-clipboard-list"></i> Activity Logs
                    </button>
                </div>

                <!-- User Management Tab -->
                <div class="admin-tab-content active" id="users-tab">
                    <div class="content-section">
                        <div class="section-header">
                            <h2>User Management</h2>
                            <button class="btn btn-primary" id="createUserBtn">
                                <i class="fas fa-user-plus"></i> Create New User
                            </button>
                        </div>

                        <!-- Users List -->
                        <div class="users-table-container">
                            <table class="data-table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Module Access</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr>
                                        <td colspan="7" class="text-center">Loading users...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Active Sessions Tab -->
                <div class="admin-tab-content" id="sessions-tab">
                    <div class="content-section">
                        <div class="section-header">
                            <h2>Active User Sessions</h2>
                            <button class="btn btn-secondary" id="refreshSessionsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>

                        <div class="active-sessions-card">
                            <div class="active-sessions-header">
                                <h3>
                                    <i class="fas fa-users"></i>
                                    Currently Active Users
                                    <span class="session-count-badge" id="activeSessionCount">0</span>
                                </h3>
                            </div>
                            <div class="sessions-grid" id="activeSessionsGrid">
                                <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                                    <p style="margin-top: 16px;">Loading active sessions...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Login Activity -->
                        <div class="active-sessions-card">
                            <div class="active-sessions-header">
                                <h3><i class="fas fa-history"></i> Recent Login Activity</h3>
                            </div>
                            <div class="logs-timeline" id="recentLoginsTimeline">
                                <div class="log-item">
                                    <div class="log-icon log-icon-info">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                    <div class="log-content">
                                        <p>Loading login activity...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Departments Tab -->
                <div class="admin-tab-content" id="departments-tab">
                    <div class="content-section">
                        <div class="section-header">
                            <h2>Department Activity Overview</h2>
                        </div>

                        <div class="department-activity-card">
                            <div class="department-grid" id="departmentActivityGrid">
                                <div style="text-align: center; padding: 40px; color: var(--text-secondary); grid-column: 1/-1;">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                                    <p style="margin-top: 16px;">Loading department activity...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Settings Tab -->
                <div class="admin-tab-content" id="system-tab">
                    <div class="content-section">
                        <div class="section-header">
                            <h2>System Settings</h2>
                            <button class="btn btn-primary" id="saveSettingsBtn">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>

                        <div class="settings-grid">
                            <!-- General Settings -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <i class="fas fa-hospital"></i>
                                    <h3>General Settings</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="form-group">
                                        <label for="hospitalName">Hospital Name</label>
                                        <input type="text" class="form-control" id="hospitalName" placeholder="RxFlow Hospital">
                                    </div>
                                    <div class="form-group">
                                        <label for="hospitalAddress">Hospital Address</label>
                                        <textarea class="form-control" id="hospitalAddress" rows="2" placeholder="Enter hospital address"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="hospitalPhone">Contact Phone</label>
                                        <input type="tel" class="form-control" id="hospitalPhone" placeholder="+1234567890">
                                    </div>
                                    <div class="form-group">
                                        <label for="hospitalEmail">Contact Email</label>
                                        <input type="email" class="form-control" id="hospitalEmail" placeholder="info@rxflow.com">
                                    </div>
                                </div>
                            </div>

                            <!-- Security Settings -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <i class="fas fa-shield-alt"></i>
                                    <h3>Security Settings</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="form-group">
                                        <label for="sessionTimeout">Session Timeout (minutes)</label>
                                        <input type="number" class="form-control" id="sessionTimeout" min="5" max="120" value="30">
                                    </div>
                                    <div class="form-group">
                                        <label for="passwordMinLength">Minimum Password Length</label>
                                        <input type="number" class="form-control" id="passwordMinLength" min="6" max="20" value="8">
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="requireEmailVerification">
                                            <span>Require Email Verification</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="enableTwoFactor">
                                            <span>Enable Two-Factor Authentication</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Notification Settings -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <i class="fas fa-bell"></i>
                                    <h3>Notification Settings</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="emailNotifications" checked>
                                            <span>Email Notifications</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="smsNotifications">
                                            <span>SMS Notifications</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="lowStockAlerts" checked>
                                            <span>Low Stock Alerts</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="expiryAlerts" checked>
                                            <span>Medicine Expiry Alerts</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Billing Settings -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                    <h3>Billing Settings</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="form-group">
                                        <label for="currency">Currency</label>
                                        <select class="form-control" id="currency">
                                            <option value="USD">USD - US Dollar</option>
                                            <option value="EUR">EUR - Euro</option>
                                            <option value="GBP">GBP - British Pound</option>
                                            <option value="INR">INR - Indian Rupee</option>
                                            <option value="KES">KES - Kenyan Shilling</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="taxRate">Tax Rate (%)</label>
                                        <input type="number" class="form-control" id="taxRate" min="0" max="100" step="0.1" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="autoGenerateBills" checked>
                                            <span>Auto-generate Bills</span>
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="allowPartialPayments" checked>
                                            <span>Allow Partial Payments</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Appointment Settings -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <i class="fas fa-calendar-check"></i>
                                    <h3>Appointment Settings</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="form-group">
                                        <label for="appointmentDuration">Default Duration (minutes)</label>
                                        <input type="number" class="form-control" id="appointmentDuration" min="5" max="120" value="30">
                                    </div>
                                    <div class="form-group">
                                        <label for="workingHoursStart">Working Hours Start</label>
                                        <input type="time" class="form-control" id="workingHoursStart" value="08:00">
                                    </div>
                                    <div class="form-group">
                                        <label for="workingHoursEnd">Working Hours End</label>
                                        <input type="time" class="form-control" id="workingHoursEnd" value="18:00">
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="allowOnlineBooking">
                                            <span>Allow Online Booking</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Backup Settings -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <i class="fas fa-database"></i>
                                    <h3>Backup & Data</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="form-group">
                                        <label for="backupFrequency">Backup Frequency</label>
                                        <select class="form-control" id="backupFrequency">
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="dataRetention">Data Retention (months)</label>
                                        <input type="number" class="form-control" id="dataRetention" min="1" max="120" value="24">
                                    </div>
                                    <div class="form-group">
                                        <button class="btn btn-secondary btn-block" id="backupNowBtn">
                                            <i class="fas fa-download"></i> Backup Now
                                        </button>
                                    </div>
                                    <div class="form-group">
                                        <button class="btn btn-secondary btn-block" id="exportDataBtn">
                                            <i class="fas fa-file-export"></i> Export Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Logs Tab -->
                <div class="admin-tab-content" id="logs-tab">
                    <div class="content-section">
                        <div class="section-header">
                            <h2>Activity Logs</h2>
                            <div class="log-filters">
                                <select class="form-control" id="logTypeFilter">
                                    <option value="">All Activities</option>
                                    <option value="user">User Activities</option>
                                    <option value="login">Login/Logout</option>
                                    <option value="patient">Patient Records</option>
                                    <option value="billing">Billing</option>
                                    <option value="pharmacy">Pharmacy</option>
                                    <option value="system">System</option>
                                </select>
                                <input type="date" class="form-control" id="logDateFilter">
                                <button class="btn btn-secondary" id="clearLogFilters">
                                    <i class="fas fa-times"></i> Clear
                                </button>
                            </div>
                        </div>

                        <div class="logs-container">
                            <div class="logs-timeline" id="logsTimeline">
                                <div class="log-item">
                                    <div class="log-icon log-icon-info">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                    <div class="log-content">
                                        <p>Loading activity logs...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="logs-pagination" id="logsPagination">
                            <button class="btn btn-secondary" id="loadMoreLogs">
                                <i class="fas fa-chevron-down"></i> Load More
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create/Edit User Modal -->
        <div class="modal" id="userModal">
            <div class="modal-overlay" onclick="closeUserModal()"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 class="modal-title" id="userModalTitle">
                        <i class="fas fa-user-plus"></i> Create New User
                    </h3>
                    <button class="modal-close" onclick="closeUserModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <input type="hidden" id="editUserId">
                        
                        <!-- Basic Information -->
                        <div class="form-section">
                            <h4 class="form-section-title">Basic Information</h4>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="userDisplayName">Full Name *</label>
                                    <input type="text" class="form-control" id="userDisplayName" required 
                                           placeholder="Enter full name">
                                </div>
                                
                                <div class="form-group">
                                    <label for="userEmail">Email Address *</label>
                                    <input type="email" class="form-control" id="userEmail" required 
                                           placeholder="user@rxflow.com">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="userPassword">Password *</label>
                                    <input type="password" class="form-control" id="userPassword" 
                                           placeholder="Minimum 6 characters" minlength="6">
                                    <small class="form-text">Leave blank when editing to keep current password</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="userPhone">Phone Number</label>
                                    <input type="tel" class="form-control" id="userPhone" 
                                           placeholder="+1234567890">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="userRole">Primary Role *</label>
                                    <select class="form-control" id="userRole" required>
                                        <option value="">Select role...</option>
                                        <option value="admin">Administrator</option>
                                        <option value="doctor">Doctor</option>
                                        <option value="nurse">Nurse</option>
                                        <option value="pharmacist">Pharmacist</option>
                                        <option value="receptionist">Receptionist</option>
                                        <option value="lab_technician">Lab Technician</option>
                                        <option value="billing">Billing Officer</option>
                                        <option value="inventory_manager">Inventory Manager</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="userDepartment">Department</label>
                                    <input type="text" class="form-control" id="userDepartment" 
                                           placeholder="e.g., Emergency, Pharmacy">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="userActive" checked> 
                                    <span>Active User</span>
                                </label>
                            </div>
                        </div>

                        <!-- Module Access Permissions -->
                        <div class="form-section">
                            <h4 class="form-section-title">Module Access Permissions</h4>
                            <p class="form-text">Select which modules this user can access</p>
                            
                            <div class="permissions-grid">
                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="dashboard">
                                    <div class="permission-content">
                                        <i class="fas fa-chart-line"></i>
                                        <span>Dashboard</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="reception">
                                    <div class="permission-content">
                                        <i class="fas fa-door-open"></i>
                                        <span>Reception</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="triage">
                                    <div class="permission-content">
                                        <i class="fas fa-user-check"></i>
                                        <span>Triage</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="doctor">
                                    <div class="permission-content">
                                        <i class="fas fa-user-md"></i>
                                        <span>Doctor</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="ward-nursing">
                                    <div class="permission-content">
                                        <i class="fas fa-bed"></i>
                                        <span>Ward & Nursing</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="laboratory">
                                    <div class="permission-content">
                                        <i class="fas fa-flask"></i>
                                        <span>Laboratory</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="pharmacy">
                                    <div class="permission-content">
                                        <i class="fas fa-pills"></i>
                                        <span>Pharmacy</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="billing">
                                    <div class="permission-content">
                                        <i class="fas fa-file-invoice-dollar"></i>
                                        <span>Billing</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="inventory">
                                    <div class="permission-content">
                                        <i class="fas fa-boxes"></i>
                                        <span>Inventory</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="expenses">
                                    <div class="permission-content">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <span>Expenses</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="admin">
                                    <div class="permission-content">
                                        <i class="fas fa-user-shield"></i>
                                        <span>Admin Panel</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="settings">
                                    <div class="permission-content">
                                        <i class="fas fa-cog"></i>
                                        <span>Settings</span>
                                    </div>
                                </label>

                                <label class="permission-item">
                                    <input type="checkbox" name="modulePermission" value="emergency">
                                    <div class="permission-content">
                                        <i class="fas fa-ambulance"></i>
                                        <span>Emergency</span>
                                    </div>
                                </label>
                            </div>

                            <div class="permission-actions">
                                <button type="button" class="btn btn-sm btn-secondary" onclick="selectAllPermissions()">
                                    <i class="fas fa-check-double"></i> Select All
                                </button>
                                <button type="button" class="btn btn-sm btn-secondary" onclick="clearAllPermissions()">
                                    <i class="fas fa-times"></i> Clear All
                                </button>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeUserModal()">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="saveUserBtn">
                                <i class="fas fa-save"></i> Create User
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Reports Module -->
        <div class="module" id="reports-module">
            <div class="module-header">
                <div style="flex: 1;">
                    <h1 class="module-title">
                        <i class="fas fa-chart-bar"></i>
                        Reports & Analytics
                    </h1>
                    <p class="module-description">Comprehensive hospital reports with real-time data export capabilities</p>
                </div>
            </div>

            <div class="module-content">
                <!-- Report Type Selection -->
                <div class="report-filters">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reportType">Report Type</label>
                            <select id="reportType" class="form-input">
                                <option value="">Select Report Type</option>
                                <option value="patients">Patients Report</option>
                                <option value="emergency">Emergency Cases Report</option>
                                <option value="ward">Ward Admissions Report</option>
                                <option value="pharmacy">Pharmacy Sales Report</option>
                                <option value="lab">Laboratory Tests Report</option>
                                <option value="billing">Billing & Revenue Report</option>
                                <option value="activities">System Activities Report</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportDateRange">Date Range</label>
                            <select id="reportDateRange" class="form-input">
                                <option value="today">Today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="quarter">This Quarter</option>
                                <option value="year">This Year</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <div class="form-group" id="customDateRange" style="display: none;">
                            <label for="reportStartDate">From</label>
                            <input type="date" id="reportStartDate" class="form-input">
                        </div>
                        <div class="form-group" id="customDateRangeEnd" style="display: none;">
                            <label for="reportEndDate">To</label>
                            <input type="date" id="reportEndDate" class="form-input">
                        </div>
                    </div>
                    <div class="dashboard-actions">
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-sync-alt"></i>
                            Generate Report
                        </button>
                        <button class="btn btn-success" onclick="exportReportPDF()" id="exportPdfBtn" disabled>
                            <i class="fas fa-file-pdf"></i>
                            Export PDF
                        </button>
                        <button class="btn btn-info" onclick="exportReportExcel()" id="exportExcelBtn" disabled>
                            <i class="fas fa-file-excel"></i>
                            Export Excel
                        </button>
                        <button class="btn btn-secondary" onclick="exportReportCSV()" id="exportCsvBtn" disabled>
                            <i class="fas fa-file-csv"></i>
                            Export CSV
                        </button>
                        <button class="btn btn-warning" onclick="printReport()" id="printReportBtn" disabled>
                            <i class="fas fa-print"></i>
                            Print
                        </button>
                    </div>
                </div>

                <!-- Report Summary Stats -->
                <div class="stats-grid" id="reportStats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Total Records</span>
                            <span class="stat-value" id="reportTotalRecords">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Date Range</span>
                            <span class="stat-value" id="reportDateRangeDisplay" style="font-size: 14px;">-</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Report Type</span>
                            <span class="stat-value" id="reportTypeDisplay" style="font-size: 16px;">-</span>
                        </div>
                    </div>
                </div>

                <!-- Report Content -->
                <div class="report-content" id="reportContent" style="display: none;">
                    <div class="report-header">
                        <div class="report-logo">
                            <h2>RxFlow Hospital Management System</h2>
                            <p id="reportTitle">Report</p>
                        </div>
                        <div class="report-meta">
                            <p><strong>Generated:</strong> <span id="reportGeneratedDate">-</span></p>
                            <p><strong>Period:</strong> <span id="reportPeriod">-</span></p>
                        </div>
                    </div>

                    <!-- Report Table -->
                    <div class="table-container" style="overflow-x: auto;">
                        <table class="data-table" id="reportTable">
                            <thead id="reportTableHead">
                                <!-- Dynamic headers -->
                            </thead>
                            <tbody id="reportTableBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="reportEmptyState">
                    <i class="fas fa-chart-bar" style="font-size: 64px; color: var(--text-secondary); margin-bottom: 20px;"></i>
                    <h3>No Report Generated</h3>
                    <p>Select a report type and date range, then click "Generate Report" to view data.</p>
                </div>
            </div>
        </div>

        <!-- Profile & Settings Module -->
        <div class="module" id="settings-module">
            <div class="module-header">
                <h1 class="module-title">
                    <i class="fas fa-user-cog"></i>
                    Profile & Settings
                </h1>
                <p class="module-description">Manage your profile, preferences, notifications, and application settings</p>
            </div>
            <div class="module-content">
                <!-- Profile Section -->
                <div class="settings-container">
                    <div class="settings-tabs">
                        <button class="settings-tab active" data-tab="profile">
                            <i class="fas fa-user"></i> Profile
                        </button>
                        <button class="settings-tab" data-tab="preferences">
                            <i class="fas fa-cog"></i> Preferences
                        </button>
                        <button class="settings-tab" data-tab="security">
                            <i class="fas fa-shield-alt"></i> Security
                        </button>
                    </div>

                    <!-- Profile Tab -->
                    <div class="settings-tab-content active" id="profileTab">
                        <div class="profile-settings-grid">
                            <div class="profile-photo-section">
                                <h3>Profile Photo</h3>
                                <div class="profile-photo-upload">
                                    <img src="https://via.placeholder.com/150" alt="Profile" id="profilePhotoPreview" class="profile-photo-large">
                                    <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;">
                                    <button class="btn btn-primary" onclick="document.getElementById('profilePhotoInput').click()">
                                        <i class="fas fa-camera"></i> Change Photo
                                    </button>
                                    <button class="btn btn-secondary" onclick="removeProfilePhoto()">
                                        <i class="fas fa-trash"></i> Remove
                                    </button>
                                </div>
                            </div>

                            <div class="profile-info-section">
                                <h3>Personal Information</h3>
                                <form id="profileForm" class="settings-form">
                                    <div class="form-group">
                                        <label for="profileDisplayName">Full Name *</label>
                                        <input type="text" id="profileDisplayName" class="form-input" required>
                                    </div>

                                    <div class="form-group">
                                        <label for="profileEmail">Email Address *</label>
                                        <input type="email" id="profileEmail" class="form-input" required readonly>
                                        <small style="color: var(--text-secondary);">Email cannot be changed</small>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="profileRole">Role</label>
                                            <input type="text" id="profileRole" class="form-input" readonly>
                                        </div>

                                        <div class="form-group">
                                            <label for="profileDepartment">Department</label>
                                            <input type="text" id="profileDepartment" class="form-input" readonly>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="profilePhone">Phone Number</label>
                                        <input type="tel" id="profilePhone" class="form-input" placeholder="e.g., +254 712 345 678">
                                    </div>

                                    <div class="form-group">
                                        <label for="profileBio">Bio / Description</label>
                                        <textarea id="profileBio" class="form-input" rows="3" placeholder="Tell us about yourself..."></textarea>
                                    </div>

                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Profile
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Tab -->
                    <div class="settings-tab-content" id="preferencesTab">
                        <h3>Application Preferences</h3>
                        <form id="preferencesForm" class="settings-form">
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="prefEmailNotifications">
                                    <span>Email Notifications</span>
                                </label>
                                <small style="color: var(--text-muted);">Receive email updates about important activities</small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="prefPushNotifications">
                                    <span>Push Notifications</span>
                                </label>
                                <small style="color: var(--text-muted);">Get real-time browser notifications</small>
                            </div>

                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="prefSoundAlerts">
                                    <span>Sound Alerts</span>
                                </label>
                                <small style="color: var(--text-muted);">Play sounds for critical notifications</small>
                            </div>

                            <div class="form-group">
                                <label for="prefTheme">Theme</label>
                                <select id="prefTheme" class="form-input">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="auto">Auto (System)</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Preferences
                            </button>
                        </form>
                    </div>

                    <!-- Security Tab -->
                    <div class="settings-tab-content" id="securityTab">
                        <h3>Security Settings</h3>
                        <form id="securityForm" class="settings-form">
                            <div class="form-group">
                                <label for="currentPassword">Current Password *</label>
                                <input type="password" id="currentPassword" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="newPassword">New Password *</label>
                                <input type="password" id="newPassword" class="form-input">
                            </div>

                            <div class="form-group">
                                <label for="confirmPassword">Confirm New Password *</label>
                                <input type="password" id="confirmPassword" class="form-input">
                            </div>

                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                        </form>

                        <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--border-color);">

                        <div>
                            <h3>Session Information</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Last Login:</span>
                                    <span class="info-value" id="lastLoginTime">Loading...</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Session Started:</span>
                                    <span class="info-value" id="sessionStartTime">Loading...</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Session Duration:</span>
                                    <span class="info-value" id="sessionDuration">Calculating...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emergency Module -->
        <div class="module" id="emergency-module">
            <div class="module-header">
                <div style="flex: 1;">
                    <h1 class="module-title" style="color: #ef4444;">
                        <i class="fas fa-ambulance"></i>
                        Emergency Department
                    </h1>
                    <p class="module-description">Critical care management, trauma cases, and urgent patient handling</p>
                </div>
                <div class="dashboard-actions">
                    <button class="btn btn-warning" onclick="soundEmergencyAlarm()" title="Sound Emergency Alarm - Alerts All Departments">
                        <i class="fas fa-bullhorn"></i>
                        <i class="fas fa-exclamation-triangle"></i>
                        Sound Alarm
                    </button>
                    <button class="btn btn-danger" onclick="openNewEmergencyModal()">
                        <i class="fas fa-plus"></i>
                        New Emergency Case
                    </button>
                    <button class="btn btn-primary" onclick="refreshEmergencyData()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>

            <div class="dashboard-content">
                <!-- Emergency Stats -->
                <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Active Cases</span>
                            <span class="stat-value" id="emergencyActiveCases">0</span>
                            <span class="stat-change negative"><i class="fas fa-ambulance"></i> In progress</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Today's Cases</span>
                            <span class="stat-value" id="emergencyTodayCases">0</span>
                            <span class="stat-change neutral"><i class="fas fa-calendar-day"></i> Last 24h</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Stabilized</span>
                            <span class="stat-value" id="emergencyStabilized">0</span>
                            <span class="stat-change positive"><i class="fas fa-heartbeat"></i> Today</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                            <i class="fas fa-user-injured"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Critical</span>
                            <span class="stat-value emergency-count" id="emergencyCritical">0</span>
                            <span class="stat-change negative"><i class="fas fa-exclamation-circle"></i> Urgent</span>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-row" style="margin-bottom: 24px;">
                    <div class="form-group" style="flex: 1;">
                        <label for="emergencyStatusFilter">Filter by Status</label>
                        <select id="emergencyStatusFilter" class="form-input">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="stabilized">Stabilized</option>
                            <option value="admitted">Admitted</option>
                            <option value="discharged">Discharged</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="emergencySeverityFilter">Filter by Severity</label>
                        <select id="emergencySeverityFilter" class="form-input">
                            <option value="">All Severity</option>
                            <option value="critical">Critical</option>
                            <option value="severe">Severe</option>
                            <option value="moderate">Moderate</option>
                            <option value="minor">Minor</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label for="emergencySearchInput">Search</label>
                        <input type="text" id="emergencySearchInput" class="form-input" placeholder="Search by patient name, ID, or case...">
                    </div>
                </div>

                <!-- Emergency Cases Table -->
                <div class="table-container" style="overflow-x: auto; width: 100%;">
                    <table class="data-table" style="min-width: 1200px; width: 100%;">
                        <thead>
                            <tr>
                                <th style="white-space: nowrap;">Time Arrived</th>
                                <th style="white-space: nowrap;">Patient</th>
                                <th style="white-space: nowrap;">Age/Gender</th>
                                <th style="white-space: nowrap;">Case Type</th>
                                <th style="white-space: nowrap;">Severity</th>
                                <th style="white-space: nowrap;">Chief Complaint</th>
                                <th style="white-space: nowrap;">Vital Signs</th>
                                <th style="white-space: nowrap;">Status</th>
                                <th style="white-space: nowrap;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="emergencyCasesTableBody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                    <i class="fas fa-ambulance" style="font-size: 32px; margin-bottom: 10px; display: block;"></i>
                                    <p>No emergency cases</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- New Emergency Case Modal -->
        <div class="modal" id="newEmergencyModal">
            <div class="modal-overlay" onclick="closeNewEmergencyModal()"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title" style="color: #ef4444;">
                        <i class="fas fa-ambulance"></i>
                        New Emergency Case
                    </h2>
                    <button class="modal-close" onclick="closeNewEmergencyModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="newEmergencyForm">
                        <!-- Patient Selection -->
                        <div class="form-section">
                            <h3 class="section-title">Patient Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Patient Type <span class="required">*</span></label>
                                    <select id="emergencyPatientType" class="form-input" required>
                                        <option value="">Select Type</option>
                                        <option value="existing">Existing Patient</option>
                                        <option value="new">New/Unknown Patient</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Existing Patient Search -->
                            <div id="existingPatientSearch" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group full-width">
                                        <label>Search Patient</label>
                                        <input type="text" id="emergencyPatientSearch" class="form-input" placeholder="Search by name, ID, or phone...">
                                        <div id="emergencyPatientResults" class="search-results-dropdown"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- New Patient Fields -->
                            <div id="newPatientFields" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Patient Name <span class="required">*</span></label>
                                        <input type="text" id="emergencyPatientName" class="form-input" placeholder="Full name or Unknown">
                                    </div>
                                    <div class="form-group">
                                        <label>Age</label>
                                        <input type="number" id="emergencyPatientAge" class="form-input" placeholder="Approximate age">
                                    </div>
                                    <div class="form-group">
                                        <label>Gender</label>
                                        <select id="emergencyPatientGender" class="form-input">
                                            <option value="">Select</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Unknown">Unknown</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" id="selectedPatientId">
                            <input type="hidden" id="selectedPatientData">
                        </div>

                        <!-- Emergency Details -->
                        <div class="form-section">
                            <h3 class="section-title">Emergency Details</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Case Type <span class="required">*</span></label>
                                    <select id="emergencyCaseType" class="form-input" required>
                                        <option value="">Select Type</option>
                                        <option value="Trauma">Trauma</option>
                                        <option value="Cardiac">Cardiac Emergency</option>
                                        <option value="Respiratory">Respiratory Distress</option>
                                        <option value="Neurological">Neurological Emergency</option>
                                        <option value="Poisoning">Poisoning/Overdose</option>
                                        <option value="Burns">Burns</option>
                                        <option value="Obstetric">Obstetric Emergency</option>
                                        <option value="Pediatric">Pediatric Emergency</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Severity Level <span class="required">*</span></label>
                                    <select id="emergencySeverity" class="form-input" required>
                                        <option value="">Select Severity</option>
                                        <option value="critical" style="color: #dc2626;">Critical - Immediate Life Threat</option>
                                        <option value="severe" style="color: #f59e0b;">Severe - Urgent Care Needed</option>
                                        <option value="moderate" style="color: #3b82f6;">Moderate - Serious but Stable</option>
                                        <option value="minor" style="color: #10b981;">Minor - Non-urgent</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label>Chief Complaint <span class="required">*</span></label>
                                    <textarea id="emergencyChiefComplaint" class="form-input" rows="3" placeholder="Describe the primary complaint or injury..." required></textarea>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label>Incident Details</label>
                                    <textarea id="emergencyIncidentDetails" class="form-input" rows="3" placeholder="How, when, and where did the incident occur?"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Vital Signs -->
                        <div class="form-section">
                            <h3 class="section-title">Initial Vital Signs</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Blood Pressure (mmHg)</label>
                                    <input type="text" id="emergencyBP" class="form-input" placeholder="120/80">
                                </div>
                                <div class="form-group">
                                    <label>Heart Rate (bpm)</label>
                                    <input type="number" id="emergencyHeartRate" class="form-input" placeholder="80">
                                </div>
                                <div class="form-group">
                                    <label>Respiratory Rate</label>
                                    <input type="number" id="emergencyRespRate" class="form-input" placeholder="16">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Temperature (C)</label>
                                    <input type="number" step="0.1" id="emergencyTemp" class="form-input" placeholder="37.0">
                                </div>
                                <div class="form-group">
                                    <label>O2 Saturation (%)</label>
                                    <input type="number" id="emergencyO2Sat" class="form-input" placeholder="98">
                                </div>
                                <div class="form-group">
                                    <label>GCS Score</label>
                                    <input type="number" id="emergencyGCS" class="form-input" placeholder="15" min="3" max="15">
                                </div>
                            </div>
                        </div>

                        <!-- Initial Treatment -->
                        <div class="form-section">
                            <h3 class="section-title">Initial Treatment Given</h3>
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <textarea id="emergencyInitialTreatment" class="form-input" rows="3" placeholder="Document any immediate interventions performed..."></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeNewEmergencyModal()">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-danger" onclick="saveEmergencyCase()">
                        <i class="fas fa-save"></i>
                        Register Emergency Case
                    </button>
                </div>
            </div>
        </div>

        <!-- View Emergency Details Modal -->
        <div class="modal" id="viewEmergencyModal">
            <div class="modal-overlay" onclick="closeViewEmergencyModal()"></div>
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <i class="fas fa-file-medical"></i>
                        Emergency Case Details
                    </h2>
                    <button class="modal-close" onclick="closeViewEmergencyModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body" id="viewEmergencyBody">
                    <!-- Details will be populated dynamically -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeViewEmergencyModal()">Close</button>
                    <button class="btn btn-primary" onclick="printEmergencyCase()">
                        <i class="fas fa-print"></i>
                        Print
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Consultation History Modal -->
    <div class="modal" id="consultationHistoryModal">
        <div class="modal-overlay" onclick="closeConsultationModal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-notes-medical"></i>
                    Add Consultation History
                </h3>
                <button class="modal-close" onclick="closeConsultationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="consultationHistoryForm">
                    <input type="hidden" id="historyRecordId">
                    
                    <!-- Patient Information Summary -->
                    <div class="form-section">
                        <div class="patient-summary">
                            <div class="summary-item">
                                <i class="fas fa-user"></i>
                                <div>
                                    <small>Patient</small>
                                    <strong id="historyPatientName">-</strong>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-id-card"></i>
                                <div>
                                    <small>ID</small>
                                    <strong id="historyPatientId">-</strong>
                                </div>
                            </div>
                            <div class="summary-item">
                                <i class="fas fa-calendar"></i>
                                <div>
                                    <small>Age/Gender</small>
                                    <strong id="historyPatientAgeGender">-</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chief Complaint -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-comment-medical"></i>
                            Chief Complaint
                        </h4>
                        <div class="form-group">
                            <textarea id="chiefComplaint" rows="2" class="form-control" placeholder="Edit or add chief complaint"></textarea>
                        </div>
                    </div>

                    <!-- History of Presenting Complaint -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-history"></i>
                            History of Presenting Complaint
                        </h4>
                        <div class="form-group">
                            <textarea id="historyPresenting" rows="4" class="form-control" placeholder="Duration, onset, progression, associated symptoms, relieving/aggravating factors..."></textarea>
                        </div>
                    </div>

                    <!-- Past Medical History -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-file-medical-alt"></i>
                            Past Medical History
                        </h4>
                        <div class="form-group">
                            <textarea id="pastMedicalHistory" rows="3" class="form-control" placeholder="Previous illnesses, surgeries, hospitalizations, chronic conditions..."></textarea>
                        </div>
                    </div>

                    <!-- Drug History & Allergies -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="drugHistory">
                                <i class="fas fa-pills"></i>
                                Drug History
                            </label>
                            <textarea id="drugHistory" rows="3" class="form-control" placeholder="Current medications, dosages..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="allergies">
                                <i class="fas fa-exclamation-triangle"></i>
                                Allergies
                            </label>
                            <textarea id="allergies" rows="3" class="form-control" placeholder="Drug allergies, food allergies, reactions..."></textarea>
                        </div>
                    </div>

                    <!-- Physical Examination -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-stethoscope"></i>
                            Physical Examination
                        </h4>
                        <div class="form-group">
                            <label>General Examination</label>
                            <textarea id="generalExamination" rows="3" class="form-control" placeholder="General appearance, vitals, consciousness level..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Systematic Examination</label>
                            <textarea id="systematicExamination" rows="4" class="form-control" placeholder="CVS, RS, GIT, CNS, MSK findings..."></textarea>
                        </div>
                    </div>

                    <!-- Investigations -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-flask"></i>
                            Investigations/Lab Results
                        </h4>
                        <div class="form-group">
                            <textarea id="investigations" rows="3" class="form-control" placeholder="Lab tests, imaging, other diagnostic procedures and results..."></textarea>
                        </div>
                    </div>

                    <!-- Clinical Impression -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-lightbulb"></i>
                            Clinical Impression
                        </h4>
                        <div class="form-group">
                            <textarea id="clinicalImpression" rows="3" class="form-control" placeholder="Summary of findings and clinical assessment..."></textarea>
                        </div>
                    </div>

                    <!-- Differential Diagnosis (DDX) -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-list-ol"></i>
                            Differential Diagnosis (DDX)
                        </h4>
                        <div class="form-group">
                            <textarea id="differentialDiagnosis" rows="3" class="form-control" placeholder="List possible diagnoses in order of probability..."></textarea>
                        </div>
                    </div>

                    <!-- Final Diagnosis -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-diagnoses"></i>
                            Final Diagnosis
                        </h4>
                        <div class="form-group">
                            <input type="text" id="finalDiagnosis" class="form-control" placeholder="Primary diagnosis">
                        </div>
                    </div>

                    <!-- Treatment Plan -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-prescription"></i>
                            Treatment Plan
                        </h4>
                        <div class="form-group">
                            <textarea id="treatmentPlan" rows="4" class="form-control" placeholder="Medications prescribed, procedures, follow-up instructions..."></textarea>
                        </div>
                    </div>

                    <!-- Additional Notes -->
                    <div class="form-section">
                        <h4 class="form-section-title">
                            <i class="fas fa-sticky-note"></i>
                            Additional Notes
                        </h4>
                        <div class="form-group">
                            <textarea id="additionalNotes" rows="3" class="form-control" placeholder="Any other relevant information..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeConsultationModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveConsultationHistory()">
                    <i class="fas fa-save"></i>
                    Save History
                </button>
            </div>
        </div>
    </div>

    <!-- Patient Details Modal -->
    <div class="modal" id="patientDetailsModal">
        <div class="modal-overlay" onclick="closePatientModal()"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-circle"></i>
                    Patient Details
                </h3>
                <button class="modal-close" onclick="closePatientModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="patient-info-grid">
                    <div class="info-item">
                        <span class="info-label">Patient ID</span>
                        <span class="info-value" id="modalPatientId">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Full Name</span>
                        <span class="info-value" id="modalPatientName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Age</span>
                        <span class="info-value" id="modalPatientAge">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Gender</span>
                        <span class="info-value" id="modalPatientGender">-</span>
                    </div>
                    <div class="info-item full-width">
                        <span class="info-label">Chief Complaint</span>
                        <span class="info-value" id="modalPatientComplaint">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Priority</span>
                        <span class="info-value">
                            <span class="priority-badge" id="modalPatientPriority">-</span>
                        </span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Wait Time</span>
                        <span class="info-value" id="modalPatientWaitTime">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Triage Time</span>
                        <span class="info-value" id="modalPatientTriageTime">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Queue Position</span>
                        <span class="info-value" id="modalPatientQueuePosition">-</span>
                    </div>
                </div>
                
                <!-- Vital Signs (if available from triage) -->
                <div id="vitalSignsSection" style="display: none;">
                    <div class="section-divider"></div>
                    <h4 class="subsection-title">
                        <i class="fas fa-heartbeat"></i>
                        Vital Signs
                    </h4>
                    <div class="patient-info-grid">
                        <div class="info-item">
                            <span class="info-label">Blood Pressure</span>
                            <span class="info-value" id="modalBP">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Heart Rate</span>
                            <span class="info-value" id="modalHeartRate">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Temperature</span>
                            <span class="info-value" id="modalTemp">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Oxygen Saturation</span>
                            <span class="info-value" id="modalO2Sat">-</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePatientModal()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-primary" id="modalConsultBtn">
                    <i class="fas fa-user-md"></i>
                    Start Consultation
                </button>
            </div>
        </div>
    </div>

    <!-- Send to Lab Modal -->
    <div class="modal" id="sendToLabModal">
        <div class="modal-overlay" onclick="closeSendToLabModal()"></div>
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-flask"></i>
                    Send to Laboratory
                </h3>
                <button class="modal-close" onclick="closeSendToLabModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="labPatientRecordId">
                
                <!-- Patient Information -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-user"></i>
                        Patient Information
                    </h4>
                    <div class="patient-summary">
                        <div class="summary-item">
                            <i class="fas fa-id-card"></i>
                            <div>
                                <small>Patient ID</small>
                                <strong id="labPatientId">-</strong>
                            </div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-user"></i>
                            <div>
                                <small>Name</small>
                                <strong id="labPatientName">-</strong>
                            </div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-calendar"></i>
                            <div>
                                <small>Age/Gender</small>
                                <strong id="labPatientAgeGender">-</strong>
                            </div>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label>Chief Complaint</label>
                        <div class="info-value" id="labPatientComplaint" style="padding: 10px; background: var(--sidebar-bg); border-radius: 6px;">-</div>
                    </div>
                </div>

                <!-- Lab Tests Selection -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-vials"></i>
                        Select Laboratory Tests
                    </h4>
                    
                    <!-- Hematology Tests -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-microscope"></i>
                            Hematology
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="CBC" id="test_cbc">
                                <span>Complete Blood Count (CBC)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="FBC" id="test_fbc">
                                <span>Full Blood Count (FBC)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="ESR" id="test_esr">
                                <span>Erythrocyte Sedimentation Rate (ESR)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Blood Group" id="test_bloodgroup">
                                <span>Blood Group & Rh</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Hemoglobin" id="test_hb">
                                <span>Hemoglobin (Hb)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="PT/INR" id="test_pt">
                                <span>Prothrombin Time (PT/INR)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Clinical Chemistry -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-flask"></i>
                            Clinical Chemistry
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="FBS" id="test_fbs">
                                <span>Fasting Blood Sugar (FBS)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="RBS" id="test_rbs">
                                <span>Random Blood Sugar (RBS)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="HbA1c" id="test_hba1c">
                                <span>HbA1c</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Lipid Profile" id="test_lipid">
                                <span>Lipid Profile</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Renal Function" id="test_rft">
                                <span>Renal Function Test (RFT)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Liver Function" id="test_lft">
                                <span>Liver Function Test (LFT)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Electrolytes" id="test_electrolytes">
                                <span>Electrolytes (Na, K, Cl)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Uric Acid" id="test_uricacid">
                                <span>Uric Acid</span>
                            </label>
                        </div>
                    </div>

                    <!-- Urinalysis -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-vial"></i>
                            Urinalysis
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Urinalysis" id="test_urinalysis">
                                <span>Complete Urinalysis</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Urine Culture" id="test_urineculture">
                                <span>Urine Culture & Sensitivity</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Pregnancy Test" id="test_pregnancy">
                                <span>Pregnancy Test (HCG)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Microbiology -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-bacteria"></i>
                            Microbiology
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Blood Culture" id="test_bloodculture">
                                <span>Blood Culture & Sensitivity</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Stool Culture" id="test_stoolculture">
                                <span>Stool Culture</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Sputum Culture" id="test_sputumculture">
                                <span>Sputum Culture</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Gram Stain" id="test_gramstain">
                                <span>Gram Stain</span>
                            </label>
                        </div>
                    </div>

                    <!-- Serology/Immunology -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-syringe"></i>
                            Serology & Immunology
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="HIV Test" id="test_hiv">
                                <span>HIV Screening</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Hepatitis B" id="test_hepb">
                                <span>Hepatitis B Surface Antigen</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Hepatitis C" id="test_hepc">
                                <span>Hepatitis C Antibody</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="VDRL" id="test_vdrl">
                                <span>VDRL/RPR (Syphilis)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Widal Test" id="test_widal">
                                <span>Widal Test (Typhoid)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Malaria Test" id="test_malaria">
                                <span>Malaria Parasite Test</span>
                            </label>
                        </div>
                    </div>

                    <!-- Hormones & Thyroid -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-capsules"></i>
                            Hormones & Thyroid
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Thyroid Profile" id="test_thyroid">
                                <span>Thyroid Function Test (TFT)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="TSH" id="test_tsh">
                                <span>Thyroid Stimulating Hormone (TSH)</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="PSA" id="test_psa">
                                <span>Prostate Specific Antigen (PSA)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Stool Examination -->
                    <div class="lab-category">
                        <h5 class="lab-category-title">
                            <i class="fas fa-poop"></i>
                            Stool Examination
                        </h5>
                        <div class="lab-tests-grid">
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Stool R/E" id="test_stoolre">
                                <span>Stool Routine Examination</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Occult Blood" id="test_occultblood">
                                <span>Fecal Occult Blood Test</span>
                            </label>
                            <label class="lab-test-checkbox">
                                <input type="checkbox" name="labTest" value="Ova & Parasites" id="test_ova">
                                <span>Ova & Parasites</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Additional Instructions -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-comment-medical"></i>
                        Additional Instructions
                    </h4>
                    <div class="form-group">
                        <textarea id="labInstructions" rows="3" class="form-control" placeholder="Special instructions, priority level, or additional notes for laboratory..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSendToLabModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="sendToLaboratory()">
                    <i class="fas fa-paper-plane"></i>
                    Send to Laboratory
                </button>
            </div>
        </div>
    </div>

    <!-- View Lab Request Modal -->
    <div class="modal" id="viewLabRequestModal">
        <div class="modal-overlay" onclick="closeViewLabRequestModal()"></div>
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-flask"></i>
                    Lab Request Details
                </h3>
                <button class="modal-close" onclick="closeViewLabRequestModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Patient Information -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-user"></i>
                        Patient Information
                    </h4>
                    <div class="patient-summary">
                        <div class="summary-item">
                            <i class="fas fa-id-card"></i>
                            <div>
                                <small>Patient ID</small>
                                <strong id="viewLabPatientId">-</strong>
                            </div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-user"></i>
                            <div>
                                <small>Name</small>
                                <strong id="viewLabPatientName">-</strong>
                            </div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-calendar"></i>
                            <div>
                                <small>Age/Gender</small>
                                <strong id="viewLabPatientAgeGender">-</strong>
                            </div>
                        </div>
                    </div>
                    <div class="info-grid" style="margin-top: 15px;">
                        <div class="info-item">
                            <span class="info-label">Complaint</span>
                            <span class="info-value" id="viewLabComplaint">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Diagnosis</span>
                            <span class="info-value" id="viewLabDiagnosis">-</span>
                        </div>
                    </div>
                </div>

                <!-- Request Information -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-info-circle"></i>
                        Request Information
                    </h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Request ID</span>
                            <span class="info-value" id="viewLabRequestId">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Requested By</span>
                            <span class="info-value" id="viewLabRequestedBy">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Request Date</span>
                            <span class="info-value" id="viewLabRequestDate">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status</span>
                            <span class="info-value" id="viewLabStatus">-</span>
                        </div>
                    </div>
                </div>

                <!-- Tests Requested -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-vials"></i>
                        Tests Requested
                    </h4>
                    <div id="viewLabTestsList" class="tests-list">
                        <!-- Tests will be populated here -->
                    </div>
                </div>

                <!-- Instructions -->
                <div class="form-section" id="viewLabInstructionsSection">
                    <h4 class="form-section-title">
                        <i class="fas fa-comment-medical"></i>
                        Special Instructions
                    </h4>
                    <div class="info-value" id="viewLabInstructions">-</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewLabRequestModal()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Perform Lab Test Modal -->
    <div class="modal" id="performLabTestModal">
        <div class="modal-overlay" onclick="closePerformLabTestModal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-microscope"></i>
                    Perform Laboratory Tests
                </h3>
                <button class="modal-close" onclick="closePerformLabTestModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="performLabRequestId">
                
                <!-- Patient Summary -->
                <div class="form-section">
                    <div class="patient-summary">
                        <div class="summary-item">
                            <i class="fas fa-id-card"></i>
                            <div>
                                <small>Patient ID</small>
                                <strong id="performLabPatientId">-</strong>
                            </div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-user"></i>
                            <div>
                                <small>Name</small>
                                <strong id="performLabPatientName">-</strong>
                            </div>
                        </div>
                        <div class="summary-item">
                            <i class="fas fa-flask"></i>
                            <div>
                                <small>Request ID</small>
                                <strong id="performLabRequestIdDisplay">-</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Results Entry -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-edit"></i>
                        Enter Test Results
                    </h4>
                    <div id="labTestResultsForm">
                        <!-- Test result fields will be dynamically generated here -->
                    </div>
                </div>

                <!-- Lab Technician Notes -->
                <div class="form-section">
                    <h4 class="form-section-title">
                        <i class="fas fa-notes-medical"></i>
                        Laboratory Notes
                    </h4>
                    <div class="form-group">
                        <textarea id="labTechnicianNotes" rows="4" class="form-control" placeholder="Observations, remarks, or additional notes..."></textarea>
                    </div>
                </div>

                <!-- Performed By -->
                <div class="form-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labTechnicianName">Performed By (Lab Technician) <span class="required">*</span></label>
                            <input type="text" id="labTechnicianName" class="form-control" placeholder="Enter technician name" required>
                        </div>
                        <div class="form-group">
                            <label for="labCompletionDate">Completion Date/Time</label>
                            <input type="datetime-local" id="labCompletionDate" class="form-control">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePerformLabTestModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="saveLabResults()">
                    <i class="fas fa-save"></i>
                    Save Results
                </button>
            </div>
        </div>
    </div>

    <!-- Send Lab Results to Doctor Modal -->
    <div class="modal" id="sendLabToDoctorModal">
        <div class="modal-overlay" onclick="closeSendLabToDoctorModal()"></div>
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-paper-plane"></i>
                    Send Results to Doctor
                </h2>
                <button class="modal-close" onclick="closeSendLabToDoctorModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="sendLabToDoctorRequestId">
                
                <div style="background: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <i class="fas fa-check-circle" style="font-size: 32px; color: #10b981;"></i>
                        <div>
                            <h3 style="margin: 0; color: #065f46;">Lab Results Completed Successfully!</h3>
                            <p style="margin: 5px 0 0 0; color: #047857;">All test results have been saved to the system.</p>
                        </div>
                    </div>
                </div>

                <div class="info-section" style="margin-bottom: 20px;">
                    <h3 class="info-section-title">
                        <i class="fas fa-user"></i>
                        Patient Information
                    </h3>
                    <div class="info-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="info-item">
                            <span class="info-label">Patient ID:</span>
                            <span class="info-value" id="sendLabPatientId">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Patient Name:</span>
                            <span class="info-value" id="sendLabPatientName">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Report ID:</span>
                            <span class="info-value" id="sendLabReportId">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Requested By:</span>
                            <span class="info-value" id="sendLabRequestedBy">-</span>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <h3 class="info-section-title">
                        <i class="fas fa-vials"></i>
                        Tests Completed
                    </h3>
                    <div id="sendLabTestsList" style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <!-- Tests will be listed here -->
                    </div>
                </div>

                <div style="background: #fffbeb; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 4px; margin-top: 20px;">
                    <p style="margin: 0; color: #92400e; font-size: 14px;">
                        <i class="fas fa-info-circle"></i>
                        <strong>Note:</strong> Once sent, the results will be immediately available in the doctor's Lab Reports module for review.
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSendLabToDoctorModal()">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
                <button class="btn btn-primary" onclick="confirmSendLabToDoctor()">
                    <i class="fas fa-paper-plane"></i>
                    Send to Doctor
                </button>
            </div>
        </div>
    </div>

    <!-- View Lab Report Modal (Doctor Side) -->
    <div class="modal" id="viewDoctorLabReportModal">
        <div class="modal-overlay" onclick="closeViewDoctorLabReportModal()"></div>
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-flask"></i>
                    Laboratory Test Results
                </h2>
                <button class="modal-close" onclick="closeViewDoctorLabReportModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Patient Information -->
                <div class="info-section" style="margin-bottom: 25px;">
                    <h3 class="info-section-title">
                        <i class="fas fa-user"></i>
                        Patient Information
                    </h3>
                    <div class="info-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="info-item">
                            <span class="info-label">Patient ID:</span>
                            <span class="info-value" id="viewDoctorLabPatientId">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Patient Name:</span>
                            <span class="info-value" id="viewDoctorLabPatientName">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Age / Gender:</span>
                            <span class="info-value" id="viewDoctorLabPatientAgeGender">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Report ID:</span>
                            <span class="info-value" id="viewDoctorLabReportId">-</span>
                        </div>
                    </div>
                </div>

                <!-- Request Information -->
                <div class="info-section" style="margin-bottom: 25px;">
                    <h3 class="info-section-title">
                        <i class="fas fa-info-circle"></i>
                        Request Details
                    </h3>
                    <div class="info-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                        <div class="info-item">
                            <span class="info-label">Requested By:</span>
                            <span class="info-value" id="viewDoctorLabRequestedBy">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Request Date:</span>
                            <span class="info-value" id="viewDoctorLabRequestDate">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Completed By:</span>
                            <span class="info-value" id="viewDoctorLabPerformedBy">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Completion Date:</span>
                            <span class="info-value" id="viewDoctorLabCompletionDate">-</span>
                        </div>
                    </div>
                    <div class="info-item" style="margin-top: 15px;" id="viewDoctorLabComplaintSection">
                        <span class="info-label">Chief Complaint:</span>
                        <span class="info-value" id="viewDoctorLabComplaint">-</span>
                    </div>
                    <div class="info-item" style="margin-top: 10px;" id="viewDoctorLabDiagnosisSection">
                        <span class="info-label">Diagnosis:</span>
                        <span class="info-value" id="viewDoctorLabDiagnosis">-</span>
                    </div>
                </div>

                <!-- Test Results -->
                <div class="info-section" style="margin-bottom: 25px;">
                    <h3 class="info-section-title">
                        <i class="fas fa-vials"></i>
                        Test Results
                    </h3>
                    <div id="viewDoctorLabResultsContainer" style="background: #f8fafc; padding: 20px; border-radius: 8px;">
                        <!-- Results will be populated here -->
                    </div>
                </div>

                <!-- Technician Notes -->
                <div class="info-section" id="viewDoctorLabNotesSection" style="display: none;">
                    <h3 class="info-section-title">
                        <i class="fas fa-notes-medical"></i>
                        Technician Notes
                    </h3>
                    <div style="background: #fffbeb; border-left: 4px solid #f59e0b; padding: 15px; border-radius: 4px;">
                        <p id="viewDoctorLabTechnicianNotes" style="margin: 0; white-space: pre-wrap;">-</p>
                    </div>
                </div>

                <!-- Doctor Review Section -->
                <div class="info-section" style="margin-top: 25px;">
                    <h3 class="info-section-title">
                        <i class="fas fa-user-md"></i>
                        Doctor's Review
                    </h3>
                    <div class="form-group">
                        <label for="doctorReviewNotes">Add Review Notes (Optional)</label>
                        <textarea id="doctorReviewNotes" rows="4" class="form-control" placeholder="Add your clinical interpretation, recommendations, or follow-up actions..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="printDoctorLabReport()">
                    <i class="fas fa-print"></i>
                    Print
                </button>
                <button class="btn btn-secondary" onclick="closeViewDoctorLabReportModal()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-primary" onclick="markLabReportAsReviewed()">
                    <i class="fas fa-check"></i>
                    Mark as Reviewed
                </button>
            </div>
        </div>
    </div>

    <!-- Patient Record Details Modal -->
    <div class="modal" id="patientRecordModal">
        <div class="modal-overlay" onclick="closeRecordModal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-file-medical-alt"></i>
                    Patient Medical Record
                </h3>
                <button class="modal-close" onclick="closeRecordModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Patient Info Header -->
                <div class="record-patient-header">
                    <div class="patient-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="patient-header-info">
                        <h3 id="recordPatientName">-</h3>
                        <div class="patient-meta">
                            <span><i class="fas fa-id-card"></i> <strong id="recordPatientId">-</strong></span>
                            <span><i class="fas fa-birthday-cake"></i> <span id="recordPatientAge">-</span></span>
                            <span><i class="fas fa-venus-mars"></i> <span id="recordPatientGender">-</span></span>
                            <span><i class="fas fa-clock"></i> <span id="recordConsultationTime">-</span></span>
                        </div>
                    </div>
                </div>

                <!-- Triage Report Section -->
                <div class="record-section" id="triageReportSection">
                    <div class="record-section-header">
                        <h4><i class="fas fa-notes-medical"></i> Triage Report</h4>
                    </div>
                    <div class="record-section-content">
                        <div class="patient-info-grid">
                            <div class="info-item">
                                <span class="info-label">Chief Complaint</span>
                                <span class="info-value" id="recordChiefComplaint">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Priority Level</span>
                                <span class="info-value">
                                    <span class="priority-badge" id="recordPriority">-</span>
                                </span>
                            </div>
                        </div>
                        
                        <!-- Vital Signs -->
                        <div class="vital-signs-section">
                            <h5 class="subsection-label"><i class="fas fa-heartbeat"></i> Vital Signs</h5>
                            <div class="vitals-grid">
                                <div class="vital-card">
                                    <div class="vital-icon" style="background-color: rgba(239, 68, 68, 0.1);">
                                        <i class="fas fa-heart" style="color: #ef4444;"></i>
                                    </div>
                                    <div class="vital-info">
                                        <span class="vital-label">Blood Pressure</span>
                                        <span class="vital-value" id="recordBP">-</span>
                                        <span class="vital-unit">mmHg</span>
                                    </div>
                                </div>
                                
                                <div class="vital-card">
                                    <div class="vital-icon" style="background-color: rgba(239, 68, 68, 0.1);">
                                        <i class="fas fa-heartbeat" style="color: #ef4444;"></i>
                                    </div>
                                    <div class="vital-info">
                                        <span class="vital-label">Heart Rate</span>
                                        <span class="vital-value" id="recordHR">-</span>
                                        <span class="vital-unit">bpm</span>
                                    </div>
                                </div>
                                
                                <div class="vital-card">
                                    <div class="vital-icon" style="background-color: rgba(245, 158, 11, 0.1);">
                                        <i class="fas fa-thermometer-half" style="color: #f59e0b;"></i>
                                    </div>
                                    <div class="vital-info">
                                        <span class="vital-label">Temperature</span>
                                        <span class="vital-value" id="recordTemp">-</span>
                                        <span class="vital-unit">C</span>
                                    </div>
                                </div>
                                
                                <div class="vital-card">
                                    <div class="vital-icon" style="background-color: rgba(14, 165, 233, 0.1);">
                                        <i class="fas fa-lungs" style="color: #0ea5e9;"></i>
                                    </div>
                                    <div class="vital-info">
                                        <span class="vital-label">Respiratory Rate</span>
                                        <span class="vital-value" id="recordRR">-</span>
                                        <span class="vital-unit">breaths/min</span>
                                    </div>
                                </div>
                                
                                <div class="vital-card">
                                    <div class="vital-icon" style="background-color: rgba(59, 130, 246, 0.1);">
                                        <i class="fas fa-wind" style="color: #3b82f6;"></i>
                                    </div>
                                    <div class="vital-info">
                                        <span class="vital-label">O Saturation</span>
                                        <span class="vital-value" id="recordO2">-</span>
                                        <span class="vital-unit">%</span>
                                    </div>
                                </div>
                                
                                <div class="vital-card">
                                    <div class="vital-icon" style="background-color: rgba(168, 85, 247, 0.1);">
                                        <i class="fas fa-tint" style="color: #a855f7;"></i>
                                    </div>
                                    <div class="vital-info">
                                        <span class="vital-label">Blood Sugar</span>
                                        <span class="vital-value" id="recordBloodSugar">-</span>
                                        <span class="vital-unit">mg/dL</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Body Measurements -->
                        <div class="measurements-section">
                            <h5 class="subsection-label"><i class="fas fa-ruler-combined"></i> Body Measurements</h5>
                            <div class="measurements-grid">
                                <div class="measurement-card">
                                    <div class="measurement-icon">
                                        <i class="fas fa-weight"></i>
                                    </div>
                                    <div class="measurement-info">
                                        <span class="measurement-label">Weight</span>
                                        <span class="measurement-value" id="recordWeight">-</span>
                                        <span class="measurement-unit">kg</span>
                                    </div>
                                </div>
                                
                                <div class="measurement-card">
                                    <div class="measurement-icon">
                                        <i class="fas fa-ruler-vertical"></i>
                                    </div>
                                    <div class="measurement-info">
                                        <span class="measurement-label">Height</span>
                                        <span class="measurement-value" id="recordHeight">-</span>
                                        <span class="measurement-unit">cm</span>
                                    </div>
                                </div>
                                
                                <div class="measurement-card">
                                    <div class="measurement-icon">
                                        <i class="fas fa-calculator"></i>
                                    </div>
                                    <div class="measurement-info">
                                        <span class="measurement-label">BMI</span>
                                        <span class="measurement-value" id="recordBMI">-</span>
                                        <span class="measurement-unit">kg/m</span>
                                    </div>
                                </div>
                                
                                <div class="measurement-card">
                                    <div class="measurement-icon">
                                        <i class="fas fa-circle"></i>
                                    </div>
                                    <div class="measurement-info">
                                        <span class="measurement-label">Head Circumference</span>
                                        <span class="measurement-value" id="recordHeadCirc">-</span>
                                        <span class="measurement-unit">cm</span>
                                    </div>
                                </div>
                                
                                <div class="measurement-card">
                                    <div class="measurement-icon">
                                        <i class="fas fa-expand-arrows-alt"></i>
                                    </div>
                                    <div class="measurement-info">
                                        <span class="measurement-label">Chest Circumference</span>
                                        <span class="measurement-value" id="recordChestCirc">-</span>
                                        <span class="measurement-unit">cm</span>
                                    </div>
                                </div>
                                
                                <div class="measurement-card">
                                    <div class="measurement-icon">
                                        <i class="fas fa-circle-notch"></i>
                                    </div>
                                    <div class="measurement-info">
                                        <span class="measurement-label">Abdominal Circumference</span>
                                        <span class="measurement-value" id="recordAbdCirc">-</span>
                                        <span class="measurement-unit">cm</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Consultation History Section -->
                <div class="record-section" id="consultationSection">
                    <div class="record-section-header">
                        <h4><i class="fas fa-user-md"></i> Consultation Details</h4>
                        <span class="status-badge" id="recordHistoryStatus">Pending</span>
                    </div>
                    <div class="record-section-content" id="consultationContent">
                        <div class="empty-state">
                            <i class="fas fa-clipboard"></i>
                            <p>No consultation history recorded yet</p>
                        </div>
                    </div>
                </div>

                <!-- Full Consultation History (when available) -->
                <div id="fullConsultationHistory" style="display: none;">
                    <!-- History of Present Illness -->
                    <div class="record-subsection">
                        <h5 class="subsection-label"><i class="fas fa-history"></i> History</h5>
                        <div class="info-item full-width">
                            <span class="info-label">History of Presenting Illness</span>
                            <p class="info-text" id="recordHPI">-</p>
                        </div>
                        <div class="patient-info-grid">
                            <div class="info-item">
                                <span class="info-label">Past Medical History</span>
                                <p class="info-text" id="recordPMH">-</p>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Family History</span>
                                <p class="info-text" id="recordFH">-</p>
                            </div>
                        </div>
                        <div class="patient-info-grid">
                            <div class="info-item">
                                <span class="info-label">Drug History</span>
                                <p class="info-text" id="recordDrugHx">-</p>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Allergies</span>
                                <p class="info-text" id="recordAllergies">-</p>
                            </div>
                        </div>
                    </div>

                    <!-- Physical Examination -->
                    <div class="record-subsection">
                        <h5 class="subsection-label"><i class="fas fa-stethoscope"></i> Physical Examination</h5>
                        <div class="info-item full-width">
                            <span class="info-label">General Examination</span>
                            <p class="info-text" id="recordGenExam">-</p>
                        </div>
                        <div class="info-item full-width">
                            <span class="info-label">Systemic Examination</span>
                            <p class="info-text" id="recordSysExam">-</p>
                        </div>
                    </div>

                    <!-- Diagnosis -->
                    <div class="record-subsection">
                        <h5 class="subsection-label"><i class="fas fa-diagnoses"></i> Diagnosis</h5>
                        <div class="info-item full-width">
                            <span class="info-label">Clinical Impression</span>
                            <p class="info-text highlight" id="recordImpression">-</p>
                        </div>
                        <div class="info-item full-width">
                            <span class="info-label">Differential Diagnosis</span>
                            <p class="info-text" id="recordDDx">-</p>
                        </div>
                    </div>

                    <!-- Investigations -->
                    <div class="record-subsection" id="investigationsSection">
                        <h5 class="subsection-label"><i class="fas fa-flask"></i> Investigations</h5>
                        <div class="info-item full-width">
                            <p class="info-text" id="recordInvestigations">-</p>
                        </div>
                    </div>

                    <!-- Treatment Plan -->
                    <div class="record-subsection">
                        <h5 class="subsection-label"><i class="fas fa-procedures"></i> Treatment Plan</h5>
                        <div class="info-item full-width">
                            <span class="info-label">Management</span>
                            <p class="info-text" id="recordTreatment">-</p>
                        </div>
                        <div class="info-item full-width">
                            <span class="info-label">Prescriptions</span>
                            <p class="info-text prescription" id="recordPrescriptions">-</p>
                        </div>
                        <div class="info-item full-width">
                            <span class="info-label">Follow-up</span>
                            <p class="info-text" id="recordFollowUp">-</p>
                        </div>
                    </div>

                    <!-- Doctor's Notes -->
                    <div class="record-subsection" id="notesSection">
                        <h5 class="subsection-label"><i class="fas fa-sticky-note"></i> Additional Notes</h5>
                        <div class="info-item full-width">
                            <p class="info-text" id="recordNotes">-</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeRecordModal()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-primary" id="printRecordBtn">
                    <i class="fas fa-print"></i>
                    Print Record
                </button>
            </div>
        </div>
    </div>

    <!-- Rx Treatment Modal -->
    <div class="modal" id="rxTreatmentModal">
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-prescription"></i>
                    Rx - Treatment & Prescription
                </h2>
                <button class="modal-close" onclick="closeRxTreatmentModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Patient Info Bar -->
                <div class="rx-patient-info">
                    <div class="rx-info-item">
                        <span class="rx-info-label">Patient Name:</span>
                        <span class="rx-info-value" id="rxPatientName">-</span>
                    </div>
                    <div class="rx-info-item">
                        <span class="rx-info-label">Patient ID:</span>
                        <span class="rx-info-value" id="rxPatientId">-</span>
                    </div>
                    <div class="rx-info-item">
                        <span class="rx-info-label">Age/Gender:</span>
                        <span class="rx-info-value" id="rxPatientAge">-</span>
                    </div>
                    <div class="rx-info-item">
                        <span class="rx-info-label">Lab Report ID:</span>
                        <span class="rx-info-value" id="rxReportId">-</span>
                    </div>
                </div>

                <!-- Diagnosis Section -->
                <div class="rx-section">
                    <h3 class="rx-section-title">
                        <i class="fas fa-stethoscope"></i>
                        Diagnosis
                    </h3>
                    <div class="form-group">
                        <label for="diagnosisType">Diagnosis Type</label>
                        <select class="form-control" id="diagnosisType" onchange="toggleDiagnosisInput()">
                            <option value="">Select diagnosis type...</option>
                            <option value="common">Common Diseases</option>
                            <option value="manual">Manual Entry</option>
                        </select>
                    </div>

                    <div class="form-group" id="commonDiagnosisGroup" style="display: none;">
                        <label for="commonDiagnosis">Select Disease</label>
                        <select class="form-control" id="commonDiagnosis" onchange="addDiagnosisFromDropdown()">
                            <option value="">Choose a disease...</option>
                            <optgroup label="Infectious Diseases">
                                <option value="Malaria">Malaria</option>
                                <option value="Typhoid Fever">Typhoid Fever</option>
                                <option value="Tuberculosis (TB)">Tuberculosis (TB)</option>
                                <option value="Pneumonia">Pneumonia</option>
                                <option value="Upper Respiratory Tract Infection (URTI)">Upper Respiratory Tract Infection (URTI)</option>
                                <option value="Urinary Tract Infection (UTI)">Urinary Tract Infection (UTI)</option>
                                <option value="Gastroenteritis">Gastroenteritis</option>
                                <option value="Dengue Fever">Dengue Fever</option>
                            </optgroup>
                            <optgroup label="Chronic Conditions">
                                <option value="Hypertension">Hypertension</option>
                                <option value="Type 2 Diabetes Mellitus">Type 2 Diabetes Mellitus</option>
                                <option value="Type 1 Diabetes Mellitus">Type 1 Diabetes Mellitus</option>
                                <option value="Asthma">Asthma</option>
                                <option value="Chronic Obstructive Pulmonary Disease (COPD)">Chronic Obstructive Pulmonary Disease (COPD)</option>
                                <option value="Chronic Kidney Disease (CKD)">Chronic Kidney Disease (CKD)</option>
                                <option value="Heart Failure">Heart Failure</option>
                            </optgroup>
                            <optgroup label="Gastrointestinal">
                                <option value="Peptic Ulcer Disease">Peptic Ulcer Disease</option>
                                <option value="Gastroesophageal Reflux Disease (GERD)">Gastroesophageal Reflux Disease (GERD)</option>
                                <option value="Irritable Bowel Syndrome (IBS)">Irritable Bowel Syndrome (IBS)</option>
                                <option value="Hepatitis">Hepatitis</option>
                            </optgroup>
                            <optgroup label="Metabolic & Endocrine">
                                <option value="Hyperthyroidism">Hyperthyroidism</option>
                                <option value="Hypothyroidism">Hypothyroidism</option>
                                <option value="Anemia">Anemia</option>
                                <option value="Vitamin D Deficiency">Vitamin D Deficiency</option>
                            </optgroup>
                            <optgroup label="Other">
                                <option value="Acute Appendicitis">Acute Appendicitis</option>
                                <option value="Migraine">Migraine</option>
                                <option value="Anxiety Disorder">Anxiety Disorder</option>
                                <option value="Depression">Depression</option>
                                <option value="Arthritis">Arthritis</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="form-group" id="manualDiagnosisGroup" style="display: none;">
                        <label for="manualDiagnosis">Enter Diagnosis</label>
                        <textarea class="form-control" id="manualDiagnosis" rows="2" placeholder="Enter diagnosis manually..."></textarea>
                        <button class="btn btn-sm btn-secondary" onclick="addManualDiagnosis()" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> Add Diagnosis
                        </button>
                    </div>

                    <div class="rx-diagnosis-list" id="rxDiagnosisList" style="display: none;">
                        <label>Selected Diagnosis:</label>
                        <div id="diagnosisItems"></div>
                    </div>
                </div>

                <!-- Medication Prescription Section -->
                <div class="rx-section">
                    <h3 class="rx-section-title">
                        <i class="fas fa-pills"></i>
                        Medication Prescription
                    </h3>
                    
                    <div class="medication-search-bar">
                        <input type="text" class="form-control" id="medicationSearch" placeholder="Search medication from pharmacy inventory..." oninput="searchPharmacyInventory()" autocomplete="off">
                        <div class="medication-search-results" id="medicationSearchResults"></div>
                    </div>

                    <div class="form-row" id="medicationDetailsForm" style="display: none;">
                        <div class="form-group" style="flex: 2;">
                            <label>Selected Medication</label>
                            <input type="text" class="form-control" id="selectedMedicationName" readonly>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Dosage</label>
                            <select class="form-control" id="medicationDosage">
                                <option value="OD">OD (Once Daily)</option>
                                <option value="BD" selected>BD (Twice Daily)</option>
                                <option value="TDS">TDS (Three Times Daily)</option>
                                <option value="QID">QID (Four Times Daily)</option>
                                <option value="PRN">PRN (As Needed)</option>
                                <option value="STAT">STAT (Immediately)</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Duration (Days)</label>
                            <input type="number" class="form-control" id="medicationDuration" min="1" value="7">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Route</label>
                            <select class="form-control" id="medicationRoute">
                                <option value="Oral" selected>Oral</option>
                                <option value="Injection (IM)">Injection (IM)</option>
                                <option value="Injection (IV)">Injection (IV)</option>
                                <option value="Injection (SC)">Injection (SC)</option>
                                <option value="Topical">Topical</option>
                                <option value="Inhalation">Inhalation</option>
                                <option value="Rectal">Rectal</option>
                                <option value="Sublingual">Sublingual</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label>Instructions</label>
                            <input type="text" class="form-control" id="medicationInstructions" placeholder="e.g., Take with food, Before meals...">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="addMedicationToCart()" style="height: 38px;">
                                <i class="fas fa-cart-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Manual Medication Entry -->
                    <div class="manual-medication-toggle">
                        <button class="btn btn-sm btn-secondary" onclick="toggleManualMedication()">
                            <i class="fas fa-keyboard"></i>
                            <span id="manualMedToggleText">Add Manual Medication</span>
                        </button>
                    </div>

                    <div class="form-row" id="manualMedicationForm" style="display: none; margin-top: 15px;">
                        <div class="form-group" style="flex: 2;">
                            <label>Medication Name</label>
                            <input type="text" class="form-control" id="manualMedicationName" placeholder="Enter medication name...">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Dosage</label>
                            <select class="form-control" id="manualMedicationDosage">
                                <option value="OD">OD (Once Daily)</option>
                                <option value="BD" selected>BD (Twice Daily)</option>
                                <option value="TDS">TDS (Three Times Daily)</option>
                                <option value="QID">QID (Four Times Daily)</option>
                                <option value="PRN">PRN (As Needed)</option>
                                <option value="STAT">STAT (Immediately)</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Duration (Days)</label>
                            <input type="number" class="form-control" id="manualMedicationDuration" min="1" value="7">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>Route</label>
                            <select class="form-control" id="manualMedicationRoute">
                                <option value="Oral" selected>Oral</option>
                                <option value="Injection (IM)">Injection (IM)</option>
                                <option value="Injection (IV)">Injection (IV)</option>
                                <option value="Injection (SC)">Injection (SC)</option>
                                <option value="Topical">Topical</option>
                                <option value="Inhalation">Inhalation</option>
                                <option value="Rectal">Rectal</option>
                                <option value="Sublingual">Sublingual</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2;">
                            <label>Instructions</label>
                            <input type="text" class="form-control" id="manualMedicationInstructions" placeholder="e.g., Take with food...">
                        </div>
                        <div class="form-group" style="flex: 0 0 auto;">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary" onclick="addManualMedicationToCart()" style="height: 38px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Medication Cart -->
                    <div class="medication-cart" id="medicationCart" style="display: none;">
                        <h4 class="cart-title">
                            <i class="fas fa-shopping-cart"></i>
                            Prescription Cart (<span id="cartCount">0</span>)
                        </h4>
                        <div class="cart-items" id="cartItems"></div>
                    </div>
                </div>

                <!-- Additional Management Notes -->
                <div class="rx-section">
                    <h3 class="rx-section-title">
                        <i class="fas fa-notes-medical"></i>
                        Management & Follow-up
                    </h3>
                    <div class="form-group">
                        <label for="managementNotes">Management Plan</label>
                        <textarea class="form-control" id="managementNotes" rows="3" placeholder="Enter management plan, lifestyle advice, or additional instructions..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="followUpNotes">Follow-up Instructions</label>
                        <textarea class="form-control" id="followUpNotes" rows="2" placeholder="e.g., Review after 7 days, Come if symptoms worsen..."></textarea>
                    </div>
                </div>
            </div>

            <div class="modal-footer" style="display: flex; gap: 10px; justify-content: space-between;">
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="closeRxTreatmentModal()">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <button class="btn btn-info" onclick="openViewPrescriptionsModal()" style="background: #0ea5e9;">
                        <i class="fas fa-eye"></i>
                        View Prescriptions
                    </button>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="sendToPharmacy()" style="font-size: 14px; padding: 10px 18px;">
                        <i class="fas fa-paper-plane" style="font-size: 13px; margin-right: 6px;"></i>
                        Pharmacy
                    </button>
                    <button class="btn btn-primary" onclick="sendToNurse()" style="font-size: 14px; padding: 10px 18px;">
                        <i class="fas fa-paper-plane" style="font-size: 13px; margin-right: 6px;"></i>
                        Nurse
                    </button>
                    <button class="btn btn-warning" onclick="referToWard()" style="font-size: 14px; padding: 10px 18px;">
                        <i class="fas fa-paper-plane" style="font-size: 13px; margin-right: 6px;"></i>
                        Ward
                    </button>
                    <button class="btn btn-primary" onclick="sendToBilling()" style="background: #10b981; font-size: 14px; padding: 10px 18px;">
                        <i class="fas fa-paper-plane" style="font-size: 13px; margin-right: 6px;"></i>
                        Billing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Prescriptions Modal -->
    <div class="modal" id="viewPrescriptionsModal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-prescription"></i>
                    Patient Prescription History
                </h2>
                <button class="modal-close" onclick="closeViewPrescriptionsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="patient-info-banner" id="prescriptionPatientInfo" style="background: #2563eb; padding: 20px; border-radius: 8px; margin-bottom: 24px; color: white;">
                    <h3 style="margin: 0 0 8px 0; font-size: 18px;"><i class="fas fa-user"></i> <span id="prescHistoryPatientName">-</span></h3>
                    <p style="margin: 0; opacity: 0.9;">ID: <span id="prescHistoryPatientId">-</span> | Age: <span id="prescHistoryPatientAge">-</span> | Gender: <span id="prescHistoryPatientGender">-</span></p>
                </div>

                <div id="prescriptionsListContainer">
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-spinner fa-spin" style="font-size: 32px; margin-bottom: 16px;"></i>
                        <p>Loading prescriptions...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewPrescriptionsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Ward Patient Details Modal -->
    <div class="modal" id="wardPatientModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-user-injured"></i>
                    <span id="wardPatientModalTitle">Patient Details</span>
                </h2>
                <button class="modal-close" onclick="closeWardPatientModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Patient Info -->
                <div class="patient-info-section">
                    <h3><i class="fas fa-user"></i> Patient Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Patient ID:</span>
                            <span class="info-value" id="wardPatientId">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Name:</span>
                            <span class="info-value" id="wardPatientName">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Age/Gender:</span>
                            <span class="info-value" id="wardPatientAgeGender">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Bed Number:</span>
                            <span class="info-value" id="wardPatientBed">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Admission Date:</span>
                            <span class="info-value" id="wardPatientAdmissionDate">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="wardPatientStatus">-</span>
                        </div>
                    </div>
                </div>

                <!-- Medical Info -->
                <div class="patient-info-section">
                    <h3><i class="fas fa-stethoscope"></i> Medical Information</h3>
                    <div class="info-grid">
                        <div class="info-item" style="grid-column: 1 / -1;">
                            <span class="info-label">Diagnosis:</span>
                            <span class="info-value" id="wardPatientDiagnosis">-</span>
                        </div>
                        <div class="info-item" style="grid-column: 1 / -1;">
                            <span class="info-label">Referring Doctor:</span>
                            <span class="info-value" id="wardPatientDoctor">-</span>
                        </div>
                    </div>
                </div>

                <!-- Doctor's Report -->
                <div class="patient-info-section" id="doctorReportSection">
                    <h3><i class="fas fa-user-md"></i> Doctor's Report</h3>
                    <div class="report-content" id="wardDoctorReport">
                        <p class="text-muted">No doctor's report available</p>
                    </div>
                </div>

                <!-- Nurse's Report -->
                <div class="patient-info-section" id="nurseReportSection">
                    <h3><i class="fas fa-user-nurse"></i> Nurse's Report</h3>
                    <div class="report-content" id="wardNurseReport">
                        <p class="text-muted">No nurse's report available</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeWardPatientModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Add Nurse Report Modal -->
    <div class="modal" id="addNurseReportModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-user-nurse"></i>
                    Add Nurse Report
                </h2>
                <button class="modal-close" onclick="closeNurseReportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="patient-summary-bar">
                    <div class="summary-item">
                        <strong>Patient:</strong> <span id="nurseReportPatientName">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>ID:</strong> <span id="nurseReportPatientId">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>Bed:</strong> <span id="nurseReportBedNo">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Vital Signs</label>
                    <div class="vitals-grid">
                        <div class="form-group">
                            <label>BP (mmHg)</label>
                            <input type="text" class="form-control" id="nurseVitalsBP" placeholder="120/80">
                        </div>
                        <div class="form-group">
                            <label>Pulse (bpm)</label>
                            <input type="number" class="form-control" id="nurseVitalsPulse" placeholder="72">
                        </div>
                        <div class="form-group">
                            <label>Temp (C)</label>
                            <input type="number" step="0.1" class="form-control" id="nurseVitalsTemp" placeholder="37.0">
                        </div>
                        <div class="form-group">
                            <label>SpO2 (%)</label>
                            <input type="number" class="form-control" id="nurseVitalsSpO2" placeholder="98">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Patient Condition <span class="required">*</span></label>
                    <select class="form-control" id="nursePatientCondition" required>
                        <option value="">Select condition...</option>
                        <option value="stable">Stable</option>
                        <option value="improving">Improving</option>
                        <option value="critical">Critical</option>
                        <option value="deteriorating">Deteriorating</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Medications Administered</label>
                    <textarea class="form-control" id="nurseMedicationsGiven" rows="3" placeholder="List medications administered..."></textarea>
                </div>

                <div class="form-group">
                    <label>Nursing Notes <span class="required">*</span></label>
                    <textarea class="form-control" id="nurseReportNotes" rows="5" placeholder="Enter detailed nursing observations and care provided..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Next Follow-up Actions</label>
                    <textarea class="form-control" id="nurseFollowupActions" rows="3" placeholder="Any follow-up actions required..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeNurseReportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveNurseReport()">
                    <i class="fas fa-save"></i> Save Report
                </button>
            </div>
        </div>
    </div>

    <!-- Add Doctor Report Modal -->
    <div class="modal" id="addDoctorReportModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-user-md"></i>
                    Add Doctor's Report
                </h2>
                <button class="modal-close" onclick="closeDoctorReportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="patient-summary-bar">
                    <div class="summary-item">
                        <strong>Patient:</strong> <span id="doctorReportPatientName">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>ID:</strong> <span id="doctorReportPatientId">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>Bed:</strong> <span id="doctorReportBedNo">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Current Diagnosis <span class="required">*</span></label>
                    <input type="text" class="form-control" id="doctorDiagnosis" placeholder="Enter diagnosis..." required>
                </div>

                <div class="form-group">
                    <label>Patient Progress</label>
                    <select class="form-control" id="doctorPatientProgress">
                        <option value="">Select progress...</option>
                        <option value="excellent">Excellent Progress</option>
                        <option value="good">Good Progress</option>
                        <option value="satisfactory">Satisfactory</option>
                        <option value="poor">Poor Progress</option>
                        <option value="deteriorating">Deteriorating</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Treatment Plan <span class="required">*</span></label>
                    <textarea class="form-control" id="doctorTreatmentPlan" rows="4" placeholder="Describe the treatment plan..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Clinical Findings</label>
                    <textarea class="form-control" id="doctorClinicalFindings" rows="4" placeholder="Enter clinical examination findings..."></textarea>
                </div>

                <div class="form-group">
                    <label>Additional Orders</label>
                    <textarea class="form-control" id="doctorAdditionalOrders" rows="3" placeholder="Any additional orders or investigations..."></textarea>
                </div>

                <div class="form-group">
                    <label>Prognosis</label>
                    <textarea class="form-control" id="doctorPrognosis" rows="2" placeholder="Expected outcome and prognosis..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDoctorReportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveDoctorReport()">
                    <i class="fas fa-save"></i> Save Report
                </button>
            </div>
        </div>
    </div>

    <!-- Discharge Patient Modal -->
    <div class="modal" id="dischargePatientModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-sign-out-alt"></i>
                    Discharge Patient
                </h2>
                <button class="modal-close" onclick="closeDischargeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="patient-summary-bar">
                    <div class="summary-item">
                        <strong>Patient:</strong> <span id="dischargePatientName">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>ID:</strong> <span id="dischargePatientId">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>Bed:</strong> <span id="dischargeBedNo">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Discharge Date & Time <span class="required">*</span></label>
                    <input type="datetime-local" class="form-control" id="dischargeDateTime" required>
                </div>

                <div class="form-group">
                    <label>Discharge Type <span class="required">*</span></label>
                    <select class="form-control" id="dischargeType" required>
                        <option value="">Select discharge type...</option>
                        <option value="recovered">Recovered</option>
                        <option value="improved">Improved</option>
                        <option value="against-advice">Against Medical Advice</option>
                        <option value="transfer">Transfer to Another Facility</option>
                        <option value="deceased">Deceased</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Discharge Summary <span class="required">*</span></label>
                    <textarea class="form-control" id="dischargeSummary" rows="5" placeholder="Enter discharge summary, final diagnosis, and treatment given..." required></textarea>
                </div>

                <div class="form-group">
                    <label>Follow-up Instructions</label>
                    <textarea class="form-control" id="dischargeFollowup" rows="3" placeholder="Follow-up appointment details and home care instructions..."></textarea>
                </div>

                <div class="form-group">
                    <label>Medications on Discharge</label>
                    <textarea class="form-control" id="dischargeMedications" rows="3" placeholder="List medications to continue at home..."></textarea>
                </div>

                <div class="form-group">
                    <label>Precautions & Advice</label>
                    <textarea class="form-control" id="dischargePrecautions" rows="3" placeholder="Special precautions and advice for patient..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDischargeModal()">Cancel</button>
                <button class="btn btn-success" onclick="confirmDischargePatient()">
                    <i class="fas fa-check"></i> Discharge Patient
                </button>
            </div>
        </div>
    </div>

    <!-- Discharge Report Print Modal -->
    <div class="modal" id="dischargeReportModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-file-medical"></i>
                    Discharge Report
                </h2>
                <button class="modal-close" onclick="closeDischargeReportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="dischargeReportContent" style="padding: 20px; background: white;">
                    <!-- Report content will be generated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeDischargeReportModal()">Close</button>
                <button class="btn btn-primary" onclick="printDischargeReport()">
                    <i class="fas fa-print"></i> Print Report
                </button>
            </div>
        </div>
    </div>

    <!-- Admit Patient from Queue Modal -->
    <div class="modal" id="admitPatientModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-hospital-user"></i>
                    Admit Patient to Ward
                </h2>
                <button class="modal-close" onclick="closeAdmitPatientModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="patient-summary-bar">
                    <div class="summary-item">
                        <strong>Patient:</strong> <span id="admitPatientName">-</span>
                    </div>
                    <div class="summary-item">
                        <strong>ID:</strong> <span id="admitPatientId">-</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Bed Number <span class="required">*</span></label>
                    <input type="text" class="form-control" id="admitBedNumber" placeholder="e.g., B-101" required>
                </div>

                <div class="form-group">
                    <label>Ward/Room</label>
                    <select class="form-control" id="admitWardRoom">
                        <option value="">Select ward/room...</option>
                        <option value="general">General Ward</option>
                        <option value="icu">ICU</option>
                        <option value="private">Private Room</option>
                        <option value="semi-private">Semi-Private</option>
                        <option value="isolation">Isolation</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Initial Condition</label>
                    <select class="form-control" id="admitInitialCondition">
                        <option value="stable">Stable</option>
                        <option value="critical">Critical</option>
                        <option value="serious">Serious</option>
                        <option value="fair">Fair</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Special Instructions</label>
                    <textarea class="form-control" id="admitSpecialInstructions" rows="3" placeholder="Any special care instructions..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAdmitPatientModal()">Cancel</button>
                <button class="btn btn-success" onclick="confirmAdmitPatient()">
                    <i class="fas fa-check"></i> Admit Patient
                </button>
            </div>
        </div>
    </div>

    <!-- Compose Message Modal -->
    <div id="composeMessageModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-pen"></i> Compose Message</h3>
                <button class="close-modal" onclick="closeComposeMessageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="messageRecipient">To *</label>
                    <select class="form-control" id="messageRecipient" required>
                        <option value="">Select recipient...</option>
                        <option value="all">All Staff</option>
                        <option value="doctors">All Doctors</option>
                        <option value="nurses">All Nurses</option>
                        <option value="pharmacists">All Pharmacists</option>
                        <option value="lab-techs">All Lab Technicians</option>
                        <option value="administrators">All Administrators</option>
                        <optgroup label="Individual Staff" id="individualStaffList">
                            <!-- Individual staff will be loaded here -->
                        </optgroup>
                    </select>
                </div>

                <div class="form-group">
                    <label for="messageSubject">Subject *</label>
                    <input type="text" class="form-control" id="messageSubject" placeholder="Enter subject" required maxlength="100">
                </div>

                <div class="form-group">
                    <label for="messageContent">Message *</label>
                    <textarea class="form-control" id="messageContent" rows="6" placeholder="Type your message here..." required maxlength="1000"></textarea>
                    <small class="form-text">Maximum 1000 characters</small>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="messagePriority"> Mark as urgent
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeComposeMessageModal()">Cancel</button>
                <button class="btn btn-primary" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i> Send Message
                </button>
            </div>
        </div>
    </div>

    <!-- View Message Modal -->
    <div id="viewMessageModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-envelope-open"></i> <span id="viewMessageSubject"></span></h3>
                <button class="close-modal" onclick="closeViewMessageModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="message-meta">
                    <div class="message-from">
                        <strong>From:</strong> <span id="viewMessageFrom"></span>
                    </div>
                    <div class="message-date">
                        <strong>Date:</strong> <span id="viewMessageDate"></span>
                    </div>
                    <div class="message-priority" id="viewMessagePriority" style="display: none;">
                        <span class="badge badge-danger"><i class="fas fa-exclamation-triangle"></i> Urgent</span>
                    </div>
                </div>
                <div class="message-content-view" id="viewMessageContent">
                    <!-- Message content will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeViewMessageModal()">Close</button>
                <button class="btn btn-primary" onclick="replyToMessage()">
                    <i class="fas fa-reply"></i> Reply
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script type="module" src="js/firebase-config.js"></script>
    <script type="module" src="js/firebase-helpers.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module" src="js/messages.js"></script>
    <script type="module" src="js/profile-settings.js"></script>
    <script type="module" src="js/admin.js"></script>
    <script type="module" src="js/pharmacy-inventory.js"></script>
    <script type="module" src="js/pharmacy-pos.js"></script>
    <script type="module" src="js/pharmacy-sales.js"></script>
    <script type="module" src="js/prescription-queue.js"></script>
    <script type="module" src="js/billing.js"></script>
    <script type="module" src="js/ward-nursing.js"></script>
    <script src="js/expense.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Initialize Billing Module -->
    <script type="module">
        import { initBillingModule, initViewBillsModule } from './js/billing.js';
        import { initWardNursingModule } from './js/ward-nursing.js';
        
        // Initialize when billing module is shown
        document.addEventListener('DOMContentLoaded', () => {
            console.log(' Page loaded - initializing ward module for realtime updates...');
            
            // Initialize ward module immediately on page load (not just when navigating to it)
            // This ensures realtime listeners are active to receive patients from Rx module
            try {
                initWardNursingModule();
                console.log(' Ward module initialized on page load');
            } catch (error) {
                console.error(' Error initializing ward module:', error);
            }
            
            // Watch for module changes
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'class') {
                        const billingModule = document.getElementById('billing-module');
                        const billingViewModule = document.getElementById('billing-view-module');
                        const wardNursingModule = document.getElementById('ward-nursing-module');
                        
                        if (billingModule && billingModule.classList.contains('active')) {
                            initBillingModule();
                        }
                        
                        if (billingViewModule && billingViewModule.classList.contains('active')) {
                            initViewBillsModule();
                        }
                        
                        if (wardNursingModule && wardNursingModule.classList.contains('active')) {
                            console.log(' Ward module activated - re-initializing...');
                            initWardNursingModule();
                        }
                    }
                });
            });
            
            // Observe all modules
            document.querySelectorAll('.module').forEach(module => {
                observer.observe(module, { attributes: true });
            });
        });
    </script>
</body>
</html>

